import { degreesToRadians } from "./mathUtilities";
import { findParenIndex, Paren, findDeepestParenthesesScope } from "../utils/tokenUtensils";
import { getMathJaxOperatorsByPriority, getValuesWithKeysBySide, searchMathJaxOperators } from "../utils/dataManager";
import { MathGroup, MathJaxOperator, Token, BasicMathJaxTokens, ensureAcceptableFormatForMathGroupItems, deepSearchWithPath } from "./mathJaxTokens";
const greekLetters = [
    'Alpha', 'alpha', 'Beta', 'Gamma', 'Delta', 'Epsilon', 'Zeta', 'Eta', 'Theta',
    'Iota', 'Kappa', 'Lambda', 'Mu', 'mu', 'Nu', 'Xi', 'Omicron', 'Pi', 'Rho',
    'Sigma', 'Tau', 'Upsilon', 'Phi', 'Chi', 'Psi', 'Omega'
];
/*const latexOperators=[
    'tan', 'sin', 'cos', 'binom', 'frac', 'asin', 'acos',
    'atan', 'arccos', 'arcsin', 'arctan', 'cdot','sqrt'
]*/
export function findConsecutiveSequences(arr) {
    const sequences = [];
    let start = 0;
    for (let i = 1; i <= arr.length; i++) {
        if (arr[i] !== arr[i - 1] + 1) {
            if (i - start > 1) {
                sequences.push(arr.slice(start, i));
            }
            start = i;
        }
    }
    return sequences;
}
const operatorsForMathinfo = {
    bothButRightBracket: ["^"],
    rightBracketAndRequiresSlash: ["sqrt"],
    both: ["+", "-", "*"],
    special: ["="],
    RightParenAndRequiresSlash: ["sin", "cos", "tan", "asin", "acos", "atan", "arcsin", "arccos", "arctan"],
    doubleRightButBracket: ["frac", "binom", "/"]
};
export class MathInfo {
    debugInfo = "";
    solutionInfo = [];
    mathInfo = [];
    graph = "";
    mathSnapshots = [];
    addGraphInfo(value) {
        this.graph += value;
    }
    addDebugInfo(msg, value) {
        this.debugInfo += (typeof msg === "object" ? JSON.stringify(msg, null, 1) : msg) + " : " + (typeof value === "object" ? JSON.stringify(value, null, 1) : value) + "\n ";
    }
    addSolutionInfo(mes) {
        this.solutionInfo.push(mes);
        this.addDebugInfo("Solved", mes);
    }
    addMathInfo(msg) {
        this.mathInfo.push(msg);
    }
    addMathSnapshot(math) {
        this.mathSnapshots.push(math);
        const result = deepSearchWithPath(math, (item) => item instanceof MathJaxOperator && item.solution !== undefined);
        if (!result)
            return;
        const customFormatter = (check, string) => {
            if (check instanceof MathJaxOperator && check.solution !== undefined) {
                return `{\\color{red}${string}}`;
            }
            return string;
        };
        this.mathInfo.push(math.toString(customFormatter));
        console.log(result.item);
        this.solutionInfo.push(result.item.toStringSolution());
    }
}
function rearrangeEquation(tokens, tokenToisolate) {
}
function isolateMultiplication(tokens, isolatToken) {
}
export class Position {
    operator;
    index;
    start;
    end;
    transition;
    specialChar;
    groups;
    constructor(tokens, index) {
        this.index = index;
        this.transition = this.index;
        this.start = this.index;
        this.end = this.index;
        this.position(tokens);
    }
    position(tokens) {
        this.operator = tokens[this.index].value;
        const metadata = searchMathJaxOperators(this.operator);
        if (!metadata)
            throw new Error(`Operator ${this.operator} not found in metadata`);
        const beforeIndex = [];
        const afterIndex = [];
        getValuesWithKeysBySide(metadata.associativity.positions, true).forEach(() => {
            const item = this.applyPosition(tokens, this.start, true);
            beforeIndex.push(item.mathGroup);
            this.start = item.lastItemOfPrevious;
        });
        getValuesWithKeysBySide(metadata.associativity.positions, false).forEach(() => {
            const item = this.applyPosition(tokens, this.end, false);
            afterIndex.push(item.mathGroup);
            this.end = item.lastItemOfPrevious;
        });
        this.groups = beforeIndex.reverse().concat(afterIndex);
    }
    applyPosition(tokens, index, isLeft) {
        let breakChar = index;
        let target;
        const modifiedIndex = index + (isLeft ? -1 : 1);
        if ((isLeft && index <= 0) || (!isLeft && index >= tokens.length - 1) || !tokens[modifiedIndex]) {
            throw new Error("at applyPosition: \"index wasn't valid\" index: " + index);
        }
        if (tokens[modifiedIndex] instanceof Paren) {
            const parenIndex = findParenIndex(tokens[modifiedIndex], tokens);
            breakChar = isLeft ? parenIndex.open : parenIndex.close + 1;
            // Insure proper formatting removed everything including parentheses
            target = ensureAcceptableFormatForMathGroupItems(tokens.slice(parenIndex.open, parenIndex.close + 1));
        }
        else {
            breakChar = modifiedIndex;
            target = ensureAcceptableFormatForMathGroupItems(tokens[breakChar]);
        }
        if (target?.length === 0) {
            throw new Error(`at applyPosition: couldn't find target token for direction ${isLeft ? 'left' : 'right'} and operator"${tokens[index].value}"`);
        }
        //Make sure we don't create duplicate interlocked math groups
        if (target?.length && target?.length === 1 && target[0] instanceof MathGroup) {
            target = target[0];
            target.tryRemoveUnnecessaryNested();
        }
        return {
            mathGroup: new MathGroup(target),
            lastItemOfPrevious: breakChar,
        };
    }
}
function parseSafetyChecks(operator) {
    if (operator.groupNum !== operator.groups.length) {
        throw new Error(`Invalid number of groups for operator ${operator.operator} expected ${operator.groupNum} but got ${operator.groups.length}`);
    }
}
export function parseOperator(operator) {
    parseSafetyChecks(operator);
    function getOperableValue(group) {
        if (!group || !group.isOperable())
            return null;
        const value = group.getOperableValue();
        return value && !value?.isVar() ? value.getNumberValue() : null;
    }
    const group1 = getOperableValue(operator.groups[0]);
    const group2 = getOperableValue(operator.groups[1]);
    if (group1 === null || (group2 === null && operator.groups.length > 1))
        return false;
    switch (operator.operator) {
        case "Sine":
            operator.solution = new MathGroup([new Token(Math.sin(degreesToRadians(group1)))]);
            break;
        case "SquareRoot":
            if (group1 < 0) {
                throw new Error("Cannot calculate the square root of a negative number.");
            }
            operator.solution = new MathGroup([new Token(Math.pow(group1, 0.5))]);
            break;
        case "Fraction": {
            if (group2 === 0) {
                throw new Error("Division by zero is not allowed");
            }
            operator.solution = new MathGroup([new Token(group1 / group2)]);
            break;
        }
        case "Power": {
            operator.solution = new MathGroup([new Token(Math.pow(group1, group2))]);
            break;
        }
        case "Multiplication": {
            operator.solution = new MathGroup([new Token(group1 * group2)]);
            break;
        }
        default:
            throw new Error(`Unknown operator type in parseOperator: ${operator.operator}`);
    }
    return true;
}
function operationsOrder(tokens) {
    function findOperatorIndex(begin, end, tokens, regex) {
        const index = tokens.slice(begin, end).findIndex((token) => token.type === "operator" && regex.test(token.value));
        return index > -1 ? index + begin : null;
    }
    const { begin, end } = findDeepestParenthesesScope(tokens);
    let priority = null;
    for (let i = 1; i <= 6; i++) {
        priority = findOperatorIndex(begin, end, tokens, getMathJaxOperatorsByPriority(i, true));
        if (priority !== null)
            break;
    }
    return { start: begin, end: end, specificOperatorIndex: priority };
}
export class MathPraiser {
    input = "";
    tokens;
    solution;
    mathInfo = new MathInfo();
    constructor(input) {
        this.input = input;
        this.processInput();
        const tokens = new BasicMathJaxTokens();
        tokens.addInput(this.input);
        const basicTokens = tokens.tokens;
        this.convertBasicMathJaxTokenaToMathGroup(basicTokens);
        this.addDebugInfo("convertBasicMathJaxTokenaToMathGroup", this.tokens);
        this.input = this.tokens.toString();
        this.controller();
        this.solution = this.tokens;
        this.addDebugInfo("solution", this.solution);
    }
    parse(tokens) {
        const operatorIndex = tokens.getItems().findIndex(t => t instanceof MathJaxOperator && t.isOperable);
        if (operatorIndex < 0)
            return;
        const operator = tokens.getItems()[operatorIndex];
        operator.groups.forEach(group => {
            this.parse(group);
        });
        parseOperator(operator);
        if (!operator.solution) {
            operator.isOperable = false;
            return;
        }
        this.mathInfo.addMathSnapshot(this.tokens.clone());
        tokens.setItem(operator.solution, operatorIndex);
    }
    controller() {
        this.parse(this.tokens);
        combineSimilarValues(this.tokens);
        this.tokens.removeNested();
        this.tokens.combiningLikeTerms();
    }
    solutionToString() {
        return (this.tokens.toString()) || "";
    }
    addDebugInfo(mes, value) {
        this.mathInfo.addDebugInfo(mes, value);
    }
    processInput() {
        this.input = this.input
            .replace(/(Math.|\\|\s|left|right)/g, "")
            .replace(/{/g, "(")
            .replace(/}/g, ")");
        //.replace(/(?<!\\|[a-zA-Z])(tan|sin|cos|binom|frac|asin|acos|atan|arccos|arcsin|arctan|cdot)/g, "\\$1");
    }
    finalReturn() {
        // return this.tokens.reconstruct()
    }
    defineGroupsAndOperators(tokens) {
        const range = operationsOrder(tokens);
        if (range.start === null || range.end === null)
            return false;
        if (range.specificOperatorIndex === null && range.start === 0 && range.end === tokens.length)
            return true;
        let newMathGroupSuccess = null;
        if (range.specificOperatorIndex !== null)
            newMathGroupSuccess = this.createOperatorItemFromTokens(tokens, range.specificOperatorIndex);
        else
            newMathGroupSuccess = this.createMathGroupInsertFromTokens(tokens, range.start, range.end);
        if (!newMathGroupSuccess)
            return false;
        return this.defineGroupsAndOperators(tokens);
    }
    convertBasicMathJaxTokenaToMathGroup(basicTokens) {
        const success = this.defineGroupsAndOperators(basicTokens);
        if (!success)
            return;
        this.tokens = new MathGroup(ensureAcceptableFormatForMathGroupItems(basicTokens));
    }
    createMathGroupInsertFromTokens(tokens, start, end) {
        const newMathGroup = new MathGroup(ensureAcceptableFormatForMathGroupItems(tokens.slice(start, end + 1)));
        tokens.splice(start, (end - start) + 1, newMathGroup);
        return true;
    }
    createOperatorItemFromTokens(tokens, index) {
        const metadata = searchMathJaxOperators(tokens[index].value);
        if (!metadata)
            throw new Error(`Operator ${tokens[index].value} not found in metadata`);
        const position = new Position(tokens, index);
        const c = deepClone(tokens);
        const newOperator = new MathJaxOperator(position.operator, metadata.associativity.numPositions, position.groups);
        tokens.splice(position.start, (position.end - position.start) + 1, newOperator);
        return true;
    }
}
function deepClone(items) {
    let clone = [];
    items.forEach(item => {
        clone.push(item instanceof Array ? deepClone(item) : item.clone());
    });
    return clone;
}
function combineSimilarValues(math) {
    const testLevels = (item) => { return item.singular(); };
    const testVar = (item) => { return item.numberOnly(); };
    const op = math.getItems().find(t => t instanceof MathJaxOperator);
    if (!op)
        return;
    console.log('MathGroup', op.testGroups(testLevels), op.testGroups(testVar));
    /*const a=new MathOverview()
    a.defineGlobalOverview(math.getItems())
    a.separateIntoIndividuals()*/
}
class mathVariables {
}
export function flattenArray(arr) {
    let result = [];
    let stack = Array.isArray(arr) ? [...arr] : [arr];
    while (stack.length) {
        const next = stack.pop();
        if (Array.isArray(next)) {
            stack.push(...next);
        }
        else {
            result.push(next);
        }
    }
    return result.reverse();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWF0aEVuZ2luZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9tYXRoUGFyc2VyL21hdGhFbmdpbmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUF1QyxnQkFBZ0IsRUFBc0MsTUFBTSxpQkFBaUIsQ0FBQztBQUk1SCxPQUFPLEVBQUUsY0FBYyxFQUFFLEtBQUssRUFBNkIsMkJBQTJCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUN2SCxPQUFPLEVBQTJCLDZCQUE2QixFQUErQix1QkFBdUIsRUFBMEQsc0JBQXNCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNwTyxPQUFPLEVBQUUsU0FBUyxFQUFFLGVBQWUsRUFBRSxLQUFLLEVBQUUsa0JBQWtCLEVBQXFCLHVDQUF1QyxFQUFFLGtCQUFrQixFQUFpQixNQUFNLGlCQUFpQixDQUFDO0FBR3ZMLE1BQU0sWUFBWSxHQUFHO0lBQ2pCLE9BQU8sRUFBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsT0FBTztJQUM1RSxNQUFNLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxLQUFLO0lBQ3hFLE9BQU8sRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLE9BQU87Q0FDMUQsQ0FBQztBQUNGOzs7R0FHRztBQUVILE1BQU0sVUFBVSx3QkFBd0IsQ0FBQyxHQUFVO0lBQy9DLE1BQU0sU0FBUyxHQUFHLEVBQUUsQ0FBQztJQUNyQixJQUFJLEtBQUssR0FBRyxDQUFDLENBQUM7SUFDZCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQ25DLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDNUIsSUFBSSxDQUFDLEdBQUcsS0FBSyxHQUFHLENBQUMsRUFBRSxDQUFDO2dCQUNoQixTQUFTLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDeEMsQ0FBQztZQUNELEtBQUssR0FBRyxDQUFDLENBQUM7UUFDZCxDQUFDO0lBQ0wsQ0FBQztJQUNELE9BQU8sU0FBUyxDQUFDO0FBQ3JCLENBQUM7QUFHRCxNQUFNLG9CQUFvQixHQUFHO0lBQ3pCLG1CQUFtQixFQUFFLENBQUMsR0FBRyxDQUFDO0lBQzFCLDRCQUE0QixFQUFFLENBQUMsTUFBTSxDQUFDO0lBQ3RDLElBQUksRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ3JCLE9BQU8sRUFBRSxDQUFDLEdBQUcsQ0FBQztJQUNkLDBCQUEwQixFQUFFLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLENBQUM7SUFDdkcscUJBQXFCLEVBQUUsQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFDLEdBQUcsQ0FBQztDQUMvQyxDQUFDO0FBR0YsTUFBTSxPQUFPLFFBQVE7SUFDakIsU0FBUyxHQUFTLEVBQUUsQ0FBQztJQUNyQixZQUFZLEdBQVEsRUFBRSxDQUFDO0lBQ3ZCLFFBQVEsR0FBUSxFQUFFLENBQUE7SUFDbEIsS0FBSyxHQUFTLEVBQUUsQ0FBQztJQUNqQixhQUFhLEdBQWMsRUFBRSxDQUFBO0lBQzdCLFlBQVksQ0FBQyxLQUFhO1FBQ3RCLElBQUksQ0FBQyxLQUFLLElBQUUsS0FBSyxDQUFDO0lBQ3RCLENBQUM7SUFDRCxZQUFZLENBQUMsR0FBVyxFQUFFLEtBQVU7UUFDaEMsSUFBSSxDQUFDLFNBQVMsSUFBRSxDQUFDLE9BQU8sR0FBRyxLQUFHLFFBQVEsQ0FBQSxDQUFDLENBQUEsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUMsSUFBSSxFQUFDLENBQUMsQ0FBQyxDQUFBLENBQUMsQ0FBQSxHQUFHLENBQUMsR0FBQyxLQUFLLEdBQUMsQ0FBQyxPQUFPLEtBQUssS0FBRyxRQUFRLENBQUEsQ0FBQyxDQUFBLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFDLElBQUksRUFBQyxDQUFDLENBQUMsQ0FBQSxDQUFDLENBQUEsS0FBSyxDQUFDLEdBQUUsS0FBSyxDQUFDO0lBQ3JKLENBQUM7SUFDRCxlQUFlLENBQUMsR0FBVztRQUN2QixJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUM1QixJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBQyxHQUFHLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBQ0QsV0FBVyxDQUFDLEdBQVc7UUFDbkIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDM0IsQ0FBQztJQUNELGVBQWUsQ0FBQyxJQUFlO1FBQzNCLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO1FBQzdCLE1BQU0sTUFBTSxHQUFHLGtCQUFrQixDQUM3QixJQUFJLEVBQ0osQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLElBQUksWUFBWSxlQUFlLElBQUksSUFBSSxDQUFDLFFBQVEsS0FBSyxTQUFTLENBQzNFLENBQUM7UUFDRixJQUFHLENBQUMsTUFBTTtZQUFDLE9BQU07UUFFakIsTUFBTSxlQUFlLEdBQUcsQ0FBQyxLQUFVLEVBQUMsTUFBYyxFQUFVLEVBQUU7WUFDMUQsSUFBSSxLQUFLLFlBQVksZUFBZSxJQUFJLEtBQUssQ0FBQyxRQUFRLEtBQUssU0FBUyxFQUFFLENBQUM7Z0JBQ25FLE9BQU8sZ0JBQWdCLE1BQU0sR0FBRyxDQUFDO1lBQ3JDLENBQUM7WUFDRCxPQUFPLE1BQU0sQ0FBQTtRQUNqQixDQUFDLENBQUM7UUFDRixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUE7UUFDbEQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDeEIsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLENBQUE7SUFFMUQsQ0FBQztDQUVKO0FBU0QsU0FBUyxpQkFBaUIsQ0FBQyxNQUFXLEVBQUMsY0FBbUI7QUFFMUQsQ0FBQztBQUVELFNBQVMscUJBQXFCLENBQUMsTUFBVyxFQUFDLFdBQWtCO0FBTTdELENBQUM7QUFJRCxNQUFNLE9BQU8sUUFBUTtJQUNqQixRQUFRLENBQVM7SUFDakIsS0FBSyxDQUFTO0lBQ2QsS0FBSyxDQUFTO0lBQ2QsR0FBRyxDQUFTO0lBQ1osVUFBVSxDQUFTO0lBQ25CLFdBQVcsQ0FBUztJQUVwQixNQUFNLENBQWM7SUFDcEIsWUFBWSxNQUFhLEVBQUUsS0FBYTtRQUNwQyxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNuQixJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDN0IsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQ3hCLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUN0QixJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFBO0lBQ3pCLENBQUM7SUFDRCxRQUFRLENBQUMsTUFBYTtRQUNsQixJQUFJLENBQUMsUUFBUSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsS0FBSyxDQUFDO1FBQ3pDLE1BQU0sUUFBUSxHQUFHLHNCQUFzQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN2RCxJQUFJLENBQUMsUUFBUTtZQUFFLE1BQU0sSUFBSSxLQUFLLENBQUMsWUFBWSxJQUFJLENBQUMsUUFBUSx3QkFBd0IsQ0FBQyxDQUFDO1FBRWxGLE1BQU0sV0FBVyxHQUFnQixFQUFFLENBQUM7UUFDcEMsTUFBTSxVQUFVLEdBQWlCLEVBQUUsQ0FBQztRQUVwQyx1QkFBdUIsQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFO1lBQ3pFLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDMUQsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDakMsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUM7UUFDekMsQ0FBQyxDQUFDLENBQUM7UUFHSCx1QkFBdUIsQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFO1lBQzFFLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDekQsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDaEMsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUM7UUFDdkMsQ0FBQyxDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsTUFBTSxHQUFHLFdBQVcsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDM0QsQ0FBQztJQUNELGFBQWEsQ0FBQyxNQUFhLEVBQUUsS0FBYyxFQUFFLE1BQWU7UUFDeEQsSUFBSSxTQUFTLEdBQUMsS0FBSyxDQUFBO1FBQ25CLElBQUksTUFBVyxDQUFDO1FBQ2hCLE1BQU0sYUFBYSxHQUFJLEtBQUssR0FBQyxDQUFDLE1BQU0sQ0FBQSxDQUFDLENBQUEsQ0FBRSxDQUFDLENBQUMsQ0FBQyxDQUFFLENBQUMsQ0FBQyxDQUFDO1FBRS9DLElBQUksQ0FBQyxNQUFNLElBQUksS0FBSyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLElBQUksS0FBSyxJQUFJLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQztZQUM5RixNQUFNLElBQUksS0FBSyxDQUFDLGtEQUFrRCxHQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzlFLENBQUM7UUFFRCxJQUFJLE1BQU0sQ0FBQyxhQUFhLENBQUMsWUFBWSxLQUFLLEVBQUUsQ0FBQztZQUN6QyxNQUFNLFVBQVUsR0FBRyxjQUFjLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxFQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ2hFLFNBQVMsR0FBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxLQUFLLEdBQUMsQ0FBQyxDQUFDO1lBQzNELG9FQUFvRTtZQUNwRSxNQUFNLEdBQUcsdUNBQXVDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLFVBQVUsQ0FBQyxLQUFLLEdBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN4RyxDQUFDO2FBQU0sQ0FBQztZQUNKLFNBQVMsR0FBQyxhQUFhLENBQUM7WUFDeEIsTUFBTSxHQUFHLHVDQUF1QyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBQ3hFLENBQUM7UUFDRCxJQUFJLE1BQU0sRUFBRSxNQUFNLEtBQUcsQ0FBQyxFQUFFLENBQUM7WUFDckIsTUFBTSxJQUFJLEtBQUssQ0FBQyw4REFBOEQsTUFBTSxDQUFBLENBQUMsQ0FBQSxNQUFNLENBQUEsQ0FBQyxDQUFBLE9BQU8saUJBQWlCLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBRSxDQUFDO1FBQ2pKLENBQUM7UUFFRCw2REFBNkQ7UUFDN0QsSUFBRyxNQUFNLEVBQUUsTUFBTSxJQUFFLE1BQU0sRUFBRSxNQUFNLEtBQUcsQ0FBQyxJQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsWUFBVyxTQUFTLEVBQUMsQ0FBQztZQUNsRSxNQUFNLEdBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFBO1lBQ2hCLE1BQU0sQ0FBQywwQkFBMEIsRUFBRSxDQUFDO1FBQ3hDLENBQUM7UUFFRCxPQUFPO1lBQ0gsU0FBUyxFQUFFLElBQUksU0FBUyxDQUFDLE1BQU0sQ0FBQztZQUNoQyxrQkFBa0IsRUFBRSxTQUFTO1NBQ2hDLENBQUM7SUFDTixDQUFDO0NBQ0o7QUFFRCxTQUFTLGlCQUFpQixDQUFDLFFBQXlCO0lBQ2hELElBQUksUUFBUSxDQUFDLFFBQVEsS0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQzdDLE1BQU0sSUFBSSxLQUFLLENBQUMseUNBQXlDLFFBQVEsQ0FBQyxRQUFRLGFBQWEsUUFBUSxDQUFDLFFBQVEsWUFBWSxRQUFRLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7SUFDbEosQ0FBQztBQUNMLENBQUM7QUFFRCxNQUFNLFVBQVUsYUFBYSxDQUFDLFFBQXlCO0lBQ25ELGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQzVCLFNBQVMsZ0JBQWdCLENBQUMsS0FBZ0I7UUFDdEMsSUFBSSxDQUFDLEtBQUssSUFBRSxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUU7WUFBRSxPQUFPLElBQUksQ0FBQztRQUM3QyxNQUFNLEtBQUssR0FBRyxLQUFLLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUN2QyxPQUFPLEtBQUssSUFBRSxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsQ0FBQSxDQUFDLENBQUEsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFDaEUsQ0FBQztJQUNELE1BQU0sTUFBTSxHQUFHLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNwRCxNQUFNLE1BQU0sR0FBRyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDcEQsSUFBSSxNQUFNLEtBQUssSUFBSSxJQUFFLENBQUMsTUFBTSxLQUFHLElBQUksSUFBRSxRQUFRLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBQyxDQUFDLENBQUM7UUFBRSxPQUFPLEtBQUssQ0FBQztJQUU3RSxRQUFRLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUN4QixLQUFLLE1BQU07WUFDUCxRQUFRLENBQUMsUUFBUSxHQUFHLElBQUksU0FBUyxDQUFDLENBQUMsSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ25GLE1BQU07UUFDVixLQUFLLFlBQVk7WUFDYixJQUFJLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztnQkFDYixNQUFNLElBQUksS0FBSyxDQUFDLHdEQUF3RCxDQUFDLENBQUM7WUFDOUUsQ0FBQztZQUNELFFBQVEsQ0FBQyxRQUFRLEdBQUcsSUFBSSxTQUFTLENBQUMsQ0FBQyxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNyRSxNQUFNO1FBQ1YsS0FBSyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQ2QsSUFBSSxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7Z0JBQ2YsTUFBTSxJQUFJLEtBQUssQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDO1lBQ3ZELENBQUM7WUFDRCxRQUFRLENBQUMsUUFBUSxHQUFHLElBQUksU0FBUyxDQUFDLENBQUMsSUFBSSxLQUFLLENBQUMsTUFBTSxHQUFHLE1BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNqRSxNQUFNO1FBQ1YsQ0FBQztRQUNELEtBQUssT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNYLFFBQVEsQ0FBQyxRQUFRLEdBQUcsSUFBSSxTQUFTLENBQUMsQ0FBQyxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBQyxNQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN6RSxNQUFNO1FBQ1YsQ0FBQztRQUNELEtBQUssZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO1lBQ3BCLFFBQVEsQ0FBQyxRQUFRLEdBQUcsSUFBSSxTQUFTLENBQUMsQ0FBQyxJQUFJLEtBQUssQ0FBQyxNQUFNLEdBQUcsTUFBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2pFLE1BQU07UUFDVixDQUFDO1FBQ0Q7WUFDSSxNQUFNLElBQUksS0FBSyxDQUNYLDJDQUEyQyxRQUFRLENBQUMsUUFBUSxFQUFFLENBQ2pFLENBQUM7SUFFVixDQUFDO0lBQ0QsT0FBTyxJQUFJLENBQUM7QUFDaEIsQ0FBQztBQUtELFNBQVMsZUFBZSxDQUFDLE1BQWE7SUFDbEMsU0FBUyxpQkFBaUIsQ0FBQyxLQUFhLEVBQUUsR0FBVyxFQUFFLE1BQVcsRUFBRSxLQUFXO1FBQzNFLE1BQU0sS0FBSyxHQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEtBQW9DLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxJQUFJLEtBQUssVUFBVSxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDL0ksT0FBTyxLQUFLLEdBQUMsQ0FBQyxDQUFDLENBQUEsQ0FBQyxDQUFBLEtBQUssR0FBQyxLQUFLLENBQUEsQ0FBQyxDQUFBLElBQUksQ0FBQztJQUNyQyxDQUFDO0lBQ0QsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRywyQkFBMkIsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMzRCxJQUFJLFFBQVEsR0FBQyxJQUFJLENBQUE7SUFDakIsS0FBSyxJQUFJLENBQUMsR0FBQyxDQUFDLEVBQUMsQ0FBQyxJQUFFLENBQUMsRUFBQyxDQUFDLEVBQUUsRUFBQyxDQUFDO1FBQ25CLFFBQVEsR0FBRyxpQkFBaUIsQ0FBQyxLQUFLLEVBQUcsR0FBRyxFQUFDLE1BQU0sRUFBRSw2QkFBNkIsQ0FBQyxDQUFDLEVBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUN4RixJQUFHLFFBQVEsS0FBRyxJQUFJO1lBQUMsTUFBTTtJQUM3QixDQUFDO0lBQ0QsT0FBTyxFQUFDLEtBQUssRUFBRSxLQUFLLEVBQUMsR0FBRyxFQUFFLEdBQUcsRUFBQyxxQkFBcUIsRUFBRSxRQUFRLEVBQUMsQ0FBQTtBQUNsRSxDQUFDO0FBRUQsTUFBTSxPQUFPLFdBQVc7SUFDcEIsS0FBSyxHQUFDLEVBQUUsQ0FBQztJQUNULE1BQU0sQ0FBWTtJQUNsQixRQUFRLENBQU07SUFDZCxRQUFRLEdBQUMsSUFBSSxRQUFRLEVBQUUsQ0FBQztJQUN4QixZQUFZLEtBQWE7UUFDckIsSUFBSSxDQUFDLEtBQUssR0FBQyxLQUFLLENBQUM7UUFDakIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBRXBCLE1BQU0sTUFBTSxHQUFDLElBQUksa0JBQWtCLEVBQUUsQ0FBQztRQUN0QyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUMzQixNQUFNLFdBQVcsR0FBQyxNQUFNLENBQUMsTUFBTSxDQUFBO1FBRS9CLElBQUksQ0FBQyxvQ0FBb0MsQ0FBQyxXQUFXLENBQUMsQ0FBQTtRQUN0RCxJQUFJLENBQUMsWUFBWSxDQUFDLHNDQUFzQyxFQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUVyRSxJQUFJLENBQUMsS0FBSyxHQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLENBQUE7UUFDakMsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ2xCLElBQUksQ0FBQyxRQUFRLEdBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQTtRQUN6QixJQUFJLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDaEQsQ0FBQztJQUdELEtBQUssQ0FBQyxNQUFpQjtRQUNuQixNQUFNLGFBQWEsR0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLENBQUMsU0FBUyxDQUMzQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsWUFBWSxlQUFlLElBQUksQ0FBQyxDQUFDLFVBQVUsQ0FDcEQsQ0FBRTtRQUNILElBQUksYUFBYSxHQUFDLENBQUM7WUFBRSxPQUFPO1FBQzVCLE1BQU0sUUFBUSxHQUFHLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxhQUFhLENBQW9CLENBQUE7UUFHcEUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDNUIsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN0QixDQUFDLENBQUMsQ0FBQztRQUNILGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQTtRQUN2QixJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ3JCLFFBQVEsQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDO1lBQzVCLE9BQU87UUFDWCxDQUFDO1FBQ0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFBO1FBQ2xELE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBQyxhQUFhLENBQUMsQ0FBQztJQUNwRCxDQUFDO0lBRUQsVUFBVTtRQUNOLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBQ3ZCLG9CQUFvQixDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUNqQyxJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksRUFBRSxDQUFBO1FBQzFCLElBQUksQ0FBQyxNQUFNLENBQUMsa0JBQWtCLEVBQUUsQ0FBQTtJQUVwQyxDQUFDO0lBQ0QsZ0JBQWdCO1FBQ1osT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLENBQUMsSUFBRSxFQUFFLENBQUE7SUFDdkMsQ0FBQztJQUVELFlBQVksQ0FBQyxHQUFXLEVBQUMsS0FBVTtRQUMvQixJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxHQUFHLEVBQUMsS0FBSyxDQUFDLENBQUE7SUFDekMsQ0FBQztJQUNELFlBQVk7UUFDUixJQUFJLENBQUMsS0FBSyxHQUFDLElBQUksQ0FBQyxLQUFLO2FBQ3BCLE9BQU8sQ0FBQywyQkFBMkIsRUFBRSxFQUFFLENBQUM7YUFDeEMsT0FBTyxDQUFDLElBQUksRUFBRSxHQUFHLENBQUM7YUFDbEIsT0FBTyxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQTtRQUNuQix5R0FBeUc7SUFDN0csQ0FBQztJQUNELFdBQVc7UUFDUixtQ0FBbUM7SUFDdEMsQ0FBQztJQUNELHdCQUF3QixDQUFDLE1BQWtCO1FBQ3ZDLE1BQU0sS0FBSyxHQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNwQyxJQUFHLEtBQUssQ0FBQyxLQUFLLEtBQUcsSUFBSSxJQUFFLEtBQUssQ0FBQyxHQUFHLEtBQUcsSUFBSTtZQUFDLE9BQU8sS0FBSyxDQUFDO1FBQ3JELElBQUcsS0FBSyxDQUFDLHFCQUFxQixLQUFHLElBQUksSUFBRSxLQUFLLENBQUMsS0FBSyxLQUFHLENBQUMsSUFBRSxLQUFLLENBQUMsR0FBRyxLQUFHLE1BQU0sQ0FBQyxNQUFNO1lBQUMsT0FBTyxJQUFJLENBQUM7UUFDOUYsSUFBSSxtQkFBbUIsR0FBQyxJQUFJLENBQUE7UUFDNUIsSUFBSSxLQUFLLENBQUMscUJBQXFCLEtBQUcsSUFBSTtZQUNsQyxtQkFBbUIsR0FBQyxJQUFJLENBQUMsNEJBQTRCLENBQUMsTUFBTSxFQUFDLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUFBOztZQUU3RixtQkFBbUIsR0FBQyxJQUFJLENBQUMsK0JBQStCLENBQUMsTUFBTSxFQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQ3RGLElBQUcsQ0FBQyxtQkFBbUI7WUFBQyxPQUFPLEtBQUssQ0FBQztRQUNyQyxPQUFPLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNqRCxDQUFDO0lBQ0Qsb0NBQW9DLENBQUMsV0FBMkM7UUFDNUUsTUFBTSxPQUFPLEdBQUMsSUFBSSxDQUFDLHdCQUF3QixDQUFDLFdBQVcsQ0FBQyxDQUFBO1FBQ3hELElBQUcsQ0FBQyxPQUFPO1lBQUMsT0FBTTtRQUNsQixJQUFJLENBQUMsTUFBTSxHQUFDLElBQUksU0FBUyxDQUFDLHVDQUF1QyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUE7SUFDbkYsQ0FBQztJQUNELCtCQUErQixDQUFDLE1BQWtCLEVBQUMsS0FBYSxFQUFDLEdBQVc7UUFDeEUsTUFBTSxZQUFZLEdBQUMsSUFBSSxTQUFTLENBQUMsdUNBQXVDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUMsR0FBRyxHQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNyRyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBQyxDQUFDLEdBQUcsR0FBQyxLQUFLLENBQUMsR0FBQyxDQUFDLEVBQUMsWUFBWSxDQUFDLENBQUM7UUFDaEQsT0FBTyxJQUFJLENBQUE7SUFDZixDQUFDO0lBQ0QsNEJBQTRCLENBQUMsTUFBa0IsRUFBQyxLQUFhO1FBQ3pELE1BQU0sUUFBUSxHQUFHLHNCQUFzQixDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM3RCxJQUFHLENBQUMsUUFBUTtZQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMsWUFBWSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsS0FBSyx3QkFBd0IsQ0FBQyxDQUFDO1FBRXRGLE1BQU0sUUFBUSxHQUFDLElBQUksUUFBUSxDQUFDLE1BQU0sRUFBQyxLQUFLLENBQUMsQ0FBQTtRQUN6QyxNQUFNLENBQUMsR0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUE7UUFDekIsTUFBTSxXQUFXLEdBQUMsSUFBSSxlQUFlLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBQyxRQUFRLENBQUMsYUFBYSxDQUFDLFlBQVksRUFBQyxRQUFRLENBQUMsTUFBTSxDQUFFLENBQUE7UUFDN0csTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFDLENBQUMsUUFBUSxDQUFDLEdBQUcsR0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUMsQ0FBQyxFQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzFFLE9BQU8sSUFBSSxDQUFBO0lBQ2YsQ0FBQztDQUNKO0FBQ0QsU0FBUyxTQUFTLENBQUMsS0FBWTtJQUMzQixJQUFJLEtBQUssR0FBVSxFQUFFLENBQUM7SUFDdEIsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUNqQixLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksWUFBWSxLQUFLLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7SUFDdkUsQ0FBQyxDQUFDLENBQUM7SUFDSCxPQUFPLEtBQUssQ0FBQztBQUNqQixDQUFDO0FBRUQsU0FBUyxvQkFBb0IsQ0FBQyxJQUFlO0lBQ3pDLE1BQU0sVUFBVSxHQUFDLENBQUMsSUFBZSxFQUFXLEVBQUUsR0FBRSxPQUFPLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQSxDQUFBLENBQUMsQ0FBQTtJQUN2RSxNQUFNLE9BQU8sR0FBQyxDQUFDLElBQWUsRUFBVyxFQUFFLEdBQUUsT0FBTyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUEsQ0FBQSxDQUFDLENBQUE7SUFDdEUsTUFBTSxFQUFFLEdBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUEsRUFBRSxDQUFBLENBQUMsWUFBWSxlQUFlLENBQUMsQ0FBQTtJQUM5RCxJQUFHLENBQUMsRUFBRTtRQUFDLE9BQU07SUFDYixPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBQyxFQUFFLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxFQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQTtJQUN6RTs7aUNBRTZCO0FBRWpDLENBQUM7QUFHRCxNQUFNLGFBQWE7Q0FFbEI7QUFVRCxNQUFNLFVBQVUsWUFBWSxDQUFDLEdBQVE7SUFDakMsSUFBSSxNQUFNLEdBQUcsRUFBRSxDQUFDO0lBQ2hCLElBQUksS0FBSyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUVsRCxPQUFPLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUNsQixNQUFNLElBQUksR0FBRyxLQUFLLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDekIsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDdEIsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDO1FBQ3hCLENBQUM7YUFBTSxDQUFDO1lBQ0osTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN0QixDQUFDO0lBQ0wsQ0FBQztJQUNELE9BQU8sTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDO0FBQzVCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuaW1wb3J0IHsgcXVhZCxjYWxjdWxhdGVCaW5vbSxyb3VuZEJ5U2V0dGluZ3MgLGRlZ3JlZXNUb1JhZGlhbnMscmFkaWFuc1RvRGVncmVlcywgY2FsY3VsYXRlRmFjdG9yaWFsfSBmcm9tIFwiLi9tYXRoVXRpbGl0aWVzXCI7XHJcbmltcG9ydCB7IGV4cGFuZEV4cHJlc3Npb24sY3VybHlCcmFja2V0c1JlZ2V4IH0gZnJvbSBcIi4uL2ltVmVyeUxhenlcIjtcclxuaW1wb3J0IHsgYXJyVG9SZWdleFN0cmluZywgQXhpcywgcmVnRXhwIH0gZnJvbSBcIi4uL3Rpa3pqYXgvdGlrempheFwiO1xyXG5pbXBvcnQgeyBBc3NvY2lhdGl2aXR5IH0gZnJvbSBcInNyYy91dGlscy9zdGF0aWNEYXRhXCI7XHJcbmltcG9ydCB7IGZpbmRQYXJlbkluZGV4LCBQYXJlbixpZFBhcmVudGhlc2VzLCBpc09wZW5QYXJlbiwgZmluZERlZXBlc3RQYXJlbnRoZXNlc1Njb3BlIH0gZnJvbSBcIi4uL3V0aWxzL3Rva2VuVXRlbnNpbHNcIjtcclxuaW1wb3J0IHsgZ2V0QWxsTWF0aEpheFJlZmVyZW5jZXMsIGdldE1hdGhKYXhPcGVyYXRvcnNCeVByaW9yaXR5LCBnZXRPcGVyYXRvcnNCeUFzc29jaWF0aXZpdHksIGdldFZhbHVlc1dpdGhLZXlzQnlTaWRlLCBoYXNJbXBsaWNpdE11bHRpcGxpY2F0aW9uLCBpc09wZXJhdG9yV2l0aEFzc29jaWF0aXZpdHksIHNlYXJjaE1hdGhKYXhPcGVyYXRvcnMgfSBmcm9tIFwiLi4vdXRpbHMvZGF0YU1hbmFnZXJcIjtcclxuaW1wb3J0IHsgTWF0aEdyb3VwLCBNYXRoSmF4T3BlcmF0b3IsIFRva2VuLCBCYXNpY01hdGhKYXhUb2tlbnMsIEJhc2ljTWF0aEpheFRva2VuLCBlbnN1cmVBY2NlcHRhYmxlRm9ybWF0Rm9yTWF0aEdyb3VwSXRlbXMsIGRlZXBTZWFyY2hXaXRoUGF0aCwgTWF0aEdyb3VwSXRlbSB9IGZyb20gXCIuL21hdGhKYXhUb2tlbnNcIjtcclxuaW1wb3J0IHsgc3RhcnQgfSBmcm9tIFwicmVwbFwiO1xyXG5pbXBvcnQgeyBncm91cCB9IGZyb20gXCJjb25zb2xlXCI7XHJcbmNvbnN0IGdyZWVrTGV0dGVycyA9IFtcclxuICAgICdBbHBoYScsJ2FscGhhJywgJ0JldGEnLCAnR2FtbWEnLCAnRGVsdGEnLCAnRXBzaWxvbicsICdaZXRhJywgJ0V0YScsICdUaGV0YScsIFxyXG4gICAgJ0lvdGEnLCAnS2FwcGEnLCAnTGFtYmRhJywgJ011JywnbXUnLCAnTnUnLCAnWGknLCAnT21pY3JvbicsICdQaScsICdSaG8nLCBcclxuICAgICdTaWdtYScsICdUYXUnLCAnVXBzaWxvbicsICdQaGknLCAnQ2hpJywgJ1BzaScsICdPbWVnYSdcclxuXTtcclxuLypjb25zdCBsYXRleE9wZXJhdG9ycz1bXHJcbiAgICAndGFuJywgJ3NpbicsICdjb3MnLCAnYmlub20nLCAnZnJhYycsICdhc2luJywgJ2Fjb3MnLCBcclxuICAgICdhdGFuJywgJ2FyY2NvcycsICdhcmNzaW4nLCAnYXJjdGFuJywgJ2Nkb3QnLCdzcXJ0J1xyXG5dKi9cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBmaW5kQ29uc2VjdXRpdmVTZXF1ZW5jZXMoYXJyOiBhbnlbXSkge1xyXG4gICAgY29uc3Qgc2VxdWVuY2VzID0gW107XHJcbiAgICBsZXQgc3RhcnQgPSAwO1xyXG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gYXJyLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgaWYgKGFycltpXSAhPT0gYXJyW2kgLSAxXSArIDEpIHtcclxuICAgICAgICAgICAgaWYgKGkgLSBzdGFydCA+IDEpIHtcclxuICAgICAgICAgICAgICAgIHNlcXVlbmNlcy5wdXNoKGFyci5zbGljZShzdGFydCwgaSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHN0YXJ0ID0gaTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc2VxdWVuY2VzO1xyXG59XHJcblxyXG5cclxuY29uc3Qgb3BlcmF0b3JzRm9yTWF0aGluZm8gPSB7XHJcbiAgICBib3RoQnV0UmlnaHRCcmFja2V0OiBbXCJeXCJdLFxyXG4gICAgcmlnaHRCcmFja2V0QW5kUmVxdWlyZXNTbGFzaDogW1wic3FydFwiXSxcclxuICAgIGJvdGg6IFtcIitcIiwgXCItXCIsIFwiKlwiXSxcclxuICAgIHNwZWNpYWw6IFtcIj1cIl0sXHJcbiAgICBSaWdodFBhcmVuQW5kUmVxdWlyZXNTbGFzaDogW1wic2luXCIsIFwiY29zXCIsIFwidGFuXCIsIFwiYXNpblwiLCBcImFjb3NcIiwgXCJhdGFuXCIsIFwiYXJjc2luXCIsIFwiYXJjY29zXCIsIFwiYXJjdGFuXCJdLFxyXG4gICAgZG91YmxlUmlnaHRCdXRCcmFja2V0OiBbXCJmcmFjXCIsIFwiYmlub21cIixcIi9cIl1cclxufTtcclxuXHJcblxyXG5leHBvcnQgY2xhc3MgTWF0aEluZm97XHJcbiAgICBkZWJ1Z0luZm86IHN0cmluZz1cIlwiO1xyXG4gICAgc29sdXRpb25JbmZvOiBhbnlbXT1bXTtcclxuICAgIG1hdGhJbmZvOiBhbnlbXT1bXVxyXG4gICAgZ3JhcGg6IHN0cmluZz1cIlwiO1xyXG4gICAgbWF0aFNuYXBzaG90czogTWF0aEdyb3VwW109W11cclxuICAgIGFkZEdyYXBoSW5mbyh2YWx1ZTogc3RyaW5nKXtcclxuICAgICAgICB0aGlzLmdyYXBoKz12YWx1ZTtcclxuICAgIH1cclxuICAgIGFkZERlYnVnSW5mbyhtc2c6IHN0cmluZywgdmFsdWU6IGFueSl7XHJcbiAgICAgICAgdGhpcy5kZWJ1Z0luZm8rPSh0eXBlb2YgbXNnPT09XCJvYmplY3RcIj9KU09OLnN0cmluZ2lmeShtc2csbnVsbCwxKTptc2cpK1wiIDogXCIrKHR5cGVvZiB2YWx1ZT09PVwib2JqZWN0XCI/SlNPTi5zdHJpbmdpZnkodmFsdWUsbnVsbCwxKTp2YWx1ZSkrIFwiXFxuIFwiO1xyXG4gICAgfVxyXG4gICAgYWRkU29sdXRpb25JbmZvKG1lczogc3RyaW5nKXtcclxuICAgICAgICB0aGlzLnNvbHV0aW9uSW5mby5wdXNoKG1lcyk7XHJcbiAgICAgICAgdGhpcy5hZGREZWJ1Z0luZm8oXCJTb2x2ZWRcIixtZXMpO1xyXG4gICAgfVxyXG4gICAgYWRkTWF0aEluZm8obXNnOiBzdHJpbmcpe1xyXG4gICAgICAgIHRoaXMubWF0aEluZm8ucHVzaChtc2cpXHJcbiAgICB9XHJcbiAgICBhZGRNYXRoU25hcHNob3QobWF0aDogTWF0aEdyb3VwKXtcclxuICAgICAgICB0aGlzLm1hdGhTbmFwc2hvdHMucHVzaChtYXRoKVxyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGRlZXBTZWFyY2hXaXRoUGF0aChcclxuICAgICAgICAgICAgbWF0aCxcclxuICAgICAgICAgICAgKGl0ZW0pID0+IGl0ZW0gaW5zdGFuY2VvZiBNYXRoSmF4T3BlcmF0b3IgJiYgaXRlbS5zb2x1dGlvbiAhPT0gdW5kZWZpbmVkXHJcbiAgICAgICAgKTtcclxuICAgICAgICBpZighcmVzdWx0KXJldHVyblxyXG5cclxuICAgICAgICBjb25zdCBjdXN0b21Gb3JtYXR0ZXIgPSAoY2hlY2s6IGFueSxzdHJpbmc6IHN0cmluZyk6IHN0cmluZyA9PiB7XHJcbiAgICAgICAgICAgIGlmIChjaGVjayBpbnN0YW5jZW9mIE1hdGhKYXhPcGVyYXRvciAmJiBjaGVjay5zb2x1dGlvbiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYHtcXFxcY29sb3J7cmVkfSR7c3RyaW5nfX1gO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBzdHJpbmdcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMubWF0aEluZm8ucHVzaChtYXRoLnRvU3RyaW5nKGN1c3RvbUZvcm1hdHRlcikpXHJcbiAgICAgICAgY29uc29sZS5sb2cocmVzdWx0Lml0ZW0pXHJcbiAgICAgICAgdGhpcy5zb2x1dGlvbkluZm8ucHVzaChyZXN1bHQuaXRlbS50b1N0cmluZ1NvbHV0aW9uKCkpXHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuZnVuY3Rpb24gcmVhcnJhbmdlRXF1YXRpb24odG9rZW5zOiBhbnksdG9rZW5Ub2lzb2xhdGU6IGFueSl7XHJcbiAgICBcclxufVxyXG5cclxuZnVuY3Rpb24gaXNvbGF0ZU11bHRpcGxpY2F0aW9uKHRva2VuczogYW55LGlzb2xhdFRva2VuOiBUb2tlbil7LypcclxuICAgIGNvbnN0IGluZGV4PW9wZXJhdGlvbnNPcmRlcih0b2tlbnMpXHJcbiAgICBjb25zdCBJc29sYXRlZD10b2tlbnMudG9rZW5zLmZpbmQoKHRva2VuOiBhbnksIGlkeDogbnVtYmVyKT0+aWR4PGluZGV4KVxyXG4gICAgY29uc3QgZnJhYz1jcmVhdGVGcmFjKHRva2Vucy5saXN0LnNsaWNlKGluZGV4ICsgMSksbmV3IFRva2VuKElzb2xhdGVkLnZhbHVlKSlcclxuICAgIElzb2xhdGVkLnZhbHVlPTE7XHJcbiAgICB0b2tlbnMuaW5zZXJ0VG9rZW5zKGluZGV4KzEsdG9rZW5zLnRva2Vucy5sZW5ndGgtaW5kZXgrMSxmcmFjKSovXHJcbn1cclxuXHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIFBvc2l0aW9uIHtcclxuICAgIG9wZXJhdG9yOiBzdHJpbmc7XHJcbiAgICBpbmRleDogbnVtYmVyO1xyXG4gICAgc3RhcnQ6IG51bWJlcjtcclxuICAgIGVuZDogbnVtYmVyO1xyXG4gICAgdHJhbnNpdGlvbjogbnVtYmVyO1xyXG4gICAgc3BlY2lhbENoYXI6IHN0cmluZztcclxuICAgIFxyXG4gICAgZ3JvdXBzOiBNYXRoR3JvdXBbXTtcclxuICAgIGNvbnN0cnVjdG9yKHRva2VuczogYW55W10sIGluZGV4OiBudW1iZXIpe1xyXG4gICAgICAgIHRoaXMuaW5kZXggPSBpbmRleDtcclxuICAgICAgICB0aGlzLnRyYW5zaXRpb24gPSB0aGlzLmluZGV4O1xyXG4gICAgICAgIHRoaXMuc3RhcnQgPSB0aGlzLmluZGV4O1xyXG4gICAgICAgIHRoaXMuZW5kID0gdGhpcy5pbmRleDtcclxuICAgICAgICB0aGlzLnBvc2l0aW9uKHRva2VucylcclxuICAgIH1cclxuICAgIHBvc2l0aW9uKHRva2VuczogYW55W10pIHtcclxuICAgICAgICB0aGlzLm9wZXJhdG9yID0gdG9rZW5zW3RoaXMuaW5kZXhdLnZhbHVlO1xyXG4gICAgICAgIGNvbnN0IG1ldGFkYXRhID0gc2VhcmNoTWF0aEpheE9wZXJhdG9ycyh0aGlzLm9wZXJhdG9yKTtcclxuICAgICAgICBpZiAoIW1ldGFkYXRhKSB0aHJvdyBuZXcgRXJyb3IoYE9wZXJhdG9yICR7dGhpcy5vcGVyYXRvcn0gbm90IGZvdW5kIGluIG1ldGFkYXRhYCk7XHJcbiAgICBcclxuICAgICAgICBjb25zdCBiZWZvcmVJbmRleDogTWF0aEdyb3VwW10gPSBbXTtcclxuICAgICAgICBjb25zdCBhZnRlckluZGV4OiAgTWF0aEdyb3VwW10gPSBbXTtcclxuICAgIFxyXG4gICAgICAgIGdldFZhbHVlc1dpdGhLZXlzQnlTaWRlKG1ldGFkYXRhLmFzc29jaWF0aXZpdHkucG9zaXRpb25zLCB0cnVlKS5mb3JFYWNoKCgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuYXBwbHlQb3NpdGlvbih0b2tlbnMsIHRoaXMuc3RhcnQsIHRydWUpO1xyXG4gICAgICAgICAgICBiZWZvcmVJbmRleC5wdXNoKGl0ZW0ubWF0aEdyb3VwKTtcclxuICAgICAgICAgICAgdGhpcy5zdGFydCA9IGl0ZW0ubGFzdEl0ZW1PZlByZXZpb3VzO1xyXG4gICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICBcclxuICAgICAgICBnZXRWYWx1ZXNXaXRoS2V5c0J5U2lkZShtZXRhZGF0YS5hc3NvY2lhdGl2aXR5LnBvc2l0aW9ucywgZmFsc2UpLmZvckVhY2goKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5hcHBseVBvc2l0aW9uKHRva2VucywgdGhpcy5lbmQsIGZhbHNlKTtcclxuICAgICAgICAgICAgYWZ0ZXJJbmRleC5wdXNoKGl0ZW0ubWF0aEdyb3VwKTtcclxuICAgICAgICAgICAgdGhpcy5lbmQgPSBpdGVtLmxhc3RJdGVtT2ZQcmV2aW91cztcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmdyb3VwcyA9IGJlZm9yZUluZGV4LnJldmVyc2UoKS5jb25jYXQoYWZ0ZXJJbmRleCk7XHJcbiAgICB9XHJcbiAgICBhcHBseVBvc2l0aW9uKHRva2VuczogYW55W10sIGluZGV4OiAgbnVtYmVyLCBpc0xlZnQ6IGJvb2xlYW4pIHtcclxuICAgICAgICBsZXQgYnJlYWtDaGFyPWluZGV4XHJcbiAgICAgICAgbGV0IHRhcmdldDogYW55O1xyXG4gICAgICAgIGNvbnN0IG1vZGlmaWVkSW5kZXggPSAgaW5kZXgrKGlzTGVmdD8tIDEgOiAgMSk7XHJcblxyXG4gICAgICAgIGlmICgoaXNMZWZ0ICYmIGluZGV4IDw9IDApIHx8ICghaXNMZWZ0ICYmIGluZGV4ID49IHRva2Vucy5sZW5ndGggLSAxKSB8fCAhdG9rZW5zW21vZGlmaWVkSW5kZXhdKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImF0IGFwcGx5UG9zaXRpb246IFxcXCJpbmRleCB3YXNuJ3QgdmFsaWRcXFwiIGluZGV4OiBcIitpbmRleCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodG9rZW5zW21vZGlmaWVkSW5kZXhdIGluc3RhbmNlb2YgUGFyZW4pIHtcclxuICAgICAgICAgICAgY29uc3QgcGFyZW5JbmRleCA9IGZpbmRQYXJlbkluZGV4KHRva2Vuc1ttb2RpZmllZEluZGV4XSx0b2tlbnMpO1xyXG4gICAgICAgICAgICBicmVha0NoYXIgPSAgaXNMZWZ0ID8gcGFyZW5JbmRleC5vcGVuIDogcGFyZW5JbmRleC5jbG9zZSsxO1xyXG4gICAgICAgICAgICAvLyBJbnN1cmUgcHJvcGVyIGZvcm1hdHRpbmcgcmVtb3ZlZCBldmVyeXRoaW5nIGluY2x1ZGluZyBwYXJlbnRoZXNlc1xyXG4gICAgICAgICAgICB0YXJnZXQgPSBlbnN1cmVBY2NlcHRhYmxlRm9ybWF0Rm9yTWF0aEdyb3VwSXRlbXModG9rZW5zLnNsaWNlKHBhcmVuSW5kZXgub3BlbiwgcGFyZW5JbmRleC5jbG9zZSsxKSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYnJlYWtDaGFyPW1vZGlmaWVkSW5kZXg7XHJcbiAgICAgICAgICAgIHRhcmdldCA9IGVuc3VyZUFjY2VwdGFibGVGb3JtYXRGb3JNYXRoR3JvdXBJdGVtcyh0b2tlbnNbYnJlYWtDaGFyXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0YXJnZXQ/Lmxlbmd0aD09PTApIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBhdCBhcHBseVBvc2l0aW9uOiBjb3VsZG4ndCBmaW5kIHRhcmdldCB0b2tlbiBmb3IgZGlyZWN0aW9uICR7aXNMZWZ0PydsZWZ0JzoncmlnaHQnfSBhbmQgb3BlcmF0b3JcIiR7dG9rZW5zW2luZGV4XS52YWx1ZX1cImAsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vTWFrZSBzdXJlIHdlIGRvbid0IGNyZWF0ZSBkdXBsaWNhdGUgaW50ZXJsb2NrZWQgbWF0aCBncm91cHNcclxuICAgICAgICBpZih0YXJnZXQ/Lmxlbmd0aCYmdGFyZ2V0Py5sZW5ndGg9PT0xJiZ0YXJnZXRbMF1pbnN0YW5jZW9mIE1hdGhHcm91cCl7XHJcbiAgICAgICAgICAgIHRhcmdldD10YXJnZXRbMF1cclxuICAgICAgICAgICAgdGFyZ2V0LnRyeVJlbW92ZVVubmVjZXNzYXJ5TmVzdGVkKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBtYXRoR3JvdXA6IG5ldyBNYXRoR3JvdXAodGFyZ2V0KSxcclxuICAgICAgICAgICAgbGFzdEl0ZW1PZlByZXZpb3VzOiBicmVha0NoYXIsXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gcGFyc2VTYWZldHlDaGVja3Mob3BlcmF0b3I6IE1hdGhKYXhPcGVyYXRvcil7XHJcbiAgICBpZiAob3BlcmF0b3IuZ3JvdXBOdW0hPT1vcGVyYXRvci5ncm91cHMubGVuZ3RoKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIG51bWJlciBvZiBncm91cHMgZm9yIG9wZXJhdG9yICR7b3BlcmF0b3Iub3BlcmF0b3J9IGV4cGVjdGVkICR7b3BlcmF0b3IuZ3JvdXBOdW19IGJ1dCBnb3QgJHtvcGVyYXRvci5ncm91cHMubGVuZ3RofWApO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VPcGVyYXRvcihvcGVyYXRvcjogTWF0aEpheE9wZXJhdG9yKTogYm9vbGVhbiB7XHJcbiAgICBwYXJzZVNhZmV0eUNoZWNrcyhvcGVyYXRvcik7IFxyXG4gICAgZnVuY3Rpb24gZ2V0T3BlcmFibGVWYWx1ZShncm91cDogTWF0aEdyb3VwKTogbnVtYmVyIHwgbnVsbCB7XHJcbiAgICAgICAgaWYgKCFncm91cHx8IWdyb3VwLmlzT3BlcmFibGUoKSkgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSBncm91cC5nZXRPcGVyYWJsZVZhbHVlKCk7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlJiYhdmFsdWU/LmlzVmFyKCk/dmFsdWUuZ2V0TnVtYmVyVmFsdWUoKSA6IG51bGw7XHJcbiAgICB9XHJcbiAgICBjb25zdCBncm91cDEgPSBnZXRPcGVyYWJsZVZhbHVlKG9wZXJhdG9yLmdyb3Vwc1swXSk7XHJcbiAgICBjb25zdCBncm91cDIgPSBnZXRPcGVyYWJsZVZhbHVlKG9wZXJhdG9yLmdyb3Vwc1sxXSk7XHJcbiAgICBpZiAoZ3JvdXAxID09PSBudWxsfHwoZ3JvdXAyPT09bnVsbCYmb3BlcmF0b3IuZ3JvdXBzLmxlbmd0aD4xKSkgcmV0dXJuIGZhbHNlO1xyXG4gICAgXHJcbiAgICBzd2l0Y2ggKG9wZXJhdG9yLm9wZXJhdG9yKSB7XHJcbiAgICAgICAgY2FzZSBcIlNpbmVcIjpcclxuICAgICAgICAgICAgb3BlcmF0b3Iuc29sdXRpb24gPSBuZXcgTWF0aEdyb3VwKFtuZXcgVG9rZW4oTWF0aC5zaW4oZGVncmVlc1RvUmFkaWFucyhncm91cDEpKSldKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBcIlNxdWFyZVJvb3RcIjpcclxuICAgICAgICAgICAgaWYgKGdyb3VwMSA8IDApIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBjYWxjdWxhdGUgdGhlIHNxdWFyZSByb290IG9mIGEgbmVnYXRpdmUgbnVtYmVyLlwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvcGVyYXRvci5zb2x1dGlvbiA9IG5ldyBNYXRoR3JvdXAoW25ldyBUb2tlbihNYXRoLnBvdyhncm91cDEsMC41KSldKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBcIkZyYWN0aW9uXCI6IHtcclxuICAgICAgICAgICAgaWYgKGdyb3VwMiA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRGl2aXNpb24gYnkgemVybyBpcyBub3QgYWxsb3dlZFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvcGVyYXRvci5zb2x1dGlvbiA9IG5ldyBNYXRoR3JvdXAoW25ldyBUb2tlbihncm91cDEgLyBncm91cDIhKV0pO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FzZSBcIlBvd2VyXCI6IHtcclxuICAgICAgICAgICAgb3BlcmF0b3Iuc29sdXRpb24gPSBuZXcgTWF0aEdyb3VwKFtuZXcgVG9rZW4oTWF0aC5wb3coZ3JvdXAxLGdyb3VwMiEpKV0pO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FzZSBcIk11bHRpcGxpY2F0aW9uXCI6IHtcclxuICAgICAgICAgICAgb3BlcmF0b3Iuc29sdXRpb24gPSBuZXcgTWF0aEdyb3VwKFtuZXcgVG9rZW4oZ3JvdXAxICogZ3JvdXAyISldKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcclxuICAgICAgICAgICAgICAgIGBVbmtub3duIG9wZXJhdG9yIHR5cGUgaW4gcGFyc2VPcGVyYXRvcjogJHtvcGVyYXRvci5vcGVyYXRvcn1gXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbn1cclxuXHJcblxyXG5cclxuXHJcbmZ1bmN0aW9uIG9wZXJhdGlvbnNPcmRlcih0b2tlbnM6IGFueVtdKSB7XHJcbiAgICBmdW5jdGlvbiBmaW5kT3BlcmF0b3JJbmRleChiZWdpbjogbnVtYmVyLCBlbmQ6IG51bWJlciwgdG9rZW5zOiBhbnksIHJlZ2V4PzogYW55KSB7XHJcbiAgICAgICAgY29uc3QgaW5kZXg9dG9rZW5zLnNsaWNlKGJlZ2luLCBlbmQpLmZpbmRJbmRleCgodG9rZW46IHsgdHlwZTogc3RyaW5nOyB2YWx1ZTogYW55OyB9KSA9PiB0b2tlbi50eXBlID09PSBcIm9wZXJhdG9yXCIgJiYgcmVnZXgudGVzdCh0b2tlbi52YWx1ZSkpO1xyXG4gICAgICAgIHJldHVybiBpbmRleD4tMT9pbmRleCtiZWdpbjpudWxsO1xyXG4gICAgfVxyXG4gICAgY29uc3QgeyBiZWdpbiwgZW5kIH0gPSBmaW5kRGVlcGVzdFBhcmVudGhlc2VzU2NvcGUodG9rZW5zKTtcclxuICAgIGxldCBwcmlvcml0eT1udWxsXHJcbiAgICBmb3IgKGxldCBpPTE7aTw9NjtpKyspe1xyXG4gICAgICAgIHByaW9yaXR5ID0gZmluZE9wZXJhdG9ySW5kZXgoYmVnaW4gLCBlbmQsdG9rZW5zLCBnZXRNYXRoSmF4T3BlcmF0b3JzQnlQcmlvcml0eShpLHRydWUpKTtcclxuICAgICAgICBpZihwcmlvcml0eSE9PW51bGwpYnJlYWs7XHJcbiAgICB9XHJcbiAgICByZXR1cm4ge3N0YXJ0OiBiZWdpbixlbmQ6IGVuZCxzcGVjaWZpY09wZXJhdG9ySW5kZXg6IHByaW9yaXR5fVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgTWF0aFByYWlzZXJ7XHJcbiAgICBpbnB1dD1cIlwiO1xyXG4gICAgdG9rZW5zOiBNYXRoR3JvdXA7XHJcbiAgICBzb2x1dGlvbjogYW55O1xyXG4gICAgbWF0aEluZm89bmV3IE1hdGhJbmZvKCk7XHJcbiAgICBjb25zdHJ1Y3RvcihpbnB1dDogc3RyaW5nKXtcclxuICAgICAgICB0aGlzLmlucHV0PWlucHV0O1xyXG4gICAgICAgIHRoaXMucHJvY2Vzc0lucHV0KCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3QgdG9rZW5zPW5ldyBCYXNpY01hdGhKYXhUb2tlbnMoKTtcclxuICAgICAgICB0b2tlbnMuYWRkSW5wdXQodGhpcy5pbnB1dClcclxuICAgICAgICBjb25zdCBiYXNpY1Rva2Vucz10b2tlbnMudG9rZW5zXHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy5jb252ZXJ0QmFzaWNNYXRoSmF4VG9rZW5hVG9NYXRoR3JvdXAoYmFzaWNUb2tlbnMpXHJcbiAgICAgICAgdGhpcy5hZGREZWJ1Z0luZm8oXCJjb252ZXJ0QmFzaWNNYXRoSmF4VG9rZW5hVG9NYXRoR3JvdXBcIix0aGlzLnRva2VucylcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLmlucHV0PXRoaXMudG9rZW5zLnRvU3RyaW5nKClcclxuICAgICAgICB0aGlzLmNvbnRyb2xsZXIoKTtcclxuICAgICAgICB0aGlzLnNvbHV0aW9uPXRoaXMudG9rZW5zXHJcbiAgICAgICAgdGhpcy5hZGREZWJ1Z0luZm8oXCJzb2x1dGlvblwiLHRoaXMuc29sdXRpb24pO1xyXG4gICAgfVxyXG5cclxuICAgIFxyXG4gICAgcGFyc2UodG9rZW5zOiBNYXRoR3JvdXApOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBvcGVyYXRvckluZGV4PXRva2Vucy5nZXRJdGVtcygpLmZpbmRJbmRleChcclxuICAgICAgICAgICAgdCA9PiB0IGluc3RhbmNlb2YgTWF0aEpheE9wZXJhdG9yICYmIHQuaXNPcGVyYWJsZVxyXG4gICAgICAgICkgO1xyXG4gICAgICAgIGlmIChvcGVyYXRvckluZGV4PDApIHJldHVybjtcclxuICAgICAgICBjb25zdCBvcGVyYXRvciA9IHRva2Vucy5nZXRJdGVtcygpW29wZXJhdG9ySW5kZXhdIGFzIE1hdGhKYXhPcGVyYXRvclxyXG4gICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgb3BlcmF0b3IuZ3JvdXBzLmZvckVhY2goZ3JvdXAgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnBhcnNlKGdyb3VwKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBwYXJzZU9wZXJhdG9yKG9wZXJhdG9yKVxyXG4gICAgICAgIGlmICghb3BlcmF0b3Iuc29sdXRpb24pIHtcclxuICAgICAgICAgICAgb3BlcmF0b3IuaXNPcGVyYWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubWF0aEluZm8uYWRkTWF0aFNuYXBzaG90KHRoaXMudG9rZW5zLmNsb25lKCkpXHJcbiAgICAgICAgdG9rZW5zLnNldEl0ZW0ob3BlcmF0b3Iuc29sdXRpb24sb3BlcmF0b3JJbmRleCk7IFxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBjb250cm9sbGVyKCk6IGFueXtcclxuICAgICAgICB0aGlzLnBhcnNlKHRoaXMudG9rZW5zKVxyXG4gICAgICAgIGNvbWJpbmVTaW1pbGFyVmFsdWVzKHRoaXMudG9rZW5zKVxyXG4gICAgICAgIHRoaXMudG9rZW5zLnJlbW92ZU5lc3RlZCgpXHJcbiAgICAgICAgdGhpcy50b2tlbnMuY29tYmluaW5nTGlrZVRlcm1zKClcclxuXHJcbiAgICB9XHJcbiAgICBzb2x1dGlvblRvU3RyaW5nKCl7XHJcbiAgICAgICAgcmV0dXJuICh0aGlzLnRva2Vucy50b1N0cmluZygpKXx8XCJcIlxyXG4gICAgfVxyXG5cclxuICAgIGFkZERlYnVnSW5mbyhtZXM6IHN0cmluZyx2YWx1ZTogYW55KXtcclxuICAgICAgICB0aGlzLm1hdGhJbmZvLmFkZERlYnVnSW5mbyhtZXMsdmFsdWUpXHJcbiAgICB9XHJcbiAgICBwcm9jZXNzSW5wdXQoKXtcclxuICAgICAgICB0aGlzLmlucHV0PXRoaXMuaW5wdXRcclxuICAgICAgICAucmVwbGFjZSgvKE1hdGgufFxcXFx8XFxzfGxlZnR8cmlnaHQpL2csIFwiXCIpIFxyXG4gICAgICAgIC5yZXBsYWNlKC97L2csIFwiKFwiKVxyXG4gICAgICAgIC5yZXBsYWNlKC99L2csIFwiKVwiKVxyXG4gICAgICAgIC8vLnJlcGxhY2UoLyg/PCFcXFxcfFthLXpBLVpdKSh0YW58c2lufGNvc3xiaW5vbXxmcmFjfGFzaW58YWNvc3xhdGFufGFyY2Nvc3xhcmNzaW58YXJjdGFufGNkb3QpL2csIFwiXFxcXCQxXCIpO1xyXG4gICAgfVxyXG4gICAgZmluYWxSZXR1cm4oKXtcclxuICAgICAgIC8vIHJldHVybiB0aGlzLnRva2Vucy5yZWNvbnN0cnVjdCgpXHJcbiAgICB9XHJcbiAgICBkZWZpbmVHcm91cHNBbmRPcGVyYXRvcnModG9rZW5zOiBBcnJheTxhbnk+KTpib29sZWFufHRoaXN7XHJcbiAgICAgICAgY29uc3QgcmFuZ2U9b3BlcmF0aW9uc09yZGVyKHRva2Vucyk7XHJcbiAgICAgICAgaWYocmFuZ2Uuc3RhcnQ9PT1udWxsfHxyYW5nZS5lbmQ9PT1udWxsKXJldHVybiBmYWxzZTtcclxuICAgICAgICBpZihyYW5nZS5zcGVjaWZpY09wZXJhdG9ySW5kZXg9PT1udWxsJiZyYW5nZS5zdGFydD09PTAmJnJhbmdlLmVuZD09PXRva2Vucy5sZW5ndGgpcmV0dXJuIHRydWU7XHJcbiAgICAgICAgbGV0IG5ld01hdGhHcm91cFN1Y2Nlc3M9bnVsbFxyXG4gICAgICAgIGlmIChyYW5nZS5zcGVjaWZpY09wZXJhdG9ySW5kZXghPT1udWxsKVxyXG4gICAgICAgICAgICBuZXdNYXRoR3JvdXBTdWNjZXNzPXRoaXMuY3JlYXRlT3BlcmF0b3JJdGVtRnJvbVRva2Vucyh0b2tlbnMscmFuZ2Uuc3BlY2lmaWNPcGVyYXRvckluZGV4KVxyXG4gICAgICAgIGVsc2VcclxuICAgICAgICBuZXdNYXRoR3JvdXBTdWNjZXNzPXRoaXMuY3JlYXRlTWF0aEdyb3VwSW5zZXJ0RnJvbVRva2Vucyh0b2tlbnMscmFuZ2Uuc3RhcnQscmFuZ2UuZW5kKVxyXG4gICAgICAgIGlmKCFuZXdNYXRoR3JvdXBTdWNjZXNzKXJldHVybiBmYWxzZTtcclxuICAgICAgICByZXR1cm4gdGhpcy5kZWZpbmVHcm91cHNBbmRPcGVyYXRvcnModG9rZW5zKTtcclxuICAgIH1cclxuICAgIGNvbnZlcnRCYXNpY01hdGhKYXhUb2tlbmFUb01hdGhHcm91cChiYXNpY1Rva2VuczogQXJyYXk8QmFzaWNNYXRoSmF4VG9rZW58UGFyZW4+KTp2b2lke1xyXG4gICAgICAgIGNvbnN0IHN1Y2Nlc3M9dGhpcy5kZWZpbmVHcm91cHNBbmRPcGVyYXRvcnMoYmFzaWNUb2tlbnMpXHJcbiAgICAgICAgaWYoIXN1Y2Nlc3MpcmV0dXJuXHJcbiAgICAgICAgdGhpcy50b2tlbnM9bmV3IE1hdGhHcm91cChlbnN1cmVBY2NlcHRhYmxlRm9ybWF0Rm9yTWF0aEdyb3VwSXRlbXMoYmFzaWNUb2tlbnMpKVxyXG4gICAgfVxyXG4gICAgY3JlYXRlTWF0aEdyb3VwSW5zZXJ0RnJvbVRva2Vucyh0b2tlbnM6IEFycmF5PGFueT4sc3RhcnQ6IG51bWJlcixlbmQ6IG51bWJlcik6Ym9vbGVhbntcclxuICAgICAgICBjb25zdCBuZXdNYXRoR3JvdXA9bmV3IE1hdGhHcm91cChlbnN1cmVBY2NlcHRhYmxlRm9ybWF0Rm9yTWF0aEdyb3VwSXRlbXModG9rZW5zLnNsaWNlKHN0YXJ0LGVuZCsxKSkpO1xyXG4gICAgICAgIHRva2Vucy5zcGxpY2Uoc3RhcnQsKGVuZC1zdGFydCkrMSxuZXdNYXRoR3JvdXApO1xyXG4gICAgICAgIHJldHVybiB0cnVlXHJcbiAgICB9XHJcbiAgICBjcmVhdGVPcGVyYXRvckl0ZW1Gcm9tVG9rZW5zKHRva2VuczogQXJyYXk8YW55PixpbmRleDogbnVtYmVyKTpib29sZWFue1xyXG4gICAgICAgIGNvbnN0IG1ldGFkYXRhID0gc2VhcmNoTWF0aEpheE9wZXJhdG9ycyh0b2tlbnNbaW5kZXhdLnZhbHVlKTtcclxuICAgICAgICBpZighbWV0YWRhdGEpdGhyb3cgbmV3IEVycm9yKGBPcGVyYXRvciAke3Rva2Vuc1tpbmRleF0udmFsdWV9IG5vdCBmb3VuZCBpbiBtZXRhZGF0YWApO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnN0IHBvc2l0aW9uPW5ldyBQb3NpdGlvbih0b2tlbnMsaW5kZXgpXHJcbiAgICAgICAgY29uc3QgYz1kZWVwQ2xvbmUodG9rZW5zKVxyXG4gICAgICAgIGNvbnN0IG5ld09wZXJhdG9yPW5ldyBNYXRoSmF4T3BlcmF0b3IocG9zaXRpb24ub3BlcmF0b3IsbWV0YWRhdGEuYXNzb2NpYXRpdml0eS5udW1Qb3NpdGlvbnMscG9zaXRpb24uZ3JvdXBzLClcclxuICAgICAgICB0b2tlbnMuc3BsaWNlKHBvc2l0aW9uLnN0YXJ0LChwb3NpdGlvbi5lbmQtcG9zaXRpb24uc3RhcnQpKzEsbmV3T3BlcmF0b3IpO1xyXG4gICAgICAgIHJldHVybiB0cnVlXHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gZGVlcENsb25lKGl0ZW1zOiBhbnlbXSkge1xyXG4gICAgbGV0IGNsb25lOiBhbnlbXSA9IFtdO1xyXG4gICAgaXRlbXMuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICBjbG9uZS5wdXNoKGl0ZW0gaW5zdGFuY2VvZiBBcnJheSA/IGRlZXBDbG9uZShpdGVtKSA6IGl0ZW0uY2xvbmUoKSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBjbG9uZTtcclxufVxyXG5cclxuZnVuY3Rpb24gY29tYmluZVNpbWlsYXJWYWx1ZXMobWF0aDogTWF0aEdyb3VwKXtcclxuICAgIGNvbnN0IHRlc3RMZXZlbHM9KGl0ZW06IE1hdGhHcm91cCk6IGJvb2xlYW4gPT4ge3JldHVybiBpdGVtLnNpbmd1bGFyKCl9XHJcbiAgICBjb25zdCB0ZXN0VmFyPShpdGVtOiBNYXRoR3JvdXApOiBib29sZWFuID0+IHtyZXR1cm4gaXRlbS5udW1iZXJPbmx5KCl9XHJcbiAgICBjb25zdCBvcD1tYXRoLmdldEl0ZW1zKCkuZmluZCh0PT50IGluc3RhbmNlb2YgTWF0aEpheE9wZXJhdG9yKVxyXG4gICAgaWYoIW9wKXJldHVyblxyXG4gICAgY29uc29sZS5sb2coJ01hdGhHcm91cCcsb3AudGVzdEdyb3Vwcyh0ZXN0TGV2ZWxzKSxvcC50ZXN0R3JvdXBzKHRlc3RWYXIpKVxyXG4gICAgLypjb25zdCBhPW5ldyBNYXRoT3ZlcnZpZXcoKVxyXG4gICAgYS5kZWZpbmVHbG9iYWxPdmVydmlldyhtYXRoLmdldEl0ZW1zKCkpXHJcbiAgICBhLnNlcGFyYXRlSW50b0luZGl2aWR1YWxzKCkqL1xyXG5cclxufVxyXG5cclxuXHJcbmNsYXNzIG1hdGhWYXJpYWJsZXN7XHJcblxyXG59XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBmbGF0dGVuQXJyYXkoYXJyOiBhbnkpIHtcclxuICAgIGxldCByZXN1bHQgPSBbXTtcclxuICAgIGxldCBzdGFjayA9IEFycmF5LmlzQXJyYXkoYXJyKSA/IFsuLi5hcnJdIDogW2Fycl07XHJcblxyXG4gICAgd2hpbGUgKHN0YWNrLmxlbmd0aCkge1xyXG4gICAgICAgIGNvbnN0IG5leHQgPSBzdGFjay5wb3AoKTtcclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShuZXh0KSkge1xyXG4gICAgICAgICAgICBzdGFjay5wdXNoKC4uLm5leHQpOyBcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXN1bHQucHVzaChuZXh0KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0LnJldmVyc2UoKTtcclxufVxyXG4iXX0=