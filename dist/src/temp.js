import { Setting, Modal, Notice } from "obsidian";
import { createTextInputSetting } from "./settings";
import { Axis, Coordinate, FormatTikzjax, Formatting } from "./tikzjax/tikzjax";
export class VecInputModel extends Modal {
    plugin;
    plusX = true;
    plusY = true;
    obj = 0;
    ang = 0;
    constructor(app, plugin) {
        super(app);
        this.plugin = plugin;
    }
    onOpen() {
        const { contentEl } = this;
        contentEl.createEl("h2", { text: "Vector Input from Enter Mass:" });
        // Create containers
        const inputContainer = contentEl.createDiv("vec-input-fields-container");
        const scriptContainer = contentEl.createDiv("script-container");
        // Render fields and initial graph
        this.renderFields(inputContainer, scriptContainer);
        setTimeout(() => {
            this.updateGraph(scriptContainer);
        }, 50);
    }
    renderFields(inputContainer, scriptContainer) {
        // Clear previous fields if any
        inputContainer.findAll(".field").forEach(el => el.remove());
        // Toggle for X-Axis Reverse
        new Setting(inputContainer)
            .addToggle(toggle => toggle
            .setTooltip("Toggle X-Axis Reverse")
            .setValue(this.plusX)
            .onChange(value => {
            this.plusX = value;
            this.updateGraph(scriptContainer);
        })).settingEl.addClass("field");
        // Toggle for Y-Axis Reverse
        new Setting(inputContainer)
            .addToggle(toggle => toggle
            .setTooltip("Toggle Y-Axis Reverse")
            .setValue(this.plusY)
            .onChange(value => {
            this.plusY = value;
            this.updateGraph(scriptContainer);
        })).settingEl.addClass("field");
        // Text input for mass
        new Setting(inputContainer)
            .setName("Enter Mass")
            .setDesc("Enter the mass you want to evaluate")
            .addText(text => {
            text.onChange(async (value) => {
                const massValue = Number(value);
                if (!isNaN(massValue)) {
                    this.obj = massValue;
                    this.updateGraph(scriptContainer);
                }
            });
        }).settingEl.addClass("field");
    }
    updateGraph(container) {
        container.empty();
        requestAnimationFrame(() => {
            try {
                const mass = new Coordinate({
                    mode: "node",
                    label: `${this.obj}n`,
                    axis: new Axis(this.plusX ? 1 : -1, this.plusY ? 1 : -1),
                    formatting: new Formatting("node", { tikzset: "mass" })
                });
                const tikz = new FormatTikzjax([mass]);
                const script = container.createEl("script");
                script.setAttribute("type", "text/tikz");
                script.setAttribute("data-show-console", "true");
                script.setText(tikz.getCode());
                console.log(script);
                container.appendChild(script);
            }
            catch (e) {
                console.error("Graph rendering error:", e);
            }
        });
    }
}
export class InputModal extends Modal {
    plugin;
    userChoice = 0;
    userSidesInput = "";
    userAnglesInput = "";
    resultContainer;
    shapesCharacteristics;
    evaledUserInputInfo = null;
    savedValues = {};
    constructor(app, plugin) {
        super(app);
        this.plugin = plugin;
    }
    onOpen() {
        const { contentEl } = this;
        contentEl.createEl("h2", { text: "Enter Math Expression" });
        const dynamicFieldContainer = contentEl.createDiv({ cls: "dynamic-field-container" });
        const tikzGraphContainer = contentEl.createDiv({ cls: "tikz-graph-container" });
        const submitButton = contentEl.createEl("button", { text: "Submit", attr: { disabled: "true" } });
        const temporaryDebugArea = contentEl.createDiv({ cls: "temporary-debug-area" });
        submitButton.addEventListener("click", () => {
            if (this.evaledUserInputInfo && this.evaledUserInputInfo.meetsMinRequirements) {
                this.handleSubmit();
            }
            else {
                new Notice("Please enter valid input.");
            }
        });
        this.userChoice = 0;
        this.renderDynamicFields(dynamicFieldContainer);
        dynamicFieldContainer.addEventListener("input", () => {
            if (this.evaledUserInputInfo.meetsMinRequirements) {
                submitButton.removeAttribute("disabled");
                tikzGraphContainer.empty();
                temporaryDebugArea.empty();
            }
            else {
                submitButton.setAttribute("disabled", "true");
            }
        });
    }
    renderDynamicFields(container) {
        container.findAll(".dynamic-field").forEach(el => el.remove());
        this.userSidesInput = createTextInputSetting(container, "Coordinates", "Enter ${shape.coordinates}", "", "", "dynamic-field") || "";
        this.userSidesInput = createTextInputSetting(container, "Coordinates", "Enter ${shape.coordinates}", "", "", "dynamic-field") || "";
        new Setting(container)
            .addButton(button => button
            .setButtonText("add vec")
            .setTooltip("add a vecter")
            .onClick(() => {
            this.renderDynamicFields(container);
        }))
            .settingEl.addClass("dynamic-field");
        new Setting(container)
            .addButton(button => button
            .setButtonText("Clear")
            .setTooltip("Clear all previous fields")
            .onClick(() => {
            this.renderDynamicFields(container);
        }))
            .settingEl.addClass("dynamic-field");
    }
    handleSubmit() {
        const result = this.evaledUserInputInfo;
        this.resultContainer.textContent = JSON.stringify(result);
        this.plugin.settings.sessionHistory.push({
            input: this.userAnglesInput,
            result: result
        });
        this.plugin.saveSettings();
    }
    onClose() {
        const { contentEl } = this;
        contentEl.empty();
    }
}
export class CustomInputModal extends Modal {
    plugin;
    userChoice = 0;
    userSidesInput = "";
    userAnglesInput = "";
    resultContainer;
    shapesCharacteristics;
    evaledUserInputInfo = null;
    savedValues = {};
    constructor(app, plugin) {
        super(app);
        this.plugin = plugin;
    }
    onOpen() {
        const { contentEl } = this;
        contentEl.createEl("h2", { text: "Enter Math Expression" });
        // Assign shapesCharacteristics globally
        const settingsContainer = contentEl.createDiv({ cls: "settings-container" });
        const dynamicFieldContainer = contentEl.createDiv({ cls: "dynamic-field-container" });
        const tikzGraphContainer = contentEl.createDiv({ cls: "dynamic-field-container" });
        const submitButton = contentEl.createEl("button", { text: "Submit", attr: { disabled: "true" } });
        const temporaryDebugArea = contentEl.createDiv({ cls: "temporary-debug-area" });
        submitButton.addEventListener("click", () => {
            if (this.evaledUserInputInfo && this.evaledUserInputInfo.meetsMinRequirements) {
                this.handleSubmit();
            }
            else {
                new Notice("Please enter valid input.");
            }
        });
        new Setting(settingsContainer)
            .setName("Choose shape")
            .setDesc("Select the shape to perform the operations on.")
            .addDropdown(dropdown => {
            this.shapesCharacteristics.forEach((shape, index) => {
                dropdown.addOption(index.toString(), shape.name);
            });
            this.userChoice = 0;
            this.renderDynamicFields(dynamicFieldContainer);
            dropdown.onChange(value => {
                this.userChoice = Number(value);
                this.renderDynamicFields(dynamicFieldContainer);
            });
        });
        contentEl.addEventListener("input", () => {
            this.evaledUserInputInfo = this.testMinInputRequirements();
            if (this.evaledUserInputInfo.meetsMinRequirements) {
                submitButton.removeAttribute("disabled");
                tikzGraphContainer.empty();
                temporaryDebugArea.empty();
            }
            else {
                submitButton.setAttribute("disabled", "true");
            }
        });
    }
    renderDynamicFields(container) {
    }
    testMinInputRequirements() {
        return { meetsMinRequirements: true, shape: "shapeName", coordinates: [], sides: {}, angles: [] };
    }
    handleSubmit() {
        const result = this.evaledUserInputInfo;
        this.resultContainer.textContent = JSON.stringify(result);
        this.plugin.settings.sessionHistory.push({
            input: this.userAnglesInput,
            result: result
        });
        this.plugin.saveSettings();
    }
    onClose() {
        const { contentEl } = this;
        contentEl.empty();
    }
}
export class HistoryModal extends Modal {
    plugin;
    constructor(app, plugin) {
        super(app);
        this.plugin = plugin;
    }
    onOpen() {
        const { contentEl } = this;
        contentEl.createEl("h2", { text: "Session History" });
        // If there is no history, display a message
        if (this.plugin.settings.sessionHistory.length === 0) {
            contentEl.createEl("p", { text: "No session history found." });
            return;
        }
        // Display each session in the history
        this.plugin.settings.sessionHistory.forEach((session, index) => {
            const sessionDiv = contentEl.createEl("div", { cls: "history-session" });
            sessionDiv.createEl("h3", { text: `Session ${index + 1}` });
            sessionDiv.createEl("p", { text: `Input: ${session.input}` });
            sessionDiv.createEl("p", { text: `Result: ${session.result}` });
        });
        // Close button
        const closeButton = contentEl.createEl("button", { text: "Close" });
        closeButton.addEventListener("click", () => {
            this.close();
        });
    }
    onClose() {
        const { contentEl } = this;
        contentEl.empty(); // Clean up modal content on close
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVtcC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90ZW1wLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBK0MsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQXFDLE1BQU0sVUFBVSxDQUFDO0FBRWxJLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUNwRCxPQUFPLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxhQUFhLEVBQUUsVUFBVSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFJaEYsTUFBTSxPQUFPLGFBQWMsU0FBUSxLQUFLO0lBQ3RDLE1BQU0sQ0FBYTtJQUNuQixLQUFLLEdBQVksSUFBSSxDQUFDO0lBQ3RCLEtBQUssR0FBWSxJQUFJLENBQUM7SUFDdEIsR0FBRyxHQUFXLENBQUMsQ0FBQztJQUNoQixHQUFHLEdBQVcsQ0FBQyxDQUFDO0lBRWhCLFlBQVksR0FBUSxFQUFFLE1BQWtCO1FBQ3RDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNYLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxNQUFNO1FBQ0osTUFBTSxFQUFFLFNBQVMsRUFBRSxHQUFHLElBQUksQ0FBQztRQUMzQixTQUFTLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxFQUFFLElBQUksRUFBRSwrQkFBK0IsRUFBRSxDQUFDLENBQUM7UUFFcEUsb0JBQW9CO1FBQ3BCLE1BQU0sY0FBYyxHQUFHLFNBQVMsQ0FBQyxTQUFTLENBQUMsNEJBQTRCLENBQUMsQ0FBQztRQUN6RSxNQUFNLGVBQWUsR0FBRyxTQUFTLENBQUMsU0FBUyxDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFFaEUsa0NBQWtDO1FBQ2xDLElBQUksQ0FBQyxZQUFZLENBQUMsY0FBYyxFQUFFLGVBQWUsQ0FBQyxDQUFDO1FBQ25ELFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDZCxJQUFJLENBQUMsV0FBVyxDQUFD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RUFBRSxDQUFDLENBQUM7WUFDekUsVUFBVSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsRUFBRSxJQUFJLEVBQUUsV0FBVyxLQUFLLEdBQUcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQzVELFVBQVUsQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFFLEVBQUUsSUFBSSxFQUFFLFVBQVUsT0FBTyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztZQUM5RCxVQUFVLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxFQUFFLElBQUksRUFBRSxXQUFXLE9BQU8sQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDbEUsQ0FBQyxDQUFDLENBQUM7UUFFSCxlQUFlO1FBQ2YsTUFBTSxXQUFXLEdBQUcsU0FBUyxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztRQUNwRSxXQUFXLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRTtZQUN6QyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDZixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxPQUFPO1FBQ0wsTUFBTSxFQUFFLFNBQVMsRUFBRSxHQUFHLElBQUksQ0FBQztRQUMzQixTQUFTLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxrQ0FBa0M7SUFDdkQsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGx1Z2luLCBNYXJrZG93blZpZXcsIE1hcmtkb3duUmVuZGVyZXIsIEFwcCwgU2V0dGluZywgTW9kYWwsIE5vdGljZSwgQ29tcG9uZW50LCBFZGl0b3IsIEVkaXRvclBvc2l0aW9uIH0gZnJvbSBcIm9ic2lkaWFuXCI7XHJcbmltcG9ydCBNYXRoUGx1Z2luIGZyb20gXCIuL21haW5cIjtcclxuaW1wb3J0IHsgY3JlYXRlVGV4dElucHV0U2V0dGluZyB9IGZyb20gXCIuL3NldHRpbmdzXCI7XHJcbmltcG9ydCB7IEF4aXMsIENvb3JkaW5hdGUsIEZvcm1hdFRpa3pqYXgsIEZvcm1hdHRpbmcgfSBmcm9tIFwiLi90aWt6amF4L3Rpa3pqYXhcIjtcclxuXHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIFZlY0lucHV0TW9kZWwgZXh0ZW5kcyBNb2RhbCB7XHJcbiAgcGx1Z2luOiBNYXRoUGx1Z2luO1xyXG4gIHBsdXNYOiBib29sZWFuID0gdHJ1ZTtcclxuICBwbHVzWTogYm9vbGVhbiA9IHRydWU7XHJcbiAgb2JqOiBudW1iZXIgPSAwO1xyXG4gIGFuZzogbnVtYmVyID0gMDtcclxuXHJcbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogTWF0aFBsdWdpbikge1xyXG4gICAgc3VwZXIoYXBwKTtcclxuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xyXG4gIH1cclxuXHJcbiAgb25PcGVuKCk6IHZvaWQge1xyXG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XHJcbiAgICBjb250ZW50RWwuY3JlYXRlRWwoXCJoMlwiLCB7IHRleHQ6IFwiVmVjdG9yIElucHV0IGZyb20gRW50ZXIgTWFzczpcIiB9KTtcclxuXHJcbiAgICAvLyBDcmVhdGUgY29udGFpbmVyc1xyXG4gICAgY29uc3QgaW5wdXRDb250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KFwidmVjLWlucHV0LWZpZWxkcy1jb250YWluZXJcIik7XHJcbiAgICBjb25zdCBzY3JpcHRDb250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KFwic2NyaXB0LWNvbnRhaW5lclwiKTtcclxuXHJcbiAgICAvLyBSZW5kZXIgZmllbGRzIGFuZCBpbml0aWFsIGdyYXBoXHJcbiAgICB0aGlzLnJlbmRlckZpZWxkcyhpbnB1dENvbnRhaW5lciwgc2NyaXB0Q29udGFpbmVyKTtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICB0aGlzLnVwZGF0ZUdyYXBoKHNjcmlwdENvbnRhaW5lcik7XHJcbiAgfSwgNTApO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyRmllbGRzKGlucHV0Q29udGFpbmVyOiBIVE1MRWxlbWVudCwgc2NyaXB0Q29udGFpbmVyOiBIVE1MRWxlbWVudCkge1xyXG4gICAgLy8gQ2xlYXIgcHJldmlvdXMgZmllbGRzIGlmIGFueVxyXG4gICAgaW5wdXRDb250YWluZXIuZmluZEFsbChcIi5maWVsZFwiKS5mb3JFYWNoKGVsID0+IGVsLnJlbW92ZSgpKTtcclxuXHJcbiAgICAvLyBUb2dnbGUgZm9yIFgtQXhpcyBSZXZlcnNlXHJcbiAgICBuZXcgU2V0dGluZyhpbnB1dENvbnRhaW5lcilcclxuICAgICAgLmFkZFRvZ2dsZSh0b2dnbGUgPT5cclxuICAgICAgICB0b2dnbGVcclxuICAgICAgICAgIC5zZXRUb29sdGlwKFwiVG9nZ2xlIFgtQXhpcyBSZXZlcnNlXCIpXHJcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVzWClcclxuICAgICAgICAgIC5vbkNoYW5nZSh2YWx1ZSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucGx1c1ggPSB2YWx1ZTtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVHcmFwaChzY3JpcHRDb250YWluZXIpO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgKS5zZXR0aW5nRWwuYWRkQ2xhc3MoXCJmaWVsZFwiKTtcclxuXHJcbiAgICAvLyBUb2dnbGUgZm9yIFktQXhpcyBSZXZlcnNlXHJcbiAgICBuZXcgU2V0dGluZyhpbnB1dENvbnRhaW5lcilcclxuICAgICAgLmFkZFRvZ2dsZSh0b2dnbGUgPT5cclxuICAgICAgICB0b2dnbGVcclxuICAgICAgICAgIC5zZXRUb29sdGlwKFwiVG9nZ2xlIFktQXhpcyBSZXZlcnNlXCIpXHJcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVzWSlcclxuICAgICAgICAgIC5vbkNoYW5nZSh2YWx1ZSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucGx1c1kgPSB2YWx1ZTtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVHcmFwaChzY3JpcHRDb250YWluZXIpO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgKS5zZXR0aW5nRWwuYWRkQ2xhc3MoXCJmaWVsZFwiKTtcclxuXHJcbiAgICAvLyBUZXh0IGlucHV0IGZvciBtYXNzXHJcbiAgICBuZXcgU2V0dGluZyhpbnB1dENvbnRhaW5lcilcclxuICAgICAgLnNldE5hbWUoXCJFbnRlciBNYXNzXCIpXHJcbiAgICAgIC5zZXREZXNjKFwiRW50ZXIgdGhlIG1hc3MgeW91IHdhbnQgdG8gZXZhbHVhdGVcIilcclxuICAgICAgLmFkZFRleHQodGV4dCA9PiB7XHJcbiAgICAgICAgdGV4dC5vbkNoYW5nZShhc3luYyAodmFsdWU6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgY29uc3QgbWFzc1ZhbHVlID0gTnVtYmVyKHZhbHVlKTtcclxuICAgICAgICAgIGlmICghaXNOYU4obWFzc1ZhbHVlKSkge1xyXG4gICAgICAgICAgICB0aGlzLm9iaiA9IG1hc3NWYWx1ZTtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVHcmFwaChzY3JpcHRDb250YWluZXIpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KS5zZXR0aW5nRWwuYWRkQ2xhc3MoXCJmaWVsZFwiKTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZUdyYXBoKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpIHtcclxuICAgIGNvbnRhaW5lci5lbXB0eSgpO1xyXG5cclxuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgbWFzcyA9IG5ldyBDb29yZGluYXRlKHtcclxuICAgICAgICAgICAgICAgIG1vZGU6IFwibm9kZVwiLFxyXG4gICAgICAgICAgICAgICAgbGFiZWw6IGAke3RoaXMub2JqfW5gLFxyXG4gICAgICAgICAgICAgICAgYXhpczogbmV3IEF4aXModGhpcy5wbHVzWCA/IDEgOiAtMSwgdGhpcy5wbHVzWSA/IDEgOiAtMSksXHJcbiAgICAgICAgICAgICAgICBmb3JtYXR0aW5nOiBuZXcgRm9ybWF0dGluZyhcIm5vZGVcIiwgeyB0aWt6c2V0OiBcIm1hc3NcIiB9KVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHRpa3ogPSBuZXcgRm9ybWF0VGlrempheChbbWFzc10pO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgc2NyaXB0ID0gY29udGFpbmVyLmNyZWF0ZUVsKFwic2NyaXB0XCIpO1xyXG4gICAgICAgICAgICBzY3JpcHQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcInRleHQvdGlrelwiKTtcclxuICAgICAgICAgICAgc2NyaXB0LnNldEF0dHJpYnV0ZShcImRhdGEtc2hvdy1jb25zb2xlXCIsIFwidHJ1ZVwiKTtcclxuICAgICAgICAgICAgc2NyaXB0LnNldFRleHQodGlrei5nZXRDb2RlKCkpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhzY3JpcHQpXHJcbiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzY3JpcHQpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkdyYXBoIHJlbmRlcmluZyBlcnJvcjpcIiwgZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn1cclxuXHJcblxyXG5cclxufVxyXG5cclxuXHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIElucHV0TW9kYWwgZXh0ZW5kcyBNb2RhbCB7XHJcbiAgcGx1Z2luOiBNYXRoUGx1Z2luO1xyXG4gIHVzZXJDaG9pY2UgPSAwO1xyXG4gIHVzZXJTaWRlc0lucHV0ID0gXCJcIjtcclxuICB1c2VyQW5nbGVzSW5wdXQgPSBcIlwiO1xyXG4gIHJlc3VsdENvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XHJcbiAgc2hhcGVzQ2hhcmFjdGVyaXN0aWNzOiBhbnk7XHJcbiAgZXZhbGVkVXNlcklucHV0SW5mbzogYW55ID0gbnVsbDtcclxuICBzYXZlZFZhbHVlczogYW55ID0ge307XHJcblxyXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IE1hdGhQbHVnaW4pIHtcclxuICAgIHN1cGVyKGFwcCk7XHJcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcclxuICAgIFxyXG4gIH1cclxuXHJcbiAgb25PcGVuKCkge1xyXG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XHJcbiAgICBjb250ZW50RWwuY3JlYXRlRWwoXCJoMlwiLCB7IHRleHQ6IFwiRW50ZXIgTWF0aCBFeHByZXNzaW9uXCIgfSk7XHJcblxyXG4gICAgY29uc3QgZHluYW1pY0ZpZWxkQ29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdih7IGNsczogXCJkeW5hbWljLWZpZWxkLWNvbnRhaW5lclwiIH0pO1xyXG4gICAgY29uc3QgdGlrekdyYXBoQ29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdih7IGNsczogXCJ0aWt6LWdyYXBoLWNvbnRhaW5lclwiIH0pO1xyXG4gICAgY29uc3Qgc3VibWl0QnV0dG9uID0gY29udGVudEVsLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHsgdGV4dDogXCJTdWJtaXRcIiwgYXR0cjogeyBkaXNhYmxlZDogXCJ0cnVlXCIgfSB9KTtcclxuICAgIGNvbnN0IHRlbXBvcmFyeURlYnVnQXJlYSA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoeyBjbHM6IFwidGVtcG9yYXJ5LWRlYnVnLWFyZWFcIiB9KTtcclxuXHJcbiAgICBzdWJtaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgaWYgKHRoaXMuZXZhbGVkVXNlcklucHV0SW5mbyAmJiB0aGlzLmV2YWxlZFVzZXJJbnB1dEluZm8ubWVldHNNaW5SZXF1aXJlbWVudHMpIHtcclxuICAgICAgICB0aGlzLmhhbmRsZVN1Ym1pdCgpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIG5ldyBOb3RpY2UoXCJQbGVhc2UgZW50ZXIgdmFsaWQgaW5wdXQuXCIpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLnVzZXJDaG9pY2UgPSAwO1xyXG4gICAgdGhpcy5yZW5kZXJEeW5hbWljRmllbGRzKGR5bmFtaWNGaWVsZENvbnRhaW5lcik7XHJcbiAgICAgICAgXHJcbiAgICBkeW5hbWljRmllbGRDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcclxuICAgICAgaWYgKHRoaXMuZXZhbGVkVXNlcklucHV0SW5mby5tZWV0c01pblJlcXVpcmVtZW50cykge1xyXG4gICAgICAgIHN1Ym1pdEJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKTtcclxuICAgICAgICB0aWt6R3JhcGhDb250YWluZXIuZW1wdHkoKTtcclxuICAgICAgICBcclxuICAgICAgICB0ZW1wb3JhcnlEZWJ1Z0FyZWEuZW1wdHkoKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBzdWJtaXRCdXR0b24uc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIFxyXG4gIH1cclxuICByZW5kZXJEeW5hbWljRmllbGRzKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpIHtcclxuICAgIGNvbnRhaW5lci5maW5kQWxsKFwiLmR5bmFtaWMtZmllbGRcIikuZm9yRWFjaChlbCA9PiBlbC5yZW1vdmUoKSk7XHJcbiAgICB0aGlzLnVzZXJTaWRlc0lucHV0PWNyZWF0ZVRleHRJbnB1dFNldHRpbmcoY29udGFpbmVyLFwiQ29vcmRpbmF0ZXNcIixcIkVudGVyICR7c2hhcGUuY29vcmRpbmF0ZXN9XCIsXCJcIixcIlwiLFwiZHluYW1pYy1maWVsZFwiKXx8XCJcIlxyXG4gICAgdGhpcy51c2VyU2lkZXNJbnB1dD1jcmVhdGVUZXh0SW5wdXRTZXR0aW5nKGNvbnRhaW5lcixcIkNvb3JkaW5hdGVzXCIsXCJFbnRlciAke3NoYXBlLmNvb3JkaW5hdGVzfVwiLFwiXCIsXCJcIixcImR5bmFtaWMtZmllbGRcIil8fFwiXCJcclxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lcilcclxuICAgICAgLmFkZEJ1dHRvbihidXR0b24gPT5cclxuICAgICAgICBidXR0b25cclxuICAgICAgICAgIC5zZXRCdXR0b25UZXh0KFwiYWRkIHZlY1wiKVxyXG4gICAgICAgICAgLnNldFRvb2x0aXAoXCJhZGQgYSB2ZWN0ZXJcIilcclxuICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJEeW5hbWljRmllbGRzKGNvbnRhaW5lcik7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICApXHJcbiAgICAgIC5zZXR0aW5nRWwuYWRkQ2xhc3MoXCJkeW5hbWljLWZpZWxkXCIpO1xyXG5cclxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lcilcclxuICAgICAgLmFkZEJ1dHRvbihidXR0b24gPT5cclxuICAgICAgICBidXR0b25cclxuICAgICAgICAgIC5zZXRCdXR0b25UZXh0KFwiQ2xlYXJcIilcclxuICAgICAgICAgIC5zZXRUb29sdGlwKFwiQ2xlYXIgYWxsIHByZXZpb3VzIGZpZWxkc1wiKVxyXG4gICAgICAgICAgLm9uQ2xpY2soKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlckR5bmFtaWNGaWVsZHMoY29udGFpbmVyKTtcclxuICAgICAgICAgIH0pXHJcbiAgICAgIClcclxuICAgICAgLnNldHRpbmdFbC5hZGRDbGFzcyhcImR5bmFtaWMtZmllbGRcIik7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGhhbmRsZVN1Ym1pdCgpIHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5ldmFsZWRVc2VySW5wdXRJbmZvO1xyXG4gICAgICB0aGlzLnJlc3VsdENvbnRhaW5lci50ZXh0Q29udGVudCA9IEpTT04uc3RyaW5naWZ5KHJlc3VsdCk7XHJcblxyXG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zZXNzaW9uSGlzdG9yeS5wdXNoKHtcclxuICAgICAgICBpbnB1dDogdGhpcy51c2VyQW5nbGVzSW5wdXQsXHJcbiAgICAgICAgcmVzdWx0OiByZXN1bHRcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgXHJcbiAgfVxyXG4gIG9uQ2xvc2UoKSB7XHJcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcclxuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xyXG4gIH1cclxufVxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIEN1c3RvbUlucHV0TW9kYWwgZXh0ZW5kcyBNb2RhbCB7XHJcbiAgICBwbHVnaW46IE1hdGhQbHVnaW47XHJcbiAgICB1c2VyQ2hvaWNlID0gMDtcclxuICAgIHVzZXJTaWRlc0lucHV0ID0gXCJcIjtcclxuICAgIHVzZXJBbmdsZXNJbnB1dCA9IFwiXCI7XHJcbiAgICByZXN1bHRDb250YWluZXI6IEhUTUxFbGVtZW50O1xyXG4gICAgc2hhcGVzQ2hhcmFjdGVyaXN0aWNzOiBhbnk7XHJcbiAgICBldmFsZWRVc2VySW5wdXRJbmZvOiBhbnkgPSBudWxsO1xyXG4gICAgc2F2ZWRWYWx1ZXM6IGFueSA9IHt9O1xyXG4gIFxyXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogTWF0aFBsdWdpbikge1xyXG4gICAgICBzdXBlcihhcHApO1xyXG4gICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcclxuICAgIH1cclxuICBcclxuICAgIG9uT3BlbigpIHtcclxuICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XHJcbiAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbChcImgyXCIsIHsgdGV4dDogXCJFbnRlciBNYXRoIEV4cHJlc3Npb25cIiB9KTtcclxuICBcclxuICAgICAgLy8gQXNzaWduIHNoYXBlc0NoYXJhY3RlcmlzdGljcyBnbG9iYWxseVxyXG4gIFxyXG4gICAgICBjb25zdCBzZXR0aW5nc0NvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoeyBjbHM6IFwic2V0dGluZ3MtY29udGFpbmVyXCIgfSk7XHJcbiAgICAgIGNvbnN0IGR5bmFtaWNGaWVsZENvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoeyBjbHM6IFwiZHluYW1pYy1maWVsZC1jb250YWluZXJcIiB9KTtcclxuICAgICAgY29uc3QgdGlrekdyYXBoQ29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdih7IGNsczogXCJkeW5hbWljLWZpZWxkLWNvbnRhaW5lclwiIH0pO1xyXG4gICAgICBjb25zdCBzdWJtaXRCdXR0b24gPSBjb250ZW50RWwuY3JlYXRlRWwoXCJidXR0b25cIiwgeyB0ZXh0OiBcIlN1Ym1pdFwiLCBhdHRyOiB7IGRpc2FibGVkOiBcInRydWVcIiB9IH0pO1xyXG4gICAgICBjb25zdCB0ZW1wb3JhcnlEZWJ1Z0FyZWEgPSBjb250ZW50RWwuY3JlYXRlRGl2KHsgY2xzOiBcInRlbXBvcmFyeS1kZWJ1Zy1hcmVhXCIgfSk7XHJcbiAgICAgIHN1Ym1pdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLmV2YWxlZFVzZXJJbnB1dEluZm8gJiYgdGhpcy5ldmFsZWRVc2VySW5wdXRJbmZvLm1lZXRzTWluUmVxdWlyZW1lbnRzKSB7XHJcbiAgICAgICAgICB0aGlzLmhhbmRsZVN1Ym1pdCgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBuZXcgTm90aWNlKFwiUGxlYXNlIGVudGVyIHZhbGlkIGlucHV0LlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gIFxyXG4gICAgICBuZXcgU2V0dGluZyhzZXR0aW5nc0NvbnRhaW5lcilcclxuICAgICAgICAuc2V0TmFtZShcIkNob29zZSBzaGFwZVwiKVxyXG4gICAgICAgIC5zZXREZXNjKFwiU2VsZWN0IHRoZSBzaGFwZSB0byBwZXJmb3JtIHRoZSBvcGVyYXRpb25zIG9uLlwiKVxyXG4gICAgICAgIC5hZGREcm9wZG93bihkcm9wZG93biA9PiB7XHJcbiAgICAgICAgICB0aGlzLnNoYXBlc0NoYXJhY3RlcmlzdGljcy5mb3JFYWNoKChzaGFwZTogYW55LCBpbmRleDogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgIGRyb3Bkb3duLmFkZE9wdGlvbihpbmRleC50b1N0cmluZygpLCBzaGFwZS5uYW1lKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgdGhpcy51c2VyQ2hvaWNlID0gMDtcclxuICAgICAgICAgIHRoaXMucmVuZGVyRHluYW1pY0ZpZWxkcyhkeW5hbWljRmllbGRDb250YWluZXIpO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBkcm9wZG93bi5vbkNoYW5nZSh2YWx1ZSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMudXNlckNob2ljZSA9IE51bWJlcih2YWx1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyRHluYW1pY0ZpZWxkcyhkeW5hbWljRmllbGRDb250YWluZXIpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICBjb250ZW50RWwuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcclxuICAgICAgICB0aGlzLmV2YWxlZFVzZXJJbnB1dEluZm8gPSB0aGlzLnRlc3RNaW5JbnB1dFJlcXVpcmVtZW50cygpO1xyXG4gICAgICAgIGlmICh0aGlzLmV2YWxlZFVzZXJJbnB1dEluZm8ubWVldHNNaW5SZXF1aXJlbWVudHMpIHtcclxuICAgICAgICAgIHN1Ym1pdEJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKTtcclxuICAgICAgICAgIHRpa3pHcmFwaENvbnRhaW5lci5lbXB0eSgpO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICB0ZW1wb3JhcnlEZWJ1Z0FyZWEuZW1wdHkoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgc3VibWl0QnV0dG9uLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwidHJ1ZVwiKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgIH1cclxuICBcclxuICAgIHJlbmRlckR5bmFtaWNGaWVsZHMoY29udGFpbmVyOiBIVE1MRWxlbWVudCkge1xyXG4gICAgICBcclxuICAgIH1cclxuICBcclxuICAgIHByaXZhdGUgdGVzdE1pbklucHV0UmVxdWlyZW1lbnRzKCkge1xyXG4gICAgICByZXR1cm4geyBtZWV0c01pblJlcXVpcmVtZW50czogdHJ1ZSxzaGFwZTogXCJzaGFwZU5hbWVcIiwgY29vcmRpbmF0ZXM6IFtdLCBzaWRlczoge30sIGFuZ2xlczogW10gfTtcclxuICAgIH1cclxuICBcclxuICAgIHByaXZhdGUgaGFuZGxlU3VibWl0KCkge1xyXG4gIFxyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuZXZhbGVkVXNlcklucHV0SW5mbztcclxuICAgICAgICB0aGlzLnJlc3VsdENvbnRhaW5lci50ZXh0Q29udGVudCA9IEpTT04uc3RyaW5naWZ5KHJlc3VsdCk7XHJcbiAgXHJcbiAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc2Vzc2lvbkhpc3RvcnkucHVzaCh7XHJcbiAgICAgICAgICBpbnB1dDogdGhpcy51c2VyQW5nbGVzSW5wdXQsXHJcbiAgICAgICAgICByZXN1bHQ6IHJlc3VsdFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICBcclxuICAgIH1cclxuICAgIG9uQ2xvc2UoKSB7XHJcbiAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xyXG4gICAgICBjb250ZW50RWwuZW1wdHkoKTtcclxuICAgIH1cclxufVxyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBIaXN0b3J5TW9kYWwgZXh0ZW5kcyBNb2RhbCB7XHJcbiAgICBwbHVnaW46IE1hdGhQbHVnaW47XHJcbiAgXHJcbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBNYXRoUGx1Z2luKSB7XHJcbiAgICAgIHN1cGVyKGFwcCk7XHJcbiAgICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xyXG4gICAgfVxyXG4gIFxyXG4gICAgb25PcGVuKCkge1xyXG4gICAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcclxuICAgICAgY29udGVudEVsLmNyZWF0ZUVsKFwiaDJcIiwgeyB0ZXh0OiBcIlNlc3Npb24gSGlzdG9yeVwiIH0pO1xyXG4gIFxyXG4gICAgICAvLyBJZiB0aGVyZSBpcyBubyBoaXN0b3J5LCBkaXNwbGF5IGEgbWVzc2FnZVxyXG4gICAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3Muc2Vzc2lvbkhpc3RvcnkubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgY29udGVudEVsLmNyZWF0ZUVsKFwicFwiLCB7IHRleHQ6IFwiTm8gc2Vzc2lvbiBoaXN0b3J5IGZvdW5kLlwiIH0pO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gIFxyXG4gICAgICAvLyBEaXNwbGF5IGVhY2ggc2Vzc2lvbiBpbiB0aGUgaGlzdG9yeVxyXG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zZXNzaW9uSGlzdG9yeS5mb3JFYWNoKChzZXNzaW9uLCBpbmRleCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHNlc3Npb25EaXYgPSBjb250ZW50RWwuY3JlYXRlRWwoXCJkaXZcIiwgeyBjbHM6IFwiaGlzdG9yeS1zZXNzaW9uXCIgfSk7XHJcbiAgICAgICAgc2Vzc2lvbkRpdi5jcmVhdGVFbChcImgzXCIsIHsgdGV4dDogYFNlc3Npb24gJHtpbmRleCArIDF9YCB9KTtcclxuICAgICAgICBzZXNzaW9uRGl2LmNyZWF0ZUVsKFwicFwiLCB7IHRleHQ6IGBJbnB1dDogJHtzZXNzaW9uLmlucHV0fWAgfSk7XHJcbiAgICAgICAgc2Vzc2lvbkRpdi5jcmVhdGVFbChcInBcIiwgeyB0ZXh0OiBgUmVzdWx0OiAke3Nlc3Npb24ucmVzdWx0fWAgfSk7XHJcbiAgICAgIH0pO1xyXG4gIFxyXG4gICAgICAvLyBDbG9zZSBidXR0b25cclxuICAgICAgY29uc3QgY2xvc2VCdXR0b24gPSBjb250ZW50RWwuY3JlYXRlRWwoXCJidXR0b25cIiwgeyB0ZXh0OiBcIkNsb3NlXCIgfSk7XHJcbiAgICAgIGNsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICBcclxuICAgIG9uQ2xvc2UoKSB7XHJcbiAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xyXG4gICAgICBjb250ZW50RWwuZW1wdHkoKTsgLy8gQ2xlYW4gdXAgbW9kYWwgY29udGVudCBvbiBjbG9zZVxyXG4gICAgfVxyXG4gIH1cclxuIl19