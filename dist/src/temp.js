import { Setting, Modal, Notice } from "obsidian";
import { createTextInputSetting } from "./settings";
export class VecInputModel extends Modal {
    plugin;
    plusX = true;
    plusY = true;
    obj = 0;
    ang = 0;
    constructor(app, plugin) {
        super(app);
        this.plugin = plugin;
    }
    onOpen() {
        const { contentEl } = this;
        contentEl.createEl("h2", { text: "Vector Input from Enter Mass:" });
        // Create containers
        const inputContainer = contentEl.createDiv("vec-input-fields-container");
        const scriptContainer = contentEl.createDiv("script-container");
        // Render fields and initial graph
        this.renderFields(inputContainer, scriptContainer);
        setTimeout(() => {
            this.updateGraph(scriptContainer);
        }, 50);
    }
    renderFields(inputContainer, scriptContainer) {
        // Clear previous fields if any
        inputContainer.findAll(".field").forEach(el => el.remove());
        // Toggle for X-Axis Reverse
        new Setting(inputContainer)
            .addToggle(toggle => toggle
            .setTooltip("Toggle X-Axis Reverse")
            .setValue(this.plusX)
            .onChange(value => {
            this.plusX = value;
            this.updateGraph(scriptContainer);
        })).settingEl.addClass("field");
        // Toggle for Y-Axis Reverse
        new Setting(inputContainer)
            .addToggle(toggle => toggle
            .setTooltip("Toggle Y-Axis Reverse")
            .setValue(this.plusY)
            .onChange(value => {
            this.plusY = value;
            this.updateGraph(scriptContainer);
        })).settingEl.addClass("field");
        // Text input for mass
        new Setting(inputContainer)
            .setName("Enter Mass")
            .setDesc("Enter the mass you want to evaluate")
            .addText(text => {
            text.onChange(async (value) => {
                const massValue = Number(value);
                if (!isNaN(massValue)) {
                    this.obj = massValue;
                    this.updateGraph(scriptContainer);
                }
            });
        }).settingEl.addClass("field");
    }
    updateGraph(container) {
        container.empty();
        requestAnimationFrame(() => {
            try {
                /*
                  const mass = new Coordinate({
                      mode: "node",
                      label: `${this.obj}n`,
                      axis: new Axis(this.plusX ? 1 : -1, this.plusY ? 1 : -1),
                      //formatting: new Formatting("node", { tikzset: "mass" })
                  });
      
                  const tikz = new FormatTikzjax([mass]);
      
                  const script = container.createEl("script");
                  script.setAttribute("type", "text/tikz");
                  script.setAttribute("data-show-console", "true");
                  script.setText(tikz.getCode());
                  console.log(script)
                  container.appendChild(script);*/
            }
            catch (e) {
                console.error("Graph rendering error:", e);
            }
        });
    }
}
export class InputModal extends Modal {
    plugin;
    userChoice = 0;
    userSidesInput = "";
    userAnglesInput = "";
    resultContainer;
    shapesCharacteristics;
    evaledUserInputInfo = null;
    savedValues = {};
    constructor(app, plugin) {
        super(app);
        this.plugin = plugin;
    }
    onOpen() {
        const { contentEl } = this;
        contentEl.createEl("h2", { text: "Enter Math Expression" });
        const dynamicFieldContainer = contentEl.createDiv({ cls: "dynamic-field-container" });
        const tikzGraphContainer = contentEl.createDiv({ cls: "tikz-graph-container" });
        const submitButton = contentEl.createEl("button", { text: "Submit", attr: { disabled: "true" } });
        const temporaryDebugArea = contentEl.createDiv({ cls: "temporary-debug-area" });
        submitButton.addEventListener("click", () => {
            if (this.evaledUserInputInfo && this.evaledUserInputInfo.meetsMinRequirements) {
                this.handleSubmit();
            }
            else {
                new Notice("Please enter valid input.");
            }
        });
        this.userChoice = 0;
        this.renderDynamicFields(dynamicFieldContainer);
        dynamicFieldContainer.addEventListener("input", () => {
            if (this.evaledUserInputInfo.meetsMinRequirements) {
                submitButton.removeAttribute("disabled");
                tikzGraphContainer.empty();
                temporaryDebugArea.empty();
            }
            else {
                submitButton.setAttribute("disabled", "true");
            }
        });
    }
    renderDynamicFields(container) {
        container.findAll(".dynamic-field").forEach(el => el.remove());
        this.userSidesInput = createTextInputSetting(container, "Coordinates", "Enter ${shape.coordinates}", "", "", "dynamic-field") || "";
        this.userSidesInput = createTextInputSetting(container, "Coordinates", "Enter ${shape.coordinates}", "", "", "dynamic-field") || "";
        new Setting(container)
            .addButton(button => button
            .setButtonText("add vec")
            .setTooltip("add a vecter")
            .onClick(() => {
            this.renderDynamicFields(container);
        }))
            .settingEl.addClass("dynamic-field");
        new Setting(container)
            .addButton(button => button
            .setButtonText("Clear")
            .setTooltip("Clear all previous fields")
            .onClick(() => {
            this.renderDynamicFields(container);
        }))
            .settingEl.addClass("dynamic-field");
    }
    handleSubmit() {
        const result = this.evaledUserInputInfo;
        this.resultContainer.textContent = JSON.stringify(result);
        this.plugin.settings.sessionHistory.push({
            input: this.userAnglesInput,
            result: result
        });
        this.plugin.saveSettings();
    }
    onClose() {
        const { contentEl } = this;
        contentEl.empty();
    }
}
export class CustomInputModal extends Modal {
    plugin;
    userChoice = 0;
    userSidesInput = "";
    userAnglesInput = "";
    resultContainer;
    shapesCharacteristics;
    evaledUserInputInfo = null;
    savedValues = {};
    constructor(app, plugin) {
        super(app);
        this.plugin = plugin;
    }
    onOpen() {
        const { contentEl } = this;
        contentEl.createEl("h2", { text: "Enter Math Expression" });
        // Assign shapesCharacteristics globally
        const settingsContainer = contentEl.createDiv({ cls: "settings-container" });
        const dynamicFieldContainer = contentEl.createDiv({ cls: "dynamic-field-container" });
        const tikzGraphContainer = contentEl.createDiv({ cls: "dynamic-field-container" });
        const submitButton = contentEl.createEl("button", { text: "Submit", attr: { disabled: "true" } });
        const temporaryDebugArea = contentEl.createDiv({ cls: "temporary-debug-area" });
        submitButton.addEventListener("click", () => {
            if (this.evaledUserInputInfo && this.evaledUserInputInfo.meetsMinRequirements) {
                this.handleSubmit();
            }
            else {
                new Notice("Please enter valid input.");
            }
        });
        new Setting(settingsContainer)
            .setName("Choose shape")
            .setDesc("Select the shape to perform the operations on.")
            .addDropdown(dropdown => {
            this.shapesCharacteristics.forEach((shape, index) => {
                dropdown.addOption(index.toString(), shape.name);
            });
            this.userChoice = 0;
            this.renderDynamicFields(dynamicFieldContainer);
            dropdown.onChange(value => {
                this.userChoice = Number(value);
                this.renderDynamicFields(dynamicFieldContainer);
            });
        });
        contentEl.addEventListener("input", () => {
            this.evaledUserInputInfo = this.testMinInputRequirements();
            if (this.evaledUserInputInfo.meetsMinRequirements) {
                submitButton.removeAttribute("disabled");
                tikzGraphContainer.empty();
                temporaryDebugArea.empty();
            }
            else {
                submitButton.setAttribute("disabled", "true");
            }
        });
    }
    renderDynamicFields(container) {
    }
    testMinInputRequirements() {
        return { meetsMinRequirements: true, shape: "shapeName", coordinates: [], sides: {}, angles: [] };
    }
    handleSubmit() {
        const result = this.evaledUserInputInfo;
        this.resultContainer.textContent = JSON.stringify(result);
        this.plugin.settings.sessionHistory.push({
            input: this.userAnglesInput,
            result: result
        });
        this.plugin.saveSettings();
    }
    onClose() {
        const { contentEl } = this;
        contentEl.empty();
    }
}
export class HistoryModal extends Modal {
    plugin;
    constructor(app, plugin) {
        super(app);
        this.plugin = plugin;
    }
    onOpen() {
        const { contentEl } = this;
        contentEl.createEl("h2", { text: "Session History" });
        // If there is no history, display a message
        if (this.plugin.settings.sessionHistory.length === 0) {
            contentEl.createEl("p", { text: "No session history found." });
            return;
        }
        // Display each session in the history
        this.plugin.settings.sessionHistory.forEach((session, index) => {
            const sessionDiv = contentEl.createEl("div", { cls: "history-session" });
            sessionDiv.createEl("h3", { text: `Session ${index + 1}` });
            sessionDiv.createEl("p", { text: `Input: ${session.input}` });
            sessionDiv.createEl("p", { text: `Result: ${session.result}` });
        });
        // Close button
        const closeButton = contentEl.createEl("button", { text: "Close" });
        closeButton.addEventListener("click", () => {
            this.close();
        });
    }
    onClose() {
        const { contentEl } = this;
        contentEl.empty(); // Clean up modal content on close
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVtcC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90ZW1wLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBK0MsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQXFDLE1BQU0sVUFBVSxDQUFDO0FBRWxJLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLFlBQVksQ0FBQztBQU1wRCxNQUFNLE9BQU8sYUFBYyxTQUFRLEtBQUs7SUFDdEMsTUFBTSxDQUFhO0lBQ25CLEtBQUssR0FBWSxJQUFJLENBQUM7SUFDdEIsS0FBSyxHQUFZLElBQUksQ0FBQztJQUN0QixHQUFHLEdBQVcsQ0FBQyxDQUFDO0lBQ2hCLEdBQUcsR0FBVyxDQUFDLENBQUM7SUFFaEIsWUFBWSxHQUFRLEVBQUUsTUFBa0I7UUFDdEMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ1gsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7SUFDdkIsQ0FBQztJQUVELE1BQU07UUFDSixNQUFNLEVBQUUsU0FBUyxFQUFFLEdBQUcsSUFBSSxDQUFDO1FBQzNCLFNBQVMsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLEVBQUUsSUFBSSxFQUFFLCtCQUErQixFQUFFLENBQUMsQ0FBQztRQUVwRSxvQkFBb0I7UUFDcEIsTUFBTSxjQUFjLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO1FBQ3pFLE1BQU0sZUFBZSxHQUFHLFNBQVMsQ0FBQyxTQUFTLENBQUMsa0JBQWtCLENBQUMsQ0FBQztRQUVoRSxrQ0FBa0M7UUFDbEMsSUFBSSxDQUFDLFlBQVksQ0FBQyxjQUFjLEVBQUUsZUFBZSxDQUFDLENBQUM7UUFDbkQsVUFBVSxDQUFDLEdBQUcsRUFBRTtZQUNkLElBQUksQ0FBQyxXQUFXLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDdEMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVELFlBQVksQ0FBQyxj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LENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLEVBQUU7WUFDN0QsTUFBTSxVQUFVLEdBQUcsU0FBUyxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsRUFBRSxHQUFHLEVBQUUsaUJBQWlCLEVBQUUsQ0FBQyxDQUFDO1lBQ3pFLFVBQVUsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLEVBQUUsSUFBSSxFQUFFLFdBQVcsS0FBSyxHQUFHLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUM1RCxVQUFVLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxFQUFFLElBQUksRUFBRSxVQUFVLE9BQU8sQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDOUQsVUFBVSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsRUFBRSxJQUFJLEVBQUUsV0FBVyxPQUFPLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ2xFLENBQUMsQ0FBQyxDQUFDO1FBRUgsZUFBZTtRQUNmLE1BQU0sV0FBVyxHQUFHLFNBQVMsQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7UUFDcEUsV0FBVyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUU7WUFDekMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2YsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsT0FBTztRQUNMLE1BQU0sRUFBRSxTQUFTLEVBQUUsR0FBRyxJQUFJLENBQUM7UUFDM0IsU0FBUyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsa0NBQWtDO0lBQ3ZELENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBsdWdpbiwgTWFya2Rvd25WaWV3LCBNYXJrZG93blJlbmRlcmVyLCBBcHAsIFNldHRpbmcsIE1vZGFsLCBOb3RpY2UsIENvbXBvbmVudCwgRWRpdG9yLCBFZGl0b3JQb3NpdGlvbiB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IE1hdGhQbHVnaW4gZnJvbSBcIi4vbWFpblwiO1xuaW1wb3J0IHsgY3JlYXRlVGV4dElucHV0U2V0dGluZyB9IGZyb20gXCIuL3NldHRpbmdzXCI7XG5pbXBvcnQgeyBBeGlzLCBDb29yZGluYXRlLCBGb3JtYXR0aW5nIH0gZnJvbSBcIi4vdGlrempheC90aWt6amF4XCI7XG5pbXBvcnQgeyBGb3JtYXRUaWt6amF4IH0gZnJvbSBcIi4vdGlrempheC9pbnRlcnByZXQvdG9rZW5pemVUaWt6amF4XCI7XG5cblxuXG5leHBvcnQgY2xhc3MgVmVjSW5wdXRNb2RlbCBleHRlbmRzIE1vZGFsIHtcbiAgcGx1Z2luOiBNYXRoUGx1Z2luO1xuICBwbHVzWDogYm9vbGVhbiA9IHRydWU7XG4gIHBsdXNZOiBib29sZWFuID0gdHJ1ZTtcbiAgb2JqOiBudW1iZXIgPSAwO1xuICBhbmc6IG51bWJlciA9IDA7XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogTWF0aFBsdWdpbikge1xuICAgIHN1cGVyKGFwcCk7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gIH1cblxuICBvbk9wZW4oKTogdm9pZCB7XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgY29udGVudEVsLmNyZWF0ZUVsKFwiaDJcIiwgeyB0ZXh0OiBcIlZlY3RvciBJbnB1dCBmcm9tIEVudGVyIE1hc3M6XCIgfSk7XG5cbiAgICAvLyBDcmVhdGUgY29udGFpbmVyc1xuICAgIGNvbnN0IGlucHV0Q29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdihcInZlYy1pbnB1dC1maWVsZHMtY29udGFpbmVyXCIpO1xuICAgIGNvbnN0IHNjcmlwdENvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoXCJzY3JpcHQtY29udGFpbmVyXCIpO1xuXG4gICAgLy8gUmVuZGVyIGZpZWxkcyBhbmQgaW5pdGlhbCBncmFwaFxuICAgIHRoaXMucmVuZGVyRmllbGRzKGlucHV0Q29udGFpbmVyLCBzY3JpcHRDb250YWluZXIpO1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy51cGRhdGVHcmFwaChzY3JpcHRDb250YWluZXIpO1xuICB9LCA1MCk7XG4gIH1cblxuICByZW5kZXJGaWVsZHMoaW5wdXRDb250YWluZXI6IEhUTUxFbGVtZW50LCBzY3JpcHRDb250YWluZXI6IEhUTUxFbGVtZW50KSB7XG4gICAgLy8gQ2xlYXIgcHJldmlvdXMgZmllbGRzIGlmIGFueVxuICAgIGlucHV0Q29udGFpbmVyLmZpbmRBbGwoXCIuZmllbGRcIikuZm9yRWFjaChlbCA9PiBlbC5yZW1vdmUoKSk7XG5cbiAgICAvLyBUb2dnbGUgZm9yIFgtQXhpcyBSZXZlcnNlXG4gICAgbmV3IFNldHRpbmcoaW5wdXRDb250YWluZXIpXG4gICAgICAuYWRkVG9nZ2xlKHRvZ2dsZSA9PlxuICAgICAgICB0b2dnbGVcbiAgICAgICAgICAuc2V0VG9vbHRpcChcIlRvZ2dsZSBYLUF4aXMgUmV2ZXJzZVwiKVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdXNYKVxuICAgICAgICAgIC5vbkNoYW5nZSh2YWx1ZSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdXNYID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUdyYXBoKHNjcmlwdENvbnRhaW5lcik7XG4gICAgICAgICAgfSlcbiAgICAgICkuc2V0dGluZ0VsLmFkZENsYXNzKFwiZmllbGRcIik7XG5cbiAgICAvLyBUb2dnbGUgZm9yIFktQXhpcyBSZXZlcnNlXG4gICAgbmV3IFNldHRpbmcoaW5wdXRDb250YWluZXIpXG4gICAgICAuYWRkVG9nZ2xlKHRvZ2dsZSA9PlxuICAgICAgICB0b2dnbGVcbiAgICAgICAgICAuc2V0VG9vbHRpcChcIlRvZ2dsZSBZLUF4aXMgUmV2ZXJzZVwiKVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdXNZKVxuICAgICAgICAgIC5vbkNoYW5nZSh2YWx1ZSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdXNZID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUdyYXBoKHNjcmlwdENvbnRhaW5lcik7XG4gICAgICAgICAgfSlcbiAgICAgICkuc2V0dGluZ0VsLmFkZENsYXNzKFwiZmllbGRcIik7XG5cbiAgICAvLyBUZXh0IGlucHV0IGZvciBtYXNzXG4gICAgbmV3IFNldHRpbmcoaW5wdXRDb250YWluZXIpXG4gICAgICAuc2V0TmFtZShcIkVudGVyIE1hc3NcIilcbiAgICAgIC5zZXREZXNjKFwiRW50ZXIgdGhlIG1hc3MgeW91IHdhbnQgdG8gZXZhbHVhdGVcIilcbiAgICAgIC5hZGRUZXh0KHRleHQgPT4ge1xuICAgICAgICB0ZXh0Lm9uQ2hhbmdlKGFzeW5jICh2YWx1ZTogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgY29uc3QgbWFzc1ZhbHVlID0gTnVtYmVyKHZhbHVlKTtcbiAgICAgICAgICBpZiAoIWlzTmFOKG1hc3NWYWx1ZSkpIHtcbiAgICAgICAgICAgIHRoaXMub2JqID0gbWFzc1ZhbHVlO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVHcmFwaChzY3JpcHRDb250YWluZXIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KS5zZXR0aW5nRWwuYWRkQ2xhc3MoXCJmaWVsZFwiKTtcbiAgfVxuXG4gIHVwZGF0ZUdyYXBoKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpIHtcbiAgICBjb250YWluZXIuZW1wdHkoKTtcblxuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLypcbiAgICAgICAgICAgIGNvbnN0IG1hc3MgPSBuZXcgQ29vcmRpbmF0ZSh7XG4gICAgICAgICAgICAgICAgbW9kZTogXCJub2RlXCIsXG4gICAgICAgICAgICAgICAgbGFiZWw6IGAke3RoaXMub2JqfW5gLFxuICAgICAgICAgICAgICAgIGF4aXM6IG5ldyBBeGlzKHRoaXMucGx1c1ggPyAxIDogLTEsIHRoaXMucGx1c1kgPyAxIDogLTEpLFxuICAgICAgICAgICAgICAgIC8vZm9ybWF0dGluZzogbmV3IEZvcm1hdHRpbmcoXCJub2RlXCIsIHsgdGlrenNldDogXCJtYXNzXCIgfSlcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCB0aWt6ID0gbmV3IEZvcm1hdFRpa3pqYXgoW21hc3NdKTtcblxuICAgICAgICAgICAgY29uc3Qgc2NyaXB0ID0gY29udGFpbmVyLmNyZWF0ZUVsKFwic2NyaXB0XCIpO1xuICAgICAgICAgICAgc2NyaXB0LnNldEF0dHJpYnV0ZShcInR5cGVcIiwgXCJ0ZXh0L3Rpa3pcIik7XG4gICAgICAgICAgICBzY3JpcHQuc2V0QXR0cmlidXRlKFwiZGF0YS1zaG93LWNvbnNvbGVcIiwgXCJ0cnVlXCIpO1xuICAgICAgICAgICAgc2NyaXB0LnNldFRleHQodGlrei5nZXRDb2RlKCkpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coc2NyaXB0KVxuICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHNjcmlwdCk7Ki9cbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkdyYXBoIHJlbmRlcmluZyBlcnJvcjpcIiwgZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cblxuXG5cbn1cblxuXG5cblxuZXhwb3J0IGNsYXNzIElucHV0TW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG4gIHBsdWdpbjogTWF0aFBsdWdpbjtcbiAgdXNlckNob2ljZSA9IDA7XG4gIHVzZXJTaWRlc0lucHV0ID0gXCJcIjtcbiAgdXNlckFuZ2xlc0lucHV0ID0gXCJcIjtcbiAgcmVzdWx0Q29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgc2hhcGVzQ2hhcmFjdGVyaXN0aWNzOiBhbnk7XG4gIGV2YWxlZFVzZXJJbnB1dEluZm86IGFueSA9IG51bGw7XG4gIHNhdmVkVmFsdWVzOiBhbnkgPSB7fTtcblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBNYXRoUGx1Z2luKSB7XG4gICAgc3VwZXIoYXBwKTtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICBcbiAgfVxuXG4gIG9uT3BlbigpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuY3JlYXRlRWwoXCJoMlwiLCB7IHRleHQ6IFwiRW50ZXIgTWF0aCBFeHByZXNzaW9uXCIgfSk7XG5cbiAgICBjb25zdCBkeW5hbWljRmllbGRDb250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KHsgY2xzOiBcImR5bmFtaWMtZmllbGQtY29udGFpbmVyXCIgfSk7XG4gICAgY29uc3QgdGlrekdyYXBoQ29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdih7IGNsczogXCJ0aWt6LWdyYXBoLWNvbnRhaW5lclwiIH0pO1xuICAgIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGNvbnRlbnRFbC5jcmVhdGVFbChcImJ1dHRvblwiLCB7IHRleHQ6IFwiU3VibWl0XCIsIGF0dHI6IHsgZGlzYWJsZWQ6IFwidHJ1ZVwiIH0gfSk7XG4gICAgY29uc3QgdGVtcG9yYXJ5RGVidWdBcmVhID0gY29udGVudEVsLmNyZWF0ZURpdih7IGNsczogXCJ0ZW1wb3JhcnktZGVidWctYXJlYVwiIH0pO1xuXG4gICAgc3VibWl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBpZiAodGhpcy5ldmFsZWRVc2VySW5wdXRJbmZvICYmIHRoaXMuZXZhbGVkVXNlcklucHV0SW5mby5tZWV0c01pblJlcXVpcmVtZW50cykge1xuICAgICAgICB0aGlzLmhhbmRsZVN1Ym1pdCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV3IE5vdGljZShcIlBsZWFzZSBlbnRlciB2YWxpZCBpbnB1dC5cIik7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLnVzZXJDaG9pY2UgPSAwO1xuICAgIHRoaXMucmVuZGVyRHluYW1pY0ZpZWxkcyhkeW5hbWljRmllbGRDb250YWluZXIpO1xuICAgICAgICBcbiAgICBkeW5hbWljRmllbGRDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgIGlmICh0aGlzLmV2YWxlZFVzZXJJbnB1dEluZm8ubWVldHNNaW5SZXF1aXJlbWVudHMpIHtcbiAgICAgICAgc3VibWl0QnV0dG9uLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xuICAgICAgICB0aWt6R3JhcGhDb250YWluZXIuZW1wdHkoKTtcbiAgICAgICAgXG4gICAgICAgIHRlbXBvcmFyeURlYnVnQXJlYS5lbXB0eSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc3VibWl0QnV0dG9uLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwidHJ1ZVwiKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgfVxuICByZW5kZXJEeW5hbWljRmllbGRzKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpIHtcbiAgICBjb250YWluZXIuZmluZEFsbChcIi5keW5hbWljLWZpZWxkXCIpLmZvckVhY2goZWwgPT4gZWwucmVtb3ZlKCkpO1xuICAgIHRoaXMudXNlclNpZGVzSW5wdXQ9Y3JlYXRlVGV4dElucHV0U2V0dGluZyhjb250YWluZXIsXCJDb29yZGluYXRlc1wiLFwiRW50ZXIgJHtzaGFwZS5jb29yZGluYXRlc31cIixcIlwiLFwiXCIsXCJkeW5hbWljLWZpZWxkXCIpfHxcIlwiXG4gICAgdGhpcy51c2VyU2lkZXNJbnB1dD1jcmVhdGVUZXh0SW5wdXRTZXR0aW5nKGNvbnRhaW5lcixcIkNvb3JkaW5hdGVzXCIsXCJFbnRlciAke3NoYXBlLmNvb3JkaW5hdGVzfVwiLFwiXCIsXCJcIixcImR5bmFtaWMtZmllbGRcIil8fFwiXCJcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXIpXG4gICAgICAuYWRkQnV0dG9uKGJ1dHRvbiA9PlxuICAgICAgICBidXR0b25cbiAgICAgICAgICAuc2V0QnV0dG9uVGV4dChcImFkZCB2ZWNcIilcbiAgICAgICAgICAuc2V0VG9vbHRpcChcImFkZCBhIHZlY3RlclwiKVxuICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyRHluYW1pY0ZpZWxkcyhjb250YWluZXIpO1xuICAgICAgICAgIH0pXG4gICAgICApXG4gICAgICAuc2V0dGluZ0VsLmFkZENsYXNzKFwiZHluYW1pYy1maWVsZFwiKTtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lcilcbiAgICAgIC5hZGRCdXR0b24oYnV0dG9uID0+XG4gICAgICAgIGJ1dHRvblxuICAgICAgICAgIC5zZXRCdXR0b25UZXh0KFwiQ2xlYXJcIilcbiAgICAgICAgICAuc2V0VG9vbHRpcChcIkNsZWFyIGFsbCBwcmV2aW91cyBmaWVsZHNcIilcbiAgICAgICAgICAub25DbGljaygoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlckR5bmFtaWNGaWVsZHMoY29udGFpbmVyKTtcbiAgICAgICAgICB9KVxuICAgICAgKVxuICAgICAgLnNldHRpbmdFbC5hZGRDbGFzcyhcImR5bmFtaWMtZmllbGRcIik7XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZVN1Ym1pdCgpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuZXZhbGVkVXNlcklucHV0SW5mbztcbiAgICAgIHRoaXMucmVzdWx0Q29udGFpbmVyLnRleHRDb250ZW50ID0gSlNPTi5zdHJpbmdpZnkocmVzdWx0KTtcblxuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc2Vzc2lvbkhpc3RvcnkucHVzaCh7XG4gICAgICAgIGlucHV0OiB0aGlzLnVzZXJBbmdsZXNJbnB1dCxcbiAgICAgICAgcmVzdWx0OiByZXN1bHRcbiAgICAgIH0pO1xuICAgICAgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgXG4gIH1cbiAgb25DbG9zZSgpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgfVxufVxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5leHBvcnQgY2xhc3MgQ3VzdG9tSW5wdXRNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgICBwbHVnaW46IE1hdGhQbHVnaW47XG4gICAgdXNlckNob2ljZSA9IDA7XG4gICAgdXNlclNpZGVzSW5wdXQgPSBcIlwiO1xuICAgIHVzZXJBbmdsZXNJbnB1dCA9IFwiXCI7XG4gICAgcmVzdWx0Q29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgICBzaGFwZXNDaGFyYWN0ZXJpc3RpY3M6IGFueTtcbiAgICBldmFsZWRVc2VySW5wdXRJbmZvOiBhbnkgPSBudWxsO1xuICAgIHNhdmVkVmFsdWVzOiBhbnkgPSB7fTtcbiAgXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogTWF0aFBsdWdpbikge1xuICAgICAgc3VwZXIoYXBwKTtcbiAgICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIH1cbiAgXG4gICAgb25PcGVuKCkge1xuICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgICBjb250ZW50RWwuY3JlYXRlRWwoXCJoMlwiLCB7IHRleHQ6IFwiRW50ZXIgTWF0aCBFeHByZXNzaW9uXCIgfSk7XG4gIFxuICAgICAgLy8gQXNzaWduIHNoYXBlc0NoYXJhY3RlcmlzdGljcyBnbG9iYWxseVxuICBcbiAgICAgIGNvbnN0IHNldHRpbmdzQ29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdih7IGNsczogXCJzZXR0aW5ncy1jb250YWluZXJcIiB9KTtcbiAgICAgIGNvbnN0IGR5bmFtaWNGaWVsZENvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoeyBjbHM6IFwiZHluYW1pYy1maWVsZC1jb250YWluZXJcIiB9KTtcbiAgICAgIGNvbnN0IHRpa3pHcmFwaENvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoeyBjbHM6IFwiZHluYW1pYy1maWVsZC1jb250YWluZXJcIiB9KTtcbiAgICAgIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGNvbnRlbnRFbC5jcmVhdGVFbChcImJ1dHRvblwiLCB7IHRleHQ6IFwiU3VibWl0XCIsIGF0dHI6IHsgZGlzYWJsZWQ6IFwidHJ1ZVwiIH0gfSk7XG4gICAgICBjb25zdCB0ZW1wb3JhcnlEZWJ1Z0FyZWEgPSBjb250ZW50RWwuY3JlYXRlRGl2KHsgY2xzOiBcInRlbXBvcmFyeS1kZWJ1Zy1hcmVhXCIgfSk7XG4gICAgICBzdWJtaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgaWYgKHRoaXMuZXZhbGVkVXNlcklucHV0SW5mbyAmJiB0aGlzLmV2YWxlZFVzZXJJbnB1dEluZm8ubWVldHNNaW5SZXF1aXJlbWVudHMpIHtcbiAgICAgICAgICB0aGlzLmhhbmRsZVN1Ym1pdCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5ldyBOb3RpY2UoXCJQbGVhc2UgZW50ZXIgdmFsaWQgaW5wdXQuXCIpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgXG4gICAgICBuZXcgU2V0dGluZyhzZXR0aW5nc0NvbnRhaW5lcilcbiAgICAgICAgLnNldE5hbWUoXCJDaG9vc2Ugc2hhcGVcIilcbiAgICAgICAgLnNldERlc2MoXCJTZWxlY3QgdGhlIHNoYXBlIHRvIHBlcmZvcm0gdGhlIG9wZXJhdGlvbnMgb24uXCIpXG4gICAgICAgIC5hZGREcm9wZG93bihkcm9wZG93biA9PiB7XG4gICAgICAgICAgdGhpcy5zaGFwZXNDaGFyYWN0ZXJpc3RpY3MuZm9yRWFjaCgoc2hhcGU6IGFueSwgaW5kZXg6IG51bWJlcikgPT4ge1xuICAgICAgICAgICAgZHJvcGRvd24uYWRkT3B0aW9uKGluZGV4LnRvU3RyaW5nKCksIHNoYXBlLm5hbWUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHRoaXMudXNlckNob2ljZSA9IDA7XG4gICAgICAgICAgdGhpcy5yZW5kZXJEeW5hbWljRmllbGRzKGR5bmFtaWNGaWVsZENvbnRhaW5lcik7XG4gICAgICAgICAgXG4gICAgICAgICAgZHJvcGRvd24ub25DaGFuZ2UodmFsdWUgPT4ge1xuICAgICAgICAgICAgdGhpcy51c2VyQ2hvaWNlID0gTnVtYmVyKHZhbHVlKTtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyRHluYW1pY0ZpZWxkcyhkeW5hbWljRmllbGRDb250YWluZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIFxuICAgICAgY29udGVudEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuZXZhbGVkVXNlcklucHV0SW5mbyA9IHRoaXMudGVzdE1pbklucHV0UmVxdWlyZW1lbnRzKCk7XG4gICAgICAgIGlmICh0aGlzLmV2YWxlZFVzZXJJbnB1dEluZm8ubWVldHNNaW5SZXF1aXJlbWVudHMpIHtcbiAgICAgICAgICBzdWJtaXRCdXR0b24ucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgdGlrekdyYXBoQ29udGFpbmVyLmVtcHR5KCk7XG4gICAgICAgICAgXG4gICAgICAgICAgdGVtcG9yYXJ5RGVidWdBcmVhLmVtcHR5KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc3VibWl0QnV0dG9uLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwidHJ1ZVwiKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBcbiAgICB9XG4gIFxuICAgIHJlbmRlckR5bmFtaWNGaWVsZHMoY29udGFpbmVyOiBIVE1MRWxlbWVudCkge1xuICAgICAgXG4gICAgfVxuICBcbiAgICBwcml2YXRlIHRlc3RNaW5JbnB1dFJlcXVpcmVtZW50cygpIHtcbiAgICAgIHJldHVybiB7IG1lZXRzTWluUmVxdWlyZW1lbnRzOiB0cnVlLHNoYXBlOiBcInNoYXBlTmFtZVwiLCBjb29yZGluYXRlczogW10sIHNpZGVzOiB7fSwgYW5nbGVzOiBbXSB9O1xuICAgIH1cbiAgXG4gICAgcHJpdmF0ZSBoYW5kbGVTdWJtaXQoKSB7XG4gIFxuICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLmV2YWxlZFVzZXJJbnB1dEluZm87XG4gICAgICAgIHRoaXMucmVzdWx0Q29udGFpbmVyLnRleHRDb250ZW50ID0gSlNPTi5zdHJpbmdpZnkocmVzdWx0KTtcbiAgXG4gICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnNlc3Npb25IaXN0b3J5LnB1c2goe1xuICAgICAgICAgIGlucHV0OiB0aGlzLnVzZXJBbmdsZXNJbnB1dCxcbiAgICAgICAgICByZXN1bHQ6IHJlc3VsdFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICBcbiAgICB9XG4gICAgb25DbG9zZSgpIHtcbiAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgICAgY29udGVudEVsLmVtcHR5KCk7XG4gICAgfVxufVxuXG5cbmV4cG9ydCBjbGFzcyBIaXN0b3J5TW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG4gICAgcGx1Z2luOiBNYXRoUGx1Z2luO1xuICBcbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBNYXRoUGx1Z2luKSB7XG4gICAgICBzdXBlcihhcHApO1xuICAgICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgfVxuICBcbiAgICBvbk9wZW4oKSB7XG4gICAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbChcImgyXCIsIHsgdGV4dDogXCJTZXNzaW9uIEhpc3RvcnlcIiB9KTtcbiAgXG4gICAgICAvLyBJZiB0aGVyZSBpcyBubyBoaXN0b3J5LCBkaXNwbGF5IGEgbWVzc2FnZVxuICAgICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLnNlc3Npb25IaXN0b3J5Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBjb250ZW50RWwuY3JlYXRlRWwoXCJwXCIsIHsgdGV4dDogXCJObyBzZXNzaW9uIGhpc3RvcnkgZm91bmQuXCIgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgXG4gICAgICAvLyBEaXNwbGF5IGVhY2ggc2Vzc2lvbiBpbiB0aGUgaGlzdG9yeVxuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc2Vzc2lvbkhpc3RvcnkuZm9yRWFjaCgoc2Vzc2lvbiwgaW5kZXgpID0+IHtcbiAgICAgICAgY29uc3Qgc2Vzc2lvbkRpdiA9IGNvbnRlbnRFbC5jcmVhdGVFbChcImRpdlwiLCB7IGNsczogXCJoaXN0b3J5LXNlc3Npb25cIiB9KTtcbiAgICAgICAgc2Vzc2lvbkRpdi5jcmVhdGVFbChcImgzXCIsIHsgdGV4dDogYFNlc3Npb24gJHtpbmRleCArIDF9YCB9KTtcbiAgICAgICAgc2Vzc2lvbkRpdi5jcmVhdGVFbChcInBcIiwgeyB0ZXh0OiBgSW5wdXQ6ICR7c2Vzc2lvbi5pbnB1dH1gIH0pO1xuICAgICAgICBzZXNzaW9uRGl2LmNyZWF0ZUVsKFwicFwiLCB7IHRleHQ6IGBSZXN1bHQ6ICR7c2Vzc2lvbi5yZXN1bHR9YCB9KTtcbiAgICAgIH0pO1xuICBcbiAgICAgIC8vIENsb3NlIGJ1dHRvblxuICAgICAgY29uc3QgY2xvc2VCdXR0b24gPSBjb250ZW50RWwuY3JlYXRlRWwoXCJidXR0b25cIiwgeyB0ZXh0OiBcIkNsb3NlXCIgfSk7XG4gICAgICBjbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB9KTtcbiAgICB9XG4gIFxuICAgIG9uQ2xvc2UoKSB7XG4gICAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICAgIGNvbnRlbnRFbC5lbXB0eSgpOyAvLyBDbGVhbiB1cCBtb2RhbCBjb250ZW50IG9uIGNsb3NlXG4gICAgfVxuICB9XG4iXX0=