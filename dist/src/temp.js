import { Setting, Modal, Notice } from "obsidian";
import { createTextInputSetting } from "./settings";
export class vecInpotModel extends Modal {
    plugin;
    vectors = [];
    constructor(app, plugin) {
        super(app);
        this.plugin = plugin;
    }
    onOpen() {
        const inpotContainer = this.containerEl.createDiv("vec-inpot-fields-container");
        const graphContainer = this.containerEl.createDiv("vec-inpot-graph-conter");
        this.crateGrafh(graphContainer);
    }
    addFields() {
        //this.vectors.push()
    }
    crateGrafh(graphContainer) {
    }
}
export class InputModal extends Modal {
    plugin;
    userChoice = 0;
    userSidesInput = "";
    userAnglesInput = "";
    resultContainer;
    shapesCharacteristics;
    evaledUserInputInfo = null;
    savedValues = {};
    constructor(app, plugin) {
        super(app);
        this.plugin = plugin;
    }
    onOpen() {
        const { contentEl } = this;
        contentEl.createEl("h2", { text: "Enter Math Expression" });
        const dynamicFieldContainer = contentEl.createDiv({ cls: "dynamic-field-container" });
        const tikzGraphContainer = contentEl.createDiv({ cls: "tikz-graph-container" });
        const submitButton = contentEl.createEl("button", { text: "Submit", attr: { disabled: "true" } });
        const temporaryDebugArea = contentEl.createDiv({ cls: "temporary-debug-area" });
        submitButton.addEventListener("click", () => {
            if (this.evaledUserInputInfo && this.evaledUserInputInfo.meetsMinRequirements) {
                this.handleSubmit();
            }
            else {
                new Notice("Please enter valid input.");
            }
        });
        this.userChoice = 0;
        this.renderDynamicFields(dynamicFieldContainer);
        dynamicFieldContainer.addEventListener("input", () => {
            if (this.evaledUserInputInfo.meetsMinRequirements) {
                submitButton.removeAttribute("disabled");
                tikzGraphContainer.empty();
                temporaryDebugArea.empty();
            }
            else {
                submitButton.setAttribute("disabled", "true");
            }
        });
    }
    renderDynamicFields(container) {
        container.findAll(".dynamic-field").forEach(el => el.remove());
        this.userSidesInput = createTextInputSetting(container, "Coordinates", "Enter ${shape.coordinates}", "", "", "dynamic-field") || "";
        this.userSidesInput = createTextInputSetting(container, "Coordinates", "Enter ${shape.coordinates}", "", "", "dynamic-field") || "";
        new Setting(container)
            .addButton(button => button
            .setButtonText("add vec")
            .setTooltip("add a vecter")
            .onClick(() => {
            this.renderDynamicFields(container);
        }))
            .settingEl.addClass("dynamic-field");
        new Setting(container)
            .addButton(button => button
            .setButtonText("Clear")
            .setTooltip("Clear all previous fields")
            .onClick(() => {
            this.renderDynamicFields(container);
        }))
            .settingEl.addClass("dynamic-field");
    }
    handleSubmit() {
        const result = this.evaledUserInputInfo;
        this.resultContainer.textContent = JSON.stringify(result);
        this.plugin.settings.sessionHistory.push({
            input: this.userAnglesInput,
            result: result
        });
        this.plugin.saveSettings();
    }
    onClose() {
        const { contentEl } = this;
        contentEl.empty();
    }
}
export class CustomInputModal extends Modal {
    plugin;
    userChoice = 0;
    userSidesInput = "";
    userAnglesInput = "";
    resultContainer;
    shapesCharacteristics;
    evaledUserInputInfo = null;
    savedValues = {};
    constructor(app, plugin) {
        super(app);
        this.plugin = plugin;
    }
    onOpen() {
        const { contentEl } = this;
        contentEl.createEl("h2", { text: "Enter Math Expression" });
        // Assign shapesCharacteristics globally
        const settingsContainer = contentEl.createDiv({ cls: "settings-container" });
        const dynamicFieldContainer = contentEl.createDiv({ cls: "dynamic-field-container" });
        const tikzGraphContainer = contentEl.createDiv({ cls: "dynamic-field-container" });
        const submitButton = contentEl.createEl("button", { text: "Submit", attr: { disabled: "true" } });
        const temporaryDebugArea = contentEl.createDiv({ cls: "temporary-debug-area" });
        submitButton.addEventListener("click", () => {
            if (this.evaledUserInputInfo && this.evaledUserInputInfo.meetsMinRequirements) {
                this.handleSubmit();
            }
            else {
                new Notice("Please enter valid input.");
            }
        });
        new Setting(settingsContainer)
            .setName("Choose shape")
            .setDesc("Select the shape to perform the operations on.")
            .addDropdown(dropdown => {
            this.shapesCharacteristics.forEach((shape, index) => {
                dropdown.addOption(index.toString(), shape.name);
            });
            this.userChoice = 0;
            this.renderDynamicFields(dynamicFieldContainer);
            dropdown.onChange(value => {
                this.userChoice = Number(value);
                this.renderDynamicFields(dynamicFieldContainer);
            });
        });
        contentEl.addEventListener("input", () => {
            this.evaledUserInputInfo = this.testMinInputRequirements();
            if (this.evaledUserInputInfo.meetsMinRequirements) {
                submitButton.removeAttribute("disabled");
                tikzGraphContainer.empty();
                temporaryDebugArea.empty();
            }
            else {
                submitButton.setAttribute("disabled", "true");
            }
        });
    }
    renderDynamicFields(container) {
    }
    testMinInputRequirements() {
        return { meetsMinRequirements: true, shape: "shapeName", coordinates: [], sides: {}, angles: [] };
    }
    handleSubmit() {
        const result = this.evaledUserInputInfo;
        this.resultContainer.textContent = JSON.stringify(result);
        this.plugin.settings.sessionHistory.push({
            input: this.userAnglesInput,
            result: result
        });
        this.plugin.saveSettings();
    }
    onClose() {
        const { contentEl } = this;
        contentEl.empty();
    }
}
export class HistoryModal extends Modal {
    plugin;
    constructor(app, plugin) {
        super(app);
        this.plugin = plugin;
    }
    onOpen() {
        const { contentEl } = this;
        contentEl.createEl("h2", { text: "Session History" });
        // If there is no history, display a message
        if (this.plugin.settings.sessionHistory.length === 0) {
            contentEl.createEl("p", { text: "No session history found." });
            return;
        }
        // Display each session in the history
        this.plugin.settings.sessionHistory.forEach((session, index) => {
            const sessionDiv = contentEl.createEl("div", { cls: "history-session" });
            sessionDiv.createEl("h3", { text: `Session ${index + 1}` });
            sessionDiv.createEl("p", { text: `Input: ${session.input}` });
            sessionDiv.createEl("p", { text: `Result: ${session.result}` });
        });
        // Close button
        const closeButton = contentEl.createEl("button", { text: "Close" });
        closeButton.addEventListener("click", () => {
            this.close();
        });
    }
    onClose() {
        const { contentEl } = this;
        contentEl.empty(); // Clean up modal content on close
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVtcC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90ZW1wLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBK0MsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQXFDLE1BQU0sVUFBVSxDQUFDO0FBRWxJLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUlwRCxNQUFNLE9BQU8sYUFBYyxTQUFRLEtBQUs7SUFDcEMsTUFBTSxDQUFhO0lBQ25CLE9BQU8sR0FBQyxFQUFFLENBQUM7SUFFWCxZQUFZLEdBQVEsRUFBQyxNQUFrQjtRQUNuQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDVixJQUFJLENBQUMsTUFBTSxHQUFDLE1BQU0sQ0FBQztJQUN2QixDQUFDO0lBQ0QsTUFBTTtRQUNGLE1BQU0sY0FBYyxHQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLDRCQUE0QixDQUFDLENBQUM7UUFDOUUsTUFBTSxjQUFjLEdBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsd0JBQXdCLENBQUMsQ0FBQztRQUUxRSxJQUFJLENBQUMsVUFBVSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFDRCxTQUFTO1FBQ1AscUJBQXFCO0lBQ3ZCLENBQUM7SUFHRCxVQUFVLENBQUMsY0FBMkI7SUFDeEMsQ0FBQztDQUNGO0FBR0QsTUFBTSxPQUFPLFVBQVcsU0FBUSxLQUFLO0lBQ25DLE1BQU0sQ0FBYTtJQUNuQixVQUFVLEdBQUcsQ0FBQyxDQUFDO0lBQ2YsY0FBYyxHQUFHLEVBQUUsQ0FBQztJQUNwQixlQUFlLEdBQUcsRUFBRSxDQUFDO0lBQ3JCLGVBQWUsQ0FBYztJQUM3QixxQkFBcUIsQ0FBTTtJQUMzQixtQkFBbUIsR0FBUSxJQUFJLENBQUM7SUFDaEMsV0FBVyxHQUFRLEVBQUUsQ0FBQztJQUV0QixZQUFZLEdBQVEsRUFBRSxNQUFrQjtRQUN0QyxLQUFLLENB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M0IsU0FBUyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsa0NBQWtDO0lBQ3ZELENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBsdWdpbiwgTWFya2Rvd25WaWV3LCBNYXJrZG93blJlbmRlcmVyLCBBcHAsIFNldHRpbmcsIE1vZGFsLCBOb3RpY2UsIENvbXBvbmVudCwgRWRpdG9yLCBFZGl0b3JQb3NpdGlvbiB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IE1hdGhQbHVnaW4gZnJvbSBcIi4vbWFpblwiO1xuaW1wb3J0IHsgY3JlYXRlVGV4dElucHV0U2V0dGluZyB9IGZyb20gXCIuL3NldHRpbmdzXCI7XG5cblxuXG5leHBvcnQgY2xhc3MgdmVjSW5wb3RNb2RlbCBleHRlbmRzIE1vZGFse1xuICAgIHBsdWdpbjogTWF0aFBsdWdpbjtcbiAgICB2ZWN0b3JzPVtdO1xuXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAscGx1Z2luOiBNYXRoUGx1Z2luKXtcbiAgICAgICAgc3VwZXIoYXBwKVxuICAgICAgICB0aGlzLnBsdWdpbj1wbHVnaW47XG4gICAgfVxuICAgIG9uT3BlbigpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgaW5wb3RDb250YWluZXI9dGhpcy5jb250YWluZXJFbC5jcmVhdGVEaXYoXCJ2ZWMtaW5wb3QtZmllbGRzLWNvbnRhaW5lclwiKTtcbiAgICAgICAgY29uc3QgZ3JhcGhDb250YWluZXI9dGhpcy5jb250YWluZXJFbC5jcmVhdGVEaXYoXCJ2ZWMtaW5wb3QtZ3JhcGgtY29udGVyXCIpO1xuXG4gICAgICAgIHRoaXMuY3JhdGVHcmFmaChncmFwaENvbnRhaW5lcik7XG4gICAgfVxuICAgIGFkZEZpZWxkcygpe1xuICAgICAgLy90aGlzLnZlY3RvcnMucHVzaCgpXG4gICAgfVxuXG5cbiAgICBjcmF0ZUdyYWZoKGdyYXBoQ29udGFpbmVyOiBIVE1MRWxlbWVudCl7XG4gIH1cbn1cblxuXG5leHBvcnQgY2xhc3MgSW5wdXRNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgcGx1Z2luOiBNYXRoUGx1Z2luO1xuICB1c2VyQ2hvaWNlID0gMDtcbiAgdXNlclNpZGVzSW5wdXQgPSBcIlwiO1xuICB1c2VyQW5nbGVzSW5wdXQgPSBcIlwiO1xuICByZXN1bHRDb250YWluZXI6IEhUTUxFbGVtZW50O1xuICBzaGFwZXNDaGFyYWN0ZXJpc3RpY3M6IGFueTtcbiAgZXZhbGVkVXNlcklucHV0SW5mbzogYW55ID0gbnVsbDtcbiAgc2F2ZWRWYWx1ZXM6IGFueSA9IHt9O1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IE1hdGhQbHVnaW4pIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIFxuICB9XG5cbiAgb25PcGVuKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5jcmVhdGVFbChcImgyXCIsIHsgdGV4dDogXCJFbnRlciBNYXRoIEV4cHJlc3Npb25cIiB9KTtcblxuICAgIGNvbnN0IGR5bmFtaWNGaWVsZENvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoeyBjbHM6IFwiZHluYW1pYy1maWVsZC1jb250YWluZXJcIiB9KTtcbiAgICBjb25zdCB0aWt6R3JhcGhDb250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KHsgY2xzOiBcInRpa3otZ3JhcGgtY29udGFpbmVyXCIgfSk7XG4gICAgY29uc3Qgc3VibWl0QnV0dG9uID0gY29udGVudEVsLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHsgdGV4dDogXCJTdWJtaXRcIiwgYXR0cjogeyBkaXNhYmxlZDogXCJ0cnVlXCIgfSB9KTtcbiAgICBjb25zdCB0ZW1wb3JhcnlEZWJ1Z0FyZWEgPSBjb250ZW50RWwuY3JlYXRlRGl2KHsgY2xzOiBcInRlbXBvcmFyeS1kZWJ1Zy1hcmVhXCIgfSk7XG5cbiAgICBzdWJtaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIGlmICh0aGlzLmV2YWxlZFVzZXJJbnB1dEluZm8gJiYgdGhpcy5ldmFsZWRVc2VySW5wdXRJbmZvLm1lZXRzTWluUmVxdWlyZW1lbnRzKSB7XG4gICAgICAgIHRoaXMuaGFuZGxlU3VibWl0KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZXcgTm90aWNlKFwiUGxlYXNlIGVudGVyIHZhbGlkIGlucHV0LlwiKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMudXNlckNob2ljZSA9IDA7XG4gICAgdGhpcy5yZW5kZXJEeW5hbWljRmllbGRzKGR5bmFtaWNGaWVsZENvbnRhaW5lcik7XG4gICAgICAgIFxuICAgIGR5bmFtaWNGaWVsZENvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuZXZhbGVkVXNlcklucHV0SW5mby5tZWV0c01pblJlcXVpcmVtZW50cykge1xuICAgICAgICBzdWJtaXRCdXR0b24ucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIHRpa3pHcmFwaENvbnRhaW5lci5lbXB0eSgpO1xuICAgICAgICBcbiAgICAgICAgdGVtcG9yYXJ5RGVidWdBcmVhLmVtcHR5KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdWJtaXRCdXR0b24uc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICB9XG4gIHJlbmRlckR5bmFtaWNGaWVsZHMoY29udGFpbmVyOiBIVE1MRWxlbWVudCkge1xuICAgIGNvbnRhaW5lci5maW5kQWxsKFwiLmR5bmFtaWMtZmllbGRcIikuZm9yRWFjaChlbCA9PiBlbC5yZW1vdmUoKSk7XG4gICAgdGhpcy51c2VyU2lkZXNJbnB1dD1jcmVhdGVUZXh0SW5wdXRTZXR0aW5nKGNvbnRhaW5lcixcIkNvb3JkaW5hdGVzXCIsXCJFbnRlciAke3NoYXBlLmNvb3JkaW5hdGVzfVwiLFwiXCIsXCJcIixcImR5bmFtaWMtZmllbGRcIil8fFwiXCJcbiAgICB0aGlzLnVzZXJTaWRlc0lucHV0PWNyZWF0ZVRleHRJbnB1dFNldHRpbmcoY29udGFpbmVyLFwiQ29vcmRpbmF0ZXNcIixcIkVudGVyICR7c2hhcGUuY29vcmRpbmF0ZXN9XCIsXCJcIixcIlwiLFwiZHluYW1pYy1maWVsZFwiKXx8XCJcIlxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lcilcbiAgICAgIC5hZGRCdXR0b24oYnV0dG9uID0+XG4gICAgICAgIGJ1dHRvblxuICAgICAgICAgIC5zZXRCdXR0b25UZXh0KFwiYWRkIHZlY1wiKVxuICAgICAgICAgIC5zZXRUb29sdGlwKFwiYWRkIGEgdmVjdGVyXCIpXG4gICAgICAgICAgLm9uQ2xpY2soKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJEeW5hbWljRmllbGRzKGNvbnRhaW5lcik7XG4gICAgICAgICAgfSlcbiAgICAgIClcbiAgICAgIC5zZXR0aW5nRWwuYWRkQ2xhc3MoXCJkeW5hbWljLWZpZWxkXCIpO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyKVxuICAgICAgLmFkZEJ1dHRvbihidXR0b24gPT5cbiAgICAgICAgYnV0dG9uXG4gICAgICAgICAgLnNldEJ1dHRvblRleHQoXCJDbGVhclwiKVxuICAgICAgICAgIC5zZXRUb29sdGlwKFwiQ2xlYXIgYWxsIHByZXZpb3VzIGZpZWxkc1wiKVxuICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyRHluYW1pY0ZpZWxkcyhjb250YWluZXIpO1xuICAgICAgICAgIH0pXG4gICAgICApXG4gICAgICAuc2V0dGluZ0VsLmFkZENsYXNzKFwiZHluYW1pYy1maWVsZFwiKTtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlU3VibWl0KCkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5ldmFsZWRVc2VySW5wdXRJbmZvO1xuICAgICAgdGhpcy5yZXN1bHRDb250YWluZXIudGV4dENvbnRlbnQgPSBKU09OLnN0cmluZ2lmeShyZXN1bHQpO1xuXG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zZXNzaW9uSGlzdG9yeS5wdXNoKHtcbiAgICAgICAgaW5wdXQ6IHRoaXMudXNlckFuZ2xlc0lucHV0LFxuICAgICAgICByZXN1bHQ6IHJlc3VsdFxuICAgICAgfSk7XG4gICAgICB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICBcbiAgfVxuICBvbkNsb3NlKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICB9XG59XG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cbmV4cG9ydCBjbGFzcyBDdXN0b21JbnB1dE1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICAgIHBsdWdpbjogTWF0aFBsdWdpbjtcbiAgICB1c2VyQ2hvaWNlID0gMDtcbiAgICB1c2VyU2lkZXNJbnB1dCA9IFwiXCI7XG4gICAgdXNlckFuZ2xlc0lucHV0ID0gXCJcIjtcbiAgICByZXN1bHRDb250YWluZXI6IEhUTUxFbGVtZW50O1xuICAgIHNoYXBlc0NoYXJhY3RlcmlzdGljczogYW55O1xuICAgIGV2YWxlZFVzZXJJbnB1dEluZm86IGFueSA9IG51bGw7XG4gICAgc2F2ZWRWYWx1ZXM6IGFueSA9IHt9O1xuICBcbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBNYXRoUGx1Z2luKSB7XG4gICAgICBzdXBlcihhcHApO1xuICAgICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgfVxuICBcbiAgICBvbk9wZW4oKSB7XG4gICAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbChcImgyXCIsIHsgdGV4dDogXCJFbnRlciBNYXRoIEV4cHJlc3Npb25cIiB9KTtcbiAgXG4gICAgICAvLyBBc3NpZ24gc2hhcGVzQ2hhcmFjdGVyaXN0aWNzIGdsb2JhbGx5XG4gIFxuICAgICAgY29uc3Qgc2V0dGluZ3NDb250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KHsgY2xzOiBcInNldHRpbmdzLWNvbnRhaW5lclwiIH0pO1xuICAgICAgY29uc3QgZHluYW1pY0ZpZWxkQ29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdih7IGNsczogXCJkeW5hbWljLWZpZWxkLWNvbnRhaW5lclwiIH0pO1xuICAgICAgY29uc3QgdGlrekdyYXBoQ29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdih7IGNsczogXCJkeW5hbWljLWZpZWxkLWNvbnRhaW5lclwiIH0pO1xuICAgICAgY29uc3Qgc3VibWl0QnV0dG9uID0gY29udGVudEVsLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHsgdGV4dDogXCJTdWJtaXRcIiwgYXR0cjogeyBkaXNhYmxlZDogXCJ0cnVlXCIgfSB9KTtcbiAgICAgIGNvbnN0IHRlbXBvcmFyeURlYnVnQXJlYSA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoeyBjbHM6IFwidGVtcG9yYXJ5LWRlYnVnLWFyZWFcIiB9KTtcbiAgICAgIHN1Ym1pdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5ldmFsZWRVc2VySW5wdXRJbmZvICYmIHRoaXMuZXZhbGVkVXNlcklucHV0SW5mby5tZWV0c01pblJlcXVpcmVtZW50cykge1xuICAgICAgICAgIHRoaXMuaGFuZGxlU3VibWl0KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbmV3IE5vdGljZShcIlBsZWFzZSBlbnRlciB2YWxpZCBpbnB1dC5cIik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICBcbiAgICAgIG5ldyBTZXR0aW5nKHNldHRpbmdzQ29udGFpbmVyKVxuICAgICAgICAuc2V0TmFtZShcIkNob29zZSBzaGFwZVwiKVxuICAgICAgICAuc2V0RGVzYyhcIlNlbGVjdCB0aGUgc2hhcGUgdG8gcGVyZm9ybSB0aGUgb3BlcmF0aW9ucyBvbi5cIilcbiAgICAgICAgLmFkZERyb3Bkb3duKGRyb3Bkb3duID0+IHtcbiAgICAgICAgICB0aGlzLnNoYXBlc0NoYXJhY3RlcmlzdGljcy5mb3JFYWNoKChzaGFwZTogYW55LCBpbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24oaW5kZXgudG9TdHJpbmcoKSwgc2hhcGUubmFtZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdGhpcy51c2VyQ2hvaWNlID0gMDtcbiAgICAgICAgICB0aGlzLnJlbmRlckR5bmFtaWNGaWVsZHMoZHluYW1pY0ZpZWxkQ29udGFpbmVyKTtcbiAgICAgICAgICBcbiAgICAgICAgICBkcm9wZG93bi5vbkNoYW5nZSh2YWx1ZSA9PiB7XG4gICAgICAgICAgICB0aGlzLnVzZXJDaG9pY2UgPSBOdW1iZXIodmFsdWUpO1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJEeW5hbWljRmllbGRzKGR5bmFtaWNGaWVsZENvbnRhaW5lcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb250ZW50RWwuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5ldmFsZWRVc2VySW5wdXRJbmZvID0gdGhpcy50ZXN0TWluSW5wdXRSZXF1aXJlbWVudHMoKTtcbiAgICAgICAgaWYgKHRoaXMuZXZhbGVkVXNlcklucHV0SW5mby5tZWV0c01pblJlcXVpcmVtZW50cykge1xuICAgICAgICAgIHN1Ym1pdEJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICB0aWt6R3JhcGhDb250YWluZXIuZW1wdHkoKTtcbiAgICAgICAgICBcbiAgICAgICAgICB0ZW1wb3JhcnlEZWJ1Z0FyZWEuZW1wdHkoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzdWJtaXRCdXR0b24uc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIFxuICAgIH1cbiAgXG4gICAgcmVuZGVyRHluYW1pY0ZpZWxkcyhjb250YWluZXI6IEhUTUxFbGVtZW50KSB7XG4gICAgICBcbiAgICB9XG4gIFxuICAgIHByaXZhdGUgdGVzdE1pbklucHV0UmVxdWlyZW1lbnRzKCkge1xuICAgICAgcmV0dXJuIHsgbWVldHNNaW5SZXF1aXJlbWVudHM6IHRydWUsc2hhcGU6IFwic2hhcGVOYW1lXCIsIGNvb3JkaW5hdGVzOiBbXSwgc2lkZXM6IHt9LCBhbmdsZXM6IFtdIH07XG4gICAgfVxuICBcbiAgICBwcml2YXRlIGhhbmRsZVN1Ym1pdCgpIHtcbiAgXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuZXZhbGVkVXNlcklucHV0SW5mbztcbiAgICAgICAgdGhpcy5yZXN1bHRDb250YWluZXIudGV4dENvbnRlbnQgPSBKU09OLnN0cmluZ2lmeShyZXN1bHQpO1xuICBcbiAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc2Vzc2lvbkhpc3RvcnkucHVzaCh7XG4gICAgICAgICAgaW5wdXQ6IHRoaXMudXNlckFuZ2xlc0lucHV0LFxuICAgICAgICAgIHJlc3VsdDogcmVzdWx0XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgIFxuICAgIH1cbiAgICBvbkNsb3NlKCkge1xuICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICB9XG59XG5cblxuZXhwb3J0IGNsYXNzIEhpc3RvcnlNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgICBwbHVnaW46IE1hdGhQbHVnaW47XG4gIFxuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IE1hdGhQbHVnaW4pIHtcbiAgICAgIHN1cGVyKGFwcCk7XG4gICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB9XG4gIFxuICAgIG9uT3BlbigpIHtcbiAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgICAgY29udGVudEVsLmNyZWF0ZUVsKFwiaDJcIiwgeyB0ZXh0OiBcIlNlc3Npb24gSGlzdG9yeVwiIH0pO1xuICBcbiAgICAgIC8vIElmIHRoZXJlIGlzIG5vIGhpc3RvcnksIGRpc3BsYXkgYSBtZXNzYWdlXG4gICAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3Muc2Vzc2lvbkhpc3RvcnkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbChcInBcIiwgeyB0ZXh0OiBcIk5vIHNlc3Npb24gaGlzdG9yeSBmb3VuZC5cIiB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICBcbiAgICAgIC8vIERpc3BsYXkgZWFjaCBzZXNzaW9uIGluIHRoZSBoaXN0b3J5XG4gICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zZXNzaW9uSGlzdG9yeS5mb3JFYWNoKChzZXNzaW9uLCBpbmRleCkgPT4ge1xuICAgICAgICBjb25zdCBzZXNzaW9uRGl2ID0gY29udGVudEVsLmNyZWF0ZUVsKFwiZGl2XCIsIHsgY2xzOiBcImhpc3Rvcnktc2Vzc2lvblwiIH0pO1xuICAgICAgICBzZXNzaW9uRGl2LmNyZWF0ZUVsKFwiaDNcIiwgeyB0ZXh0OiBgU2Vzc2lvbiAke2luZGV4ICsgMX1gIH0pO1xuICAgICAgICBzZXNzaW9uRGl2LmNyZWF0ZUVsKFwicFwiLCB7IHRleHQ6IGBJbnB1dDogJHtzZXNzaW9uLmlucHV0fWAgfSk7XG4gICAgICAgIHNlc3Npb25EaXYuY3JlYXRlRWwoXCJwXCIsIHsgdGV4dDogYFJlc3VsdDogJHtzZXNzaW9uLnJlc3VsdH1gIH0pO1xuICAgICAgfSk7XG4gIFxuICAgICAgLy8gQ2xvc2UgYnV0dG9uXG4gICAgICBjb25zdCBjbG9zZUJ1dHRvbiA9IGNvbnRlbnRFbC5jcmVhdGVFbChcImJ1dHRvblwiLCB7IHRleHQ6IFwiQ2xvc2VcIiB9KTtcbiAgICAgIGNsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgXG4gICAgb25DbG9zZSgpIHtcbiAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgICAgY29udGVudEVsLmVtcHR5KCk7IC8vIENsZWFuIHVwIG1vZGFsIGNvbnRlbnQgb24gY2xvc2VcbiAgICB9XG4gIH1cbiJdfQ==