import { StateEffect, StateField } from "@codemirror/state";
import { SnippetChangeSpec } from "./snippet_change_spec";
const queueSnippetEffect = StateEffect.define();
const clearSnippetQueueEffect = StateEffect.define();
export const snippetQueueStateField = StateField.define({
    create() {
        return [];
    },
    update(oldState, transaction) {
        let snippetQueue = oldState;
        for (const effect of transaction.effects) {
            if (effect.is(queueSnippetEffect)) {
                snippetQueue.push(effect.value);
            }
            else if (effect.is(clearSnippetQueueEffect)) {
                snippetQueue = [];
            }
        }
        return snippetQueue;
    },
});
export function queueSnippet(view, from, to, insert, keyPressed) {
    const snippet = new SnippetChangeSpec(from, to, insert, keyPressed);
    view.dispatch({
        effects: [queueSnippetEffect.of(snippet)],
    });
}
export function clearSnippetQueue(view) {
    view.dispatch({
        effects: [clearSnippetQueueEffect.of(null)],
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic25pcHBldF9xdWV1ZV9zdGF0ZV9maWVsZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb2RlbWlycm9yL3NuaXBwZXRfcXVldWVfc3RhdGVfZmllbGQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLFdBQVcsRUFBRSxVQUFVLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUM1RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUUxRCxNQUFNLGtCQUFrQixHQUFHLFdBQVcsQ0FBQyxNQUFNLEVBQXFCLENBQUM7QUFDbkUsTUFBTSx1QkFBdUIsR0FBRyxXQUFXLENBQUMsTUFBTSxFQUFFLENBQUM7QUFFckQsTUFBTSxDQUFDLE1BQU0sc0JBQXNCLEdBQUcsVUFBVSxDQUFDLE1BQU0sQ0FBc0I7SUFFNUUsTUFBTTtRQUNMLE9BQU8sRUFBRSxDQUFDO0lBQ1gsQ0FBQztJQUVELE1BQU0sQ0FBQyxRQUFRLEVBQUUsV0FBVztRQUMzQixJQUFJLFlBQVksR0FBRyxRQUFRLENBQUM7UUFFNUIsS0FBSyxNQUFNLE1BQU0sSUFBSSxXQUFXLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDMUMsSUFBSSxNQUFNLENBQUMsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEVBQUUsQ0FBQztnQkFDbkMsWUFBWSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDakMsQ0FBQztpQkFDSSxJQUFJLE1BQU0sQ0FBQyxFQUFFLENBQUMsdUJBQXVCLENBQUMsRUFBRSxDQUFDO2dCQUM3QyxZQUFZLEdBQUcsRUFBRSxDQUFDO1lBQ25CLENBQUM7UUFDRixDQUFDO1FBRUQsT0FBTyxZQUFZLENBQUM7SUFDckIsQ0FBQztDQUNELENBQUMsQ0FBQztBQUdILE1BQU0sVUFBVSxZQUFZLENBQUMsSUFBZ0IsRUFBRSxJQUFZLEVBQUUsRUFBVSxFQUFFLE1BQWMsRUFBRSxVQUFtQjtJQUMzRyxNQUFNLE9BQU8sR0FBRyxJQUFJLGlCQUFpQixDQUFDLElBQUksRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBRXBFLElBQUksQ0FBQyxRQUFRLENBQUM7UUFDYixPQUFPLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUM7S0FDekMsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQUVELE1BQU0sVUFBVSxpQkFBaUIsQ0FBQyxJQUFnQjtJQUNqRCxJQUFJLENBQUMsUUFBUSxDQUFDO1FBQ2IsT0FBTyxFQUFFLENBQUMsdUJBQXVCLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO0tBQzNDLENBQUMsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFZGl0b3JWaWV3IH0gZnJvbSBcIkBjb2RlbWlycm9yL3ZpZXdcIjtcbmltcG9ydCB7IFN0YXRlRWZmZWN0LCBTdGF0ZUZpZWxkIH0gZnJvbSBcIkBjb2RlbWlycm9yL3N0YXRlXCI7XG5pbXBvcnQgeyBTbmlwcGV0Q2hhbmdlU3BlYyB9IGZyb20gXCIuL3NuaXBwZXRfY2hhbmdlX3NwZWNcIjtcblxuY29uc3QgcXVldWVTbmlwcGV0RWZmZWN0ID0gU3RhdGVFZmZlY3QuZGVmaW5lPFNuaXBwZXRDaGFuZ2VTcGVjPigpO1xuY29uc3QgY2xlYXJTbmlwcGV0UXVldWVFZmZlY3QgPSBTdGF0ZUVmZmVjdC5kZWZpbmUoKTtcblxuZXhwb3J0IGNvbnN0IHNuaXBwZXRRdWV1ZVN0YXRlRmllbGQgPSBTdGF0ZUZpZWxkLmRlZmluZTxTbmlwcGV0Q2hhbmdlU3BlY1tdPih7XG5cblx0Y3JlYXRlKCkge1xuXHRcdHJldHVybiBbXTtcblx0fSxcblxuXHR1cGRhdGUob2xkU3RhdGUsIHRyYW5zYWN0aW9uKSB7XG5cdFx0bGV0IHNuaXBwZXRRdWV1ZSA9IG9sZFN0YXRlO1xuXG5cdFx0Zm9yIChjb25zdCBlZmZlY3Qgb2YgdHJhbnNhY3Rpb24uZWZmZWN0cykge1xuXHRcdFx0aWYgKGVmZmVjdC5pcyhxdWV1ZVNuaXBwZXRFZmZlY3QpKSB7XG5cdFx0XHRcdHNuaXBwZXRRdWV1ZS5wdXNoKGVmZmVjdC52YWx1ZSk7XG5cdFx0XHR9XG5cdFx0XHRlbHNlIGlmIChlZmZlY3QuaXMoY2xlYXJTbmlwcGV0UXVldWVFZmZlY3QpKSB7XG5cdFx0XHRcdHNuaXBwZXRRdWV1ZSA9IFtdO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBzbmlwcGV0UXVldWU7XG5cdH0sXG59KTtcblxuXG5leHBvcnQgZnVuY3Rpb24gcXVldWVTbmlwcGV0KHZpZXc6IEVkaXRvclZpZXcsIGZyb206IG51bWJlciwgdG86IG51bWJlciwgaW5zZXJ0OiBzdHJpbmcsIGtleVByZXNzZWQ/OiBzdHJpbmcpIHtcblx0Y29uc3Qgc25pcHBldCA9IG5ldyBTbmlwcGV0Q2hhbmdlU3BlYyhmcm9tLCB0bywgaW5zZXJ0LCBrZXlQcmVzc2VkKTtcblxuXHR2aWV3LmRpc3BhdGNoKHtcblx0XHRlZmZlY3RzOiBbcXVldWVTbmlwcGV0RWZmZWN0Lm9mKHNuaXBwZXQpXSxcblx0fSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjbGVhclNuaXBwZXRRdWV1ZSh2aWV3OiBFZGl0b3JWaWV3KSB7XG5cdHZpZXcuZGlzcGF0Y2goe1xuXHRcdGVmZmVjdHM6IFtjbGVhclNuaXBwZXRRdWV1ZUVmZmVjdC5vZihudWxsKV0sXG5cdH0pO1xufSJdfQ==