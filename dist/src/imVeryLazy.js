import { Position } from "./mathEngine";
export function expandExpression(tokens, position) {
    if (position.checkFrac()) {
        goodByFraction(tokens, position);
        return;
    }
    let left = tokens.tokens.slice(position.left.breakChar, position.index).filter(item => /(number|variable|powerVariable)/.test(item.type));
    let right = tokens.tokens.slice(position.index, position.right.breakChar).filter(item => /(number|variable|powerVariable)/.test(item.type));
    const isLeftMultiStep = position.left.multiStep === undefined;
    if (position.operator === "-" && isLeftMultiStep) {
        left = [{ "type": "number", "value": -1, "index": 0 }];
    }
    let replacementCell = [];
    //console.log(left,right)
    for (let i = 0; i < left.length; i++) {
        for (let j = 0; j < right.length; j++) {
            replacementCell.push(left[i]);
            replacementCell.push({ "type": "operator", "value": "*", "index": 0 });
            replacementCell.push(right[j]);
        }
    }
    /* we have the prane but for sum resun its takin one two moch i dont k
    */
    const is = position.operator === "-" && isLeftMultiStep;
    const start = is ? position.index : position.left.breakChar;
    const length = position.right.breakChar - (is ? position.index : position.left.breakChar);
    tokens.insertTokens(start, length + (isLeftMultiStep ? 0 : 1), replacementCell);
    //console.log(length,isLeftMultiStep,tokens.tokens,tokens.reconstruct(),replacementCell)
    tokens.reIDparentheses();
}
export const curlyBracketsRegex = new RegExp("(frac|sqrt|\\^|\\/|binom)");
function goodByFraction(tokens, position) {
    let replacementTokens = [];
    /*We rely on the denominator to already possess parentheses
    We rely on the fact. that both the nominator and the denominator both have parentheses and closing them
    All calculations are according to that.
    */
    let denominator = tokens.tokens.slice(position.transition, position.right.breakChar + 1);
    for (let i = 0; i < tokens.tokens.length; i++) {
        if (i >= position.index && i < position.right.breakChar) {
            replacementTokens.push(...tokens.tokens.slice(position.index + 1, position.transition));
            i = position.right.breakChar;
            continue;
        }
        if (/(=)/.test(tokens.tokens[i].value)) {
            replacementTokens.push(tokens.tokens[i]);
            continue;
        }
        let replacement = tokens.tokens.slice(i, i + 1);
        let whereAmI = i;
        let rest = [];
        if (tokens.tokens[i].value === "frac") {
            whereAmI = new Position(tokens, i);
            replacementTokens.push(...tokens.tokens.slice(whereAmI.index, whereAmI.index + 2));
            //nominator
            rest = tokens.tokens.slice(whereAmI.transition - 1, whereAmI.right.breakChar);
            // denominator
            replacement = tokens.tokens.slice(i + 2, whereAmI.transition - 1);
        }
        else {
            whereAmI = i + tokens.tokens.slice(i).findIndex(token => /(=|frac)/.test(token.value));
            whereAmI = whereAmI < i ? tokens.tokens.length : whereAmI;
            replacement = tokens.tokens.slice(i, whereAmI);
        }
        replacementTokens.push(...denominator, { "type": "operator", "value": "*" }, { "type": "paren", "value": "(", "id": 0, "index": 0 }, ...replacement, { "type": "paren", "value": ")", "id": 0, "index": 0 }, ...rest);
        i = typeof whereAmI === "object" ? whereAmI.right.breakChar - 1 : whereAmI - 1;
    }
    tokens.tokens = replacementTokens;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1WZXJ5TGF6eS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9pbVZlcnlMYXp5LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFFeEMsTUFBTSxVQUFVLGdCQUFnQixDQUFDLE1BQU0sRUFBRSxRQUFRO0lBQzdDLElBQUksUUFBUSxDQUFDLFNBQVMsRUFBRSxFQUFDLENBQUM7UUFBQSxjQUFjLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQUEsT0FBTztJQUFBLENBQUM7SUFDbkUsSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLGlDQUFpQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUMxSSxJQUFJLEtBQUssR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsaUNBQWlDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQzVJLE1BQU0sZUFBZSxHQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBUyxLQUFHLFNBQVMsQ0FBQztJQUUxRCxJQUFJLFFBQVEsQ0FBQyxRQUFRLEtBQUcsR0FBRyxJQUFFLGVBQWUsRUFBQyxDQUFDO1FBQzFDLElBQUksR0FBRyxDQUFDLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUE7SUFFMUQsQ0FB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USxDQUFDLENBQUM7UUFDbEQsQ0FBQztRQUNELGlCQUFpQixDQUFDLElBQUksQ0FDbEIsR0FBRyxXQUFXLEVBQ2QsRUFBQyxNQUFNLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUMsRUFDbEMsRUFBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFDLEVBQ3BELEdBQUcsV0FBVyxFQUNkLEVBQUMsTUFBTSxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBQyxFQUNwRCxHQUFHLElBQUksQ0FDVixDQUFDO1FBQ0YsQ0FBQyxHQUFHLE9BQU8sUUFBUSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxTQUFTLEdBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLEdBQUMsQ0FBQyxDQUFDO0lBQy9FLENBQUM7SUFDRCxNQUFNLENBQUMsTUFBTSxHQUFDLGlCQUFpQixDQUFDO0FBQ3BDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQb3NpdGlvbiB9IGZyb20gXCIuL21hdGhFbmdpbmVcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGV4cGFuZEV4cHJlc3Npb24odG9rZW5zLCBwb3NpdGlvbikge1xuICAgIGlmIChwb3NpdGlvbi5jaGVja0ZyYWMoKSl7Z29vZEJ5RnJhY3Rpb24odG9rZW5zLCBwb3NpdGlvbik7cmV0dXJuO31cbiAgICBsZXQgbGVmdCA9IHRva2Vucy50b2tlbnMuc2xpY2UocG9zaXRpb24ubGVmdC5icmVha0NoYXIsIHBvc2l0aW9uLmluZGV4KS5maWx0ZXIoaXRlbSA9PiAvKG51bWJlcnx2YXJpYWJsZXxwb3dlclZhcmlhYmxlKS8udGVzdChpdGVtLnR5cGUpKTtcbiAgICBsZXQgcmlnaHQgPSB0b2tlbnMudG9rZW5zLnNsaWNlKHBvc2l0aW9uLmluZGV4LCBwb3NpdGlvbi5yaWdodC5icmVha0NoYXIpLmZpbHRlcihpdGVtID0+IC8obnVtYmVyfHZhcmlhYmxlfHBvd2VyVmFyaWFibGUpLy50ZXN0KGl0ZW0udHlwZSkpO1xuICAgIGNvbnN0IGlzTGVmdE11bHRpU3RlcD1wb3NpdGlvbi5sZWZ0Lm11bHRpU3RlcD09PXVuZGVmaW5lZDtcblxuICAgIGlmIChwb3NpdGlvbi5vcGVyYXRvcj09PVwiLVwiJiZpc0xlZnRNdWx0aVN0ZXApe1xuICAgICAgICBsZWZ0ID0gW3sgXCJ0eXBlXCI6IFwibnVtYmVyXCIsIFwidmFsdWVcIjogLTEsIFwiaW5kZXhcIjogMCB9XVxuICAgICAgICBcbiAgICB9XG4gICAgbGV0IHJlcGxhY2VtZW50Q2VsbCA9IFtdO1xuICAgIC8vY29uc29sZS5sb2cobGVmdCxyaWdodClcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlZnQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCByaWdodC5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgcmVwbGFjZW1lbnRDZWxsLnB1c2gobGVmdFtpXSk7XG4gICAgICAgICAgICByZXBsYWNlbWVudENlbGwucHVzaCh7IFwidHlwZVwiOiBcIm9wZXJhdG9yXCIsIFwidmFsdWVcIjogXCIqXCIsIFwiaW5kZXhcIjogMCB9KTtcbiAgICAgICAgICAgIHJlcGxhY2VtZW50Q2VsbC5wdXNoKHJpZ2h0W2pdKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiB3ZSBoYXZlIHRoZSBwcmFuZSBidXQgZm9yIHN1bSByZXN1biBpdHMgdGFraW4gb25lIHR3byBtb2NoIGkgZG9udCBrXG4gICAgKi9cbiAgICBjb25zdCBpcz1wb3NpdGlvbi5vcGVyYXRvcj09PVwiLVwiJiZpc0xlZnRNdWx0aVN0ZXA7XG4gICAgY29uc3Qgc3RhcnQ9aXM/cG9zaXRpb24uaW5kZXg6cG9zaXRpb24ubGVmdC5icmVha0NoYXJcbiAgICBjb25zdCBsZW5ndGg9cG9zaXRpb24ucmlnaHQuYnJlYWtDaGFyLShpcz9wb3NpdGlvbi5pbmRleDpwb3NpdGlvbi5sZWZ0LmJyZWFrQ2hhcilcblxuICAgIHRva2Vucy5pbnNlcnRUb2tlbnMoc3RhcnQsIGxlbmd0aCsoaXNMZWZ0TXVsdGlTdGVwPzA6MSksIHJlcGxhY2VtZW50Q2VsbCk7XG4gICAgLy9jb25zb2xlLmxvZyhsZW5ndGgsaXNMZWZ0TXVsdGlTdGVwLHRva2Vucy50b2tlbnMsdG9rZW5zLnJlY29uc3RydWN0KCkscmVwbGFjZW1lbnRDZWxsKVxuICAgIHRva2Vucy5yZUlEcGFyZW50aGVzZXMoKTtcbn1cblxuZXhwb3J0IGNvbnN0IGN1cmx5QnJhY2tldHNSZWdleCA9IG5ldyBSZWdFeHAoXCIoZnJhY3xzcXJ0fFxcXFxefFxcXFwvfGJpbm9tKVwiKVxuXG5cblxuZnVuY3Rpb24gZ29vZEJ5RnJhY3Rpb24odG9rZW5zLCBwb3NpdGlvbikge1xuICAgIGxldCByZXBsYWNlbWVudFRva2VucyA9IFtdO1xuICAgIC8qV2UgcmVseSBvbiB0aGUgZGVub21pbmF0b3IgdG8gYWxyZWFkeSBwb3NzZXNzIHBhcmVudGhlc2VzXG4gICAgV2UgcmVseSBvbiB0aGUgZmFjdC4gdGhhdCBib3RoIHRoZSBub21pbmF0b3IgYW5kIHRoZSBkZW5vbWluYXRvciBib3RoIGhhdmUgcGFyZW50aGVzZXMgYW5kIGNsb3NpbmcgdGhlbSBcbiAgICBBbGwgY2FsY3VsYXRpb25zIGFyZSBhY2NvcmRpbmcgdG8gdGhhdC5cbiAgICAqL1xuICAgIGxldCBkZW5vbWluYXRvciA9IHRva2Vucy50b2tlbnMuc2xpY2UocG9zaXRpb24udHJhbnNpdGlvbiwgcG9zaXRpb24ucmlnaHQuYnJlYWtDaGFyKzEpO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b2tlbnMudG9rZW5zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIFxuICAgICAgICBpZiAoaSA+PSBwb3NpdGlvbi5pbmRleCAmJiBpIDwgcG9zaXRpb24ucmlnaHQuYnJlYWtDaGFyKSB7XG4gICAgICAgICAgICByZXBsYWNlbWVudFRva2Vucy5wdXNoKC4uLnRva2Vucy50b2tlbnMuc2xpY2UocG9zaXRpb24uaW5kZXgrMSxwb3NpdGlvbi50cmFuc2l0aW9uKSlcbiAgICAgICAgICAgIGkgPSBwb3NpdGlvbi5yaWdodC5icmVha0NoYXI7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoLyg9KS8udGVzdCh0b2tlbnMudG9rZW5zW2ldLnZhbHVlKSkge1xuICAgICAgICAgICAgcmVwbGFjZW1lbnRUb2tlbnMucHVzaCh0b2tlbnMudG9rZW5zW2ldKTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBsZXQgcmVwbGFjZW1lbnQgPSB0b2tlbnMudG9rZW5zLnNsaWNlKGksaSsxKVxuICAgICAgICBsZXQgd2hlcmVBbUkgPSBpO1xuICAgICAgICBsZXQgcmVzdD1bXTtcblxuICAgICAgICBpZiAodG9rZW5zLnRva2Vuc1tpXS52YWx1ZSA9PT0gXCJmcmFjXCIpIHtcbiAgICAgICAgICAgIHdoZXJlQW1JID0gbmV3IFBvc2l0aW9uKHRva2VucywgaSk7XG4gICAgICAgICAgICByZXBsYWNlbWVudFRva2Vucy5wdXNoKC4uLnRva2Vucy50b2tlbnMuc2xpY2Uod2hlcmVBbUkuaW5kZXgsd2hlcmVBbUkuaW5kZXgrMikpXG4gICAgICAgICAgICAvL25vbWluYXRvclxuICAgICAgICAgICAgcmVzdD10b2tlbnMudG9rZW5zLnNsaWNlKHdoZXJlQW1JLnRyYW5zaXRpb24tMSx3aGVyZUFtSS5yaWdodC5icmVha0NoYXIpXG4gICAgICAgICAgICAvLyBkZW5vbWluYXRvclxuICAgICAgICAgICAgcmVwbGFjZW1lbnQgPSB0b2tlbnMudG9rZW5zLnNsaWNlKGkgKyAyLCB3aGVyZUFtSS50cmFuc2l0aW9uLTEpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2V7XG4gICAgICAgICAgICB3aGVyZUFtST1pK3Rva2Vucy50b2tlbnMuc2xpY2UoaSkuZmluZEluZGV4KHRva2VuID0+IC8oPXxmcmFjKS8udGVzdCh0b2tlbi52YWx1ZSkpXG4gICAgICAgICAgICB3aGVyZUFtST13aGVyZUFtSTxpP3Rva2Vucy50b2tlbnMubGVuZ3RoOndoZXJlQW1JO1xuICAgICAgICAgICAgcmVwbGFjZW1lbnQgPSB0b2tlbnMudG9rZW5zLnNsaWNlKGksd2hlcmVBbUkpO1xuICAgICAgICB9XG4gICAgICAgIHJlcGxhY2VtZW50VG9rZW5zLnB1c2goXG4gICAgICAgICAgICAuLi5kZW5vbWluYXRvcixcbiAgICAgICAgICAgIHtcInR5cGVcIjogXCJvcGVyYXRvclwiLCBcInZhbHVlXCI6IFwiKlwifSxcbiAgICAgICAgICAgIHtcInR5cGVcIjogXCJwYXJlblwiLCBcInZhbHVlXCI6IFwiKFwiLCBcImlkXCI6IDAsIFwiaW5kZXhcIjogMH0sXG4gICAgICAgICAgICAuLi5yZXBsYWNlbWVudCxcbiAgICAgICAgICAgIHtcInR5cGVcIjogXCJwYXJlblwiLCBcInZhbHVlXCI6IFwiKVwiLCBcImlkXCI6IDAsIFwiaW5kZXhcIjogMH0sXG4gICAgICAgICAgICAuLi5yZXN0XG4gICAgICAgICk7XG4gICAgICAgIGkgPSB0eXBlb2Ygd2hlcmVBbUkgPT09IFwib2JqZWN0XCIgPyB3aGVyZUFtSS5yaWdodC5icmVha0NoYXItMSA6IHdoZXJlQW1JLTE7XG4gICAgfVxuICAgIHRva2Vucy50b2tlbnM9cmVwbGFjZW1lbnRUb2tlbnM7XG59Il19