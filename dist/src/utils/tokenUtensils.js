export class Paren {
    type;
    depth;
    depthID;
    constructor(depth, depthID, type) {
        this.depth = depth;
        this.depthID = depthID;
        this.type = type;
    }
    toString() { this.id = this.depth + "." + this.depthID; }
    compare(Paren) { return this.depth === Paren.depth && this.depthID === Paren.depthID; }
    addDepth(num) { this.depth += num; }
    adddepthID(num) { this.depthID += num; }
}
const open = ['Parentheses_open', 'Curly_brackets_open', 'Square_brackets_open'];
const close = ['Parentheses_close', 'Curly_brackets_close', 'Square_brackets_close'];
export function idParentheses(tokens) {
    let depth = 0;
    const depthCounts = {};
    for (let i = 0; i < tokens.length; i++) {
        const token = tokens[i];
        if (open.includes(token.name)) {
            if (!depthCounts[depth]) {
                depthCounts[depth] = 0;
            }
            const depthID = depthCounts[depth]++;
            token.value = new Paren(depth, depthID, token.value);
            // Increase depth for nested parentheses
            depth++;
            continue;
        }
        if (close.includes(token.name)) {
            // Decrease depth and check for unmatched closing parenthesis
            depth--;
            if (depth < 0) {
                console.error(token.value, tokens);
                throw new Error("Unmatched closing parenthesis detected.");
            }
            // Assign a unique ID to the closing parenthesis
            const depthID = depthCounts[depth] - 1;
            token.value = new Paren(depth, depthID, token.value);
        }
    }
    // Check for unmatched opening parentheses
    if (depth !== 0) {
        console.error(tokens);
        throw new Error(`Unmatched opening parenthesis(es) detected: depth=${depth}`);
    }
}
export function mapBrackets(type, tokens) {
    return tokens
        .map((token, index) => token.name === type
        ? findParenIndex(token.value, undefined, tokens)
        : null)
        .filter((t) => t !== null);
}
export function findModifiedParenIndex(id, index, tokens, depth, depthID, filter) {
    // Initialize `id` as a new instance if not already provided
    id = id
        ? new Paren(id.depth, id.depthID)
        : new Paren(tokens[index].value.depth, tokens[index].value.depthID);
    if (depth !== undefined && depthID !== undefined) {
        id.depth += depth || 0;
        id.depthID += depthID || 0;
    }
    const openIndex = tokens.findIndex(token => {
        if (open.includes(token.name) && token.value?.compare(id)) {
            if (filter && !token.name.startsWith(filter)) {
                id.depth = token.value.depth + (depth || 0);
                id.depthID = token.value.depthID + (depthID || 0);
                return false;
            }
            return true;
        }
        return false;
    });
    const closeIndex = tokens.findLastIndex(token => close.includes(token.name) &&
        token.value?.compare(id));
    return { open: openIndex, close: closeIndex, id };
}
export function findParenIndex(id, index, tokens) {
    id = id ? id : tokens[index].value;
    const openIndex = tokens.findIndex(token => open.includes(token.name)
        && token.value?.compare(id));
    const closeIndex = tokens.findLastIndex(token => close.includes(token.name)
        && token.value?.compare(id));
    return { open: openIndex, close: closeIndex, id: id };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9rZW5VdGVuc2lscy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy91dGlscy90b2tlblV0ZW5zaWxzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU0sT0FBTyxLQUFLO0lBQ2QsSUFBSSxDQUFDO0lBQ0wsS0FBSyxDQUFDO0lBQ04sT0FBTyxDQUFDO0lBRVIsWUFBWSxLQUFLLEVBQUMsT0FBTyxFQUFDLElBQUk7UUFDMUIsSUFBSSxDQUFDLEtBQUssR0FBQyxLQUFLLENBQUM7UUFDakIsSUFBSSxDQUFDLE9BQU8sR0FBQyxPQUFPLENBQUM7UUFDckIsSUFBSSxDQUFDLElBQUksR0FBQyxJQUFJLENBQUE7SUFDbEIsQ0FBQztJQUNELFFBQVEsS0FBRyxJQUFJLENBQUMsRUFBRSxHQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUEsQ0FBQSxDQUFDO0lBQ25ELE9BQU8sQ0FBQyxLQUFLLElBQUUsT0FBTyxJQUFJLENBQUMsS0FBSyxLQUFHLEtBQUssQ0FBQyxLQUFLLElBQUUsSUFBSSxDQUFDLE9BQU8sS0FBRyxLQUFLLENBQUMsT0FBTyxDQUFBLENBQUEsQ0FBQztJQUM3RSxRQUFRLENBQUMsR0FBRyxJQUFFLElBQUksQ0FBQyxLQUFLLElBQUUsR0FBRyxDQUFBLENBQUEsQ0FBQztJQUM5QixVQUFVLENBQUMsR0FBRyxJQUFFLElBQUksQ0FBQyxPQUFPLElBQUUsR0FBRyxDQUFBLENBQUEsQ0FBQztDQUNyQztBQUNELE1BQU0sSUFBSSxHQUFDLENBQUMsa0JBQWtCLEVBQUMscUJBQXFCLEVBQUMsc0JBQXNCLENBQUMsQ0FBQztBQUM3RSxNQUFNLEtBQUssR0FBQyxDQUFDLG1CQUFtQixFQUFDLHNCQUFzQixFQUFDLHVCQUF1QixDQUFDLENBQUM7QUFFakYsTUFBTSxVQUFVLGFBQWEsQ0FBQyxNQUFNO0lBQ2hDLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQztJQUNk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LENBQzVCLEtBQUssQ0FBQSxFQUFFLENBQUEsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDO1dBQzlCLEtBQUssQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUM3QixDQUFBO0lBQ0QsTUFBTSxVQUFVLEdBQUMsTUFBTSxDQUFDLGFBQWEsQ0FDakMsS0FBSyxDQUFBLEVBQUUsQ0FBQSxLQUFLLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7V0FDL0IsS0FBSyxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsRUFBRSxDQUFDLENBQzdCLENBQUE7SUFDRCxPQUFNLEVBQUMsSUFBSSxFQUFFLFNBQVMsRUFBQyxLQUFLLEVBQUUsVUFBVSxFQUFDLEVBQUUsRUFBQyxFQUFFLEVBQUMsQ0FBQTtBQUNuRCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNsYXNzIFBhcmVue1xuICAgIHR5cGU7XG4gICAgZGVwdGg7XG4gICAgZGVwdGhJRDtcbiAgICBcbiAgICBjb25zdHJ1Y3RvcihkZXB0aCxkZXB0aElELHR5cGUpe1xuICAgICAgICB0aGlzLmRlcHRoPWRlcHRoO1xuICAgICAgICB0aGlzLmRlcHRoSUQ9ZGVwdGhJRDtcbiAgICAgICAgdGhpcy50eXBlPXR5cGVcbiAgICB9XG4gICAgdG9TdHJpbmcoKXt0aGlzLmlkPXRoaXMuZGVwdGggKyBcIi5cIiArIHRoaXMuZGVwdGhJRH1cbiAgICBjb21wYXJlKFBhcmVuKXtyZXR1cm4gdGhpcy5kZXB0aD09PVBhcmVuLmRlcHRoJiZ0aGlzLmRlcHRoSUQ9PT1QYXJlbi5kZXB0aElEfVxuICAgIGFkZERlcHRoKG51bSl7dGhpcy5kZXB0aCs9bnVtfVxuICAgIGFkZGRlcHRoSUQobnVtKXt0aGlzLmRlcHRoSUQrPW51bX1cbn1cbmNvbnN0IG9wZW49WydQYXJlbnRoZXNlc19vcGVuJywnQ3VybHlfYnJhY2tldHNfb3BlbicsJ1NxdWFyZV9icmFja2V0c19vcGVuJ107XG5jb25zdCBjbG9zZT1bJ1BhcmVudGhlc2VzX2Nsb3NlJywnQ3VybHlfYnJhY2tldHNfY2xvc2UnLCdTcXVhcmVfYnJhY2tldHNfY2xvc2UnXTtcblxuZXhwb3J0IGZ1bmN0aW9uIGlkUGFyZW50aGVzZXModG9rZW5zKSB7XG4gICAgbGV0IGRlcHRoID0gMDtcbiAgICBjb25zdCBkZXB0aENvdW50cyA9IHt9O1xuICAgIFxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdG9rZW5zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHRva2VuID0gdG9rZW5zW2ldO1xuICAgICAgICBcbiAgICAgICAgaWYgKG9wZW4uaW5jbHVkZXModG9rZW4ubmFtZSkpIHtcbiAgICAgICAgICAgIGlmICghZGVwdGhDb3VudHNbZGVwdGhdKSB7XG4gICAgICAgICAgICAgICAgZGVwdGhDb3VudHNbZGVwdGhdID0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgZGVwdGhJRCA9IGRlcHRoQ291bnRzW2RlcHRoXSsrO1xuICAgICAgICAgICAgdG9rZW4udmFsdWUgPSBuZXcgUGFyZW4oZGVwdGgsIGRlcHRoSUQsdG9rZW4udmFsdWUpO1xuXG4gICAgICAgICAgICAvLyBJbmNyZWFzZSBkZXB0aCBmb3IgbmVzdGVkIHBhcmVudGhlc2VzXG4gICAgICAgICAgICBkZXB0aCsrO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY2xvc2UuaW5jbHVkZXModG9rZW4ubmFtZSkpIHtcbiAgICAgICAgICAgIC8vIERlY3JlYXNlIGRlcHRoIGFuZCBjaGVjayBmb3IgdW5tYXRjaGVkIGNsb3NpbmcgcGFyZW50aGVzaXNcbiAgICAgICAgICAgIGRlcHRoLS07XG4gICAgICAgICAgICBpZiAoZGVwdGggPCAwKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcih0b2tlbi52YWx1ZSx0b2tlbnMpXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5tYXRjaGVkIGNsb3NpbmcgcGFyZW50aGVzaXMgZGV0ZWN0ZWQuXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBBc3NpZ24gYSB1bmlxdWUgSUQgdG8gdGhlIGNsb3NpbmcgcGFyZW50aGVzaXNcbiAgICAgICAgICAgIGNvbnN0IGRlcHRoSUQgPSBkZXB0aENvdW50c1tkZXB0aF0gLSAxO1xuICAgICAgICAgICAgdG9rZW4udmFsdWUgPSBuZXcgUGFyZW4oZGVwdGgsIGRlcHRoSUQsdG9rZW4udmFsdWUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgZm9yIHVubWF0Y2hlZCBvcGVuaW5nIHBhcmVudGhlc2VzXG4gICAgaWYgKGRlcHRoICE9PSAwKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IodG9rZW5zKVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVubWF0Y2hlZCBvcGVuaW5nIHBhcmVudGhlc2lzKGVzKSBkZXRlY3RlZDogZGVwdGg9JHtkZXB0aH1gKTtcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtYXBCcmFja2V0cyh0eXBlLHRva2Vucyl7XG4gICAgcmV0dXJuIHRva2Vuc1xuICAgICAgICAubWFwKCh0b2tlbiwgaW5kZXgpID0+IFxuICAgICAgICAgICAgdG9rZW4ubmFtZSA9PT0gdHlwZVxuICAgICAgICAgICAgICAgID8gZmluZFBhcmVuSW5kZXgodG9rZW4udmFsdWUsIHVuZGVmaW5lZCwgdG9rZW5zKSBcbiAgICAgICAgICAgICAgICA6IG51bGxcbiAgICAgICAgKVxuICAgICAgICAuZmlsdGVyKCh0KSA9PiB0ICE9PSBudWxsKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZpbmRNb2RpZmllZFBhcmVuSW5kZXgoaWQsIGluZGV4LCB0b2tlbnMsIGRlcHRoLCBkZXB0aElELCBmaWx0ZXIpIHtcbiAgICAvLyBJbml0aWFsaXplIGBpZGAgYXMgYSBuZXcgaW5zdGFuY2UgaWYgbm90IGFscmVhZHkgcHJvdmlkZWRcbiAgICBpZCA9IGlkXG4gICAgICAgID8gbmV3IFBhcmVuKGlkLmRlcHRoLCBpZC5kZXB0aElEKVxuICAgICAgICA6IG5ldyBQYXJlbih0b2tlbnNbaW5kZXhdLnZhbHVlLmRlcHRoLCB0b2tlbnNbaW5kZXhdLnZhbHVlLmRlcHRoSUQpO1xuXG4gICAgaWYgKGRlcHRoICE9PSB1bmRlZmluZWQgJiYgZGVwdGhJRCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlkLmRlcHRoICs9IGRlcHRoIHx8IDA7XG4gICAgICAgIGlkLmRlcHRoSUQgKz0gZGVwdGhJRCB8fCAwO1xuICAgIH1cblxuICAgIGNvbnN0IG9wZW5JbmRleCA9IHRva2Vucy5maW5kSW5kZXgodG9rZW4gPT4ge1xuICAgICAgICBpZiAob3Blbi5pbmNsdWRlcyh0b2tlbi5uYW1lKSAmJiB0b2tlbi52YWx1ZT8uY29tcGFyZShpZCkpIHtcbiAgICAgICAgICAgIGlmIChmaWx0ZXIgJiYgIXRva2VuLm5hbWUuc3RhcnRzV2l0aChmaWx0ZXIpKSB7XG4gICAgICAgICAgICAgICAgaWQuZGVwdGggPSB0b2tlbi52YWx1ZS5kZXB0aCArIChkZXB0aCB8fCAwKVxuICAgICAgICAgICAgICAgIGlkLmRlcHRoSUQ9dG9rZW4udmFsdWUuZGVwdGhJRCArIChkZXB0aElEIHx8IDApXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuXG4gICAgY29uc3QgY2xvc2VJbmRleCA9IHRva2Vucy5maW5kTGFzdEluZGV4KFxuICAgICAgICB0b2tlbiA9PlxuICAgICAgICAgICAgY2xvc2UuaW5jbHVkZXModG9rZW4ubmFtZSkgJiZcbiAgICAgICAgICAgIHRva2VuLnZhbHVlPy5jb21wYXJlKGlkKVxuICAgICk7XG5cbiAgICByZXR1cm4geyBvcGVuOiBvcGVuSW5kZXgsIGNsb3NlOiBjbG9zZUluZGV4LCBpZCB9O1xufVxuXG5cblxuZXhwb3J0IGZ1bmN0aW9uIGZpbmRQYXJlbkluZGV4KGlkLGluZGV4LHRva2Vucyl7XG4gICAgaWQ9aWQ/aWQ6dG9rZW5zW2luZGV4XS52YWx1ZTtcblxuICAgIGNvbnN0IG9wZW5JbmRleD10b2tlbnMuZmluZEluZGV4KFxuICAgICAgICB0b2tlbj0+b3Blbi5pbmNsdWRlcyh0b2tlbi5uYW1lKVxuICAgICAgICAmJnRva2VuLnZhbHVlPy5jb21wYXJlKGlkKVxuICAgIClcbiAgICBjb25zdCBjbG9zZUluZGV4PXRva2Vucy5maW5kTGFzdEluZGV4KFxuICAgICAgICB0b2tlbj0+Y2xvc2UuaW5jbHVkZXModG9rZW4ubmFtZSlcbiAgICAgICAgJiZ0b2tlbi52YWx1ZT8uY29tcGFyZShpZClcbiAgICApXG4gICAgcmV0dXJue29wZW46IG9wZW5JbmRleCxjbG9zZTogY2xvc2VJbmRleCxpZDppZH1cbn0iXX0=