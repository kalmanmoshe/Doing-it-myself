import { replaceRange, setCursor, getCharacterAtPos } from "src/utils/editor_utils";
export const tabout = (view, ctx) => {
    if (!ctx.mode.inMath())
        return false;
    const result = ctx.getBounds();
    if (!result)
        return false;
    const end = result.end;
    const pos = view.state.selection.main.to;
    const d = view.state.doc;
    const text = d.toString();
    // Move to the next closing bracket: }, ), ], >, |, or \\rangle
    const rangle = "\\rangle";
    for (let i = pos; i < end; i++) {
        if (["}", ")", "]", ">", "|", "$"].contains(text.charAt(i))) {
            setCursor(view, i + 1);
            return true;
        }
        else if (text.slice(i, i + rangle.length) === rangle) {
            setCursor(view, i + rangle.length);
            return true;
        }
    }
    // If cursor at end of line/equation, move to next line/outside $$ symbols
    // Check whether we're at end of equation
    // Accounting for whitespace, using trim
    const textBtwnCursorAndEnd = d.sliceString(pos, end);
    const atEnd = textBtwnCursorAndEnd.trim().length === 0;
    if (!atEnd)
        return false;
    // Check whether we're in inline math or a block eqn
    if (ctx.mode.inlineMath || ctx.mode.codeMath) {
        setCursor(view, end + 1);
    }
    else {
        // First, locate the $$ symbol
        const dollarLine = d.lineAt(end + 2);
        // If there's no line after the equation, create one
        if (dollarLine.number === d.lines) {
            replaceRange(view, dollarLine.to, dollarLine.to, "\n");
        }
        // Finally, move outside the $$ symbol
        setCursor(view, dollarLine.to + 1);
        // Trim whitespace at beginning / end of equation
        const line = d.lineAt(pos);
        replaceRange(view, line.from, line.to, line.text.trim());
    }
    return true;
};
export const shouldTaboutByCloseBracket = (view, keyPressed) => {
    const sel = view.state.selection.main;
    if (!sel.empty)
        return;
    const pos = sel.from;
    const c = getCharacterAtPos(view, pos);
    const brackets = [")", "]", "}"];
    if ((c === keyPressed) && brackets.contains(c)) {
        return true;
    }
    else {
        return false;
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFib3V0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2ZlYXR1cmVzL3RhYm91dC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBSXBGLE1BQU0sQ0FBQyxNQUFNLE1BQU0sR0FBRyxDQUFDLElBQWdCLEVBQUUsR0FBWSxFQUFVLEVBQUU7SUFDN0QsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFO1FBQUUsT0FBTyxLQUFLLENBQUM7SUFFeEMsTUFBTSxNQUFNLEdBQUcsR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQy9CLElBQUksQ0FBQyxNQUFNO1FBQUUsT0FBTyxLQUFLLENBQUM7SUFDMUIsTUFBTSxHQUFHLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQztJQUV2QixNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO0lBQ3pDLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDO0lBQ3pCLE1BQU0sSUFBSSxHQUFHLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUUxQiwrREFBK0Q7SUFDL0QsTUFBTSxNQUFNLEdBQUcsVUFBVSxDQUFDO0lBRTFCLEtBQUssSUFBSSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUNoQyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDN0QsU0FBUyxDQUFDLElBQUksRUFBRSxDQUFDLEdBQUMsQ0FBQyxDQUFDLENBQUM7WUFFckIsT0FBTyxJQUFJLENBQUM7UUFDYixDQUFDO2FBQ0ksSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLE1BQU0sRUFBRSxDQUFDO1lBQ3RELFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUVuQyxPQUFPLElBQUksQ0FBQztRQUNiLENBQUM7SUFDRixDQUFDO0lBR0QsMEVBQTBFO0lBRTFFLHlDQUF5QztJQUN6Qyx3Q0FBd0M7SUFDeEMsTUFBTSxvQkFBb0IsR0FBRyxDQUFDLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNyRCxNQUFNLEtBQUssR0FBRyxvQkFBb0IsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDO0lBRXZELElBQUksQ0FBQyxLQUFLO1FBQUUsT0FBTyxLQUFLLENBQUM7SUFHekIsb0RBQW9EO0lBQ3BELElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxVQUFVLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUM5QyxTQUFTLENBQUMsSUFBSSxFQUFFLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUMxQixDQUFDO1NBQ0ksQ0FBQztRQUNMLDhCQUE4QjtRQUM5QixNQUFNLFVBQVUsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsR0FBQyxDQUFDLENBQUMsQ0FBQztRQUVuQyxvREFBb0Q7UUFFcEQsSUFBSSxVQUFVLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNuQyxZQUFZLENBQUMsSUFBSSxFQUFFLFVBQVUsQ0FBQyxFQUFFLEVBQUUsVUFBVSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUN4RCxDQUFDO1FBRUQsc0NBQXNDO1FBQ3RDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsVUFBVSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUduQyxpREFBaUQ7UUFDakQsTUFBTSxJQUFJLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMzQixZQUFZLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7SUFFMUQsQ0FBQztJQUVELE9BQU8sSUFBSSxDQUFDO0FBQ2IsQ0FBQyxDQUFBO0FBR0QsTUFBTSxDQUFDLE1BQU0sMEJBQTBCLEdBQUcsQ0FBQyxJQUFnQixFQUFFLFVBQWtCLEVBQUUsRUFBRTtJQUNsRixNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUM7SUFDdEMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLO1FBQUUsT0FBTztJQUN2QixNQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDO0lBRXJCLE1BQU0sQ0FBQyxHQUFHLGlCQUFpQixDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN2QyxNQUFNLFFBQVEsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFFakMsSUFBSSxDQUFDLENBQUMsS0FBSyxVQUFVLENBQUMsSUFBSSxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDaEQsT0FBTyxJQUFJLENBQUM7SUFDYixDQUFDO1NBQ0ksQ0FBQztRQUNMLE9BQU8sS0FBSyxDQUFDO0lBQ2QsQ0FBQztBQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVkaXRvclZpZXcgfSBmcm9tIFwiQGNvZGVtaXJyb3Ivdmlld1wiO1xyXG5pbXBvcnQgeyByZXBsYWNlUmFuZ2UsIHNldEN1cnNvciwgZ2V0Q2hhcmFjdGVyQXRQb3MgfSBmcm9tIFwic3JjL3V0aWxzL2VkaXRvcl91dGlsc1wiO1xyXG5pbXBvcnQgeyBDb250ZXh0IH0gZnJvbSBcInNyYy91dGlscy9jb250ZXh0XCI7XHJcblxyXG5cclxuZXhwb3J0IGNvbnN0IHRhYm91dCA9ICh2aWV3OiBFZGl0b3JWaWV3LCBjdHg6IENvbnRleHQpOmJvb2xlYW4gPT4ge1xyXG4gICAgaWYgKCFjdHgubW9kZS5pbk1hdGgoKSkgcmV0dXJuIGZhbHNlO1xyXG5cclxuXHRjb25zdCByZXN1bHQgPSBjdHguZ2V0Qm91bmRzKCk7XHJcblx0aWYgKCFyZXN1bHQpIHJldHVybiBmYWxzZTtcclxuXHRjb25zdCBlbmQgPSByZXN1bHQuZW5kO1xyXG5cclxuXHRjb25zdCBwb3MgPSB2aWV3LnN0YXRlLnNlbGVjdGlvbi5tYWluLnRvO1xyXG5cdGNvbnN0IGQgPSB2aWV3LnN0YXRlLmRvYztcclxuXHRjb25zdCB0ZXh0ID0gZC50b1N0cmluZygpO1xyXG5cclxuXHQvLyBNb3ZlIHRvIHRoZSBuZXh0IGNsb3NpbmcgYnJhY2tldDogfSwgKSwgXSwgPiwgfCwgb3IgXFxcXHJhbmdsZVxyXG5cdGNvbnN0IHJhbmdsZSA9IFwiXFxcXHJhbmdsZVwiO1xyXG5cclxuXHRmb3IgKGxldCBpID0gcG9zOyBpIDwgZW5kOyBpKyspIHtcclxuXHRcdGlmIChbXCJ9XCIsIFwiKVwiLCBcIl1cIiwgXCI+XCIsIFwifFwiLCBcIiRcIl0uY29udGFpbnModGV4dC5jaGFyQXQoaSkpKSB7XHJcblx0XHRcdHNldEN1cnNvcih2aWV3LCBpKzEpO1xyXG5cclxuXHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmICh0ZXh0LnNsaWNlKGksIGkgKyByYW5nbGUubGVuZ3RoKSA9PT0gcmFuZ2xlKSB7XHJcblx0XHRcdHNldEN1cnNvcih2aWV3LCBpICsgcmFuZ2xlLmxlbmd0aCk7XHJcblxyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cclxuXHQvLyBJZiBjdXJzb3IgYXQgZW5kIG9mIGxpbmUvZXF1YXRpb24sIG1vdmUgdG8gbmV4dCBsaW5lL291dHNpZGUgJCQgc3ltYm9sc1xyXG5cclxuXHQvLyBDaGVjayB3aGV0aGVyIHdlJ3JlIGF0IGVuZCBvZiBlcXVhdGlvblxyXG5cdC8vIEFjY291bnRpbmcgZm9yIHdoaXRlc3BhY2UsIHVzaW5nIHRyaW1cclxuXHRjb25zdCB0ZXh0QnR3bkN1cnNvckFuZEVuZCA9IGQuc2xpY2VTdHJpbmcocG9zLCBlbmQpO1xyXG5cdGNvbnN0IGF0RW5kID0gdGV4dEJ0d25DdXJzb3JBbmRFbmQudHJpbSgpLmxlbmd0aCA9PT0gMDtcclxuXHJcblx0aWYgKCFhdEVuZCkgcmV0dXJuIGZhbHNlO1xyXG5cclxuXHJcblx0Ly8gQ2hlY2sgd2hldGhlciB3ZSdyZSBpbiBpbmxpbmUgbWF0aCBvciBhIGJsb2NrIGVxblxyXG5cdGlmIChjdHgubW9kZS5pbmxpbmVNYXRoIHx8IGN0eC5tb2RlLmNvZGVNYXRoKSB7XHJcblx0XHRzZXRDdXJzb3IodmlldywgZW5kICsgMSk7XHJcblx0fVxyXG5cdGVsc2Uge1xyXG5cdFx0Ly8gRmlyc3QsIGxvY2F0ZSB0aGUgJCQgc3ltYm9sXHJcblx0XHRjb25zdCBkb2xsYXJMaW5lID0gZC5saW5lQXQoZW5kKzIpO1xyXG5cclxuXHRcdC8vIElmIHRoZXJlJ3Mgbm8gbGluZSBhZnRlciB0aGUgZXF1YXRpb24sIGNyZWF0ZSBvbmVcclxuXHJcblx0XHRpZiAoZG9sbGFyTGluZS5udW1iZXIgPT09IGQubGluZXMpIHtcclxuXHRcdFx0cmVwbGFjZVJhbmdlKHZpZXcsIGRvbGxhckxpbmUudG8sIGRvbGxhckxpbmUudG8sIFwiXFxuXCIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIEZpbmFsbHksIG1vdmUgb3V0c2lkZSB0aGUgJCQgc3ltYm9sXHJcblx0XHRzZXRDdXJzb3IodmlldywgZG9sbGFyTGluZS50byArIDEpO1xyXG5cclxuXHJcblx0XHQvLyBUcmltIHdoaXRlc3BhY2UgYXQgYmVnaW5uaW5nIC8gZW5kIG9mIGVxdWF0aW9uXHJcblx0XHRjb25zdCBsaW5lID0gZC5saW5lQXQocG9zKTtcclxuXHRcdHJlcGxhY2VSYW5nZSh2aWV3LCBsaW5lLmZyb20sIGxpbmUudG8sIGxpbmUudGV4dC50cmltKCkpO1xyXG5cclxuXHR9XHJcblxyXG5cdHJldHVybiB0cnVlO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGNvbnN0IHNob3VsZFRhYm91dEJ5Q2xvc2VCcmFja2V0ID0gKHZpZXc6IEVkaXRvclZpZXcsIGtleVByZXNzZWQ6IHN0cmluZykgPT4ge1xyXG5cdGNvbnN0IHNlbCA9IHZpZXcuc3RhdGUuc2VsZWN0aW9uLm1haW47XHJcblx0aWYgKCFzZWwuZW1wdHkpIHJldHVybjtcclxuXHRjb25zdCBwb3MgPSBzZWwuZnJvbTtcclxuXHJcblx0Y29uc3QgYyA9IGdldENoYXJhY3RlckF0UG9zKHZpZXcsIHBvcyk7XHJcblx0Y29uc3QgYnJhY2tldHMgPSBbXCIpXCIsIFwiXVwiLCBcIn1cIl07XHJcblxyXG5cdGlmICgoYyA9PT0ga2V5UHJlc3NlZCkgJiYgYnJhY2tldHMuY29udGFpbnMoYykpIHtcclxuXHRcdHJldHVybiB0cnVlO1xyXG5cdH1cclxuXHRlbHNlIHtcclxuXHRcdHJldHVybiBmYWxzZTtcclxuXHR9XHJcbn0iXX0=