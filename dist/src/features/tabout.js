import { replaceRange, setCursor, getCharacterAtPos } from "src/utils/editor_utils";
export const tabout = (view, ctx, dir) => {
    console.log("tabout", ctx, dir);
    if (ctx.mode.inMath())
        return taboutMathjax(view, ctx, dir);
    if (ctx.mode.html)
        return taboutHtml(view, ctx, dir);
    return false;
};
const taboutHtml = (view, ctx, dir) => {
    const Params = ctxTaboutParams(view, ctx);
    if (!Params)
        return false;
    const { start, end, pos, doc, text } = Params;
    return false;
};
const taboutMathjax = (view, ctx, dir) => {
    const Params = ctxTaboutParams(view, ctx);
    if (!Params)
        return false;
    const { start, end, pos, doc, text } = Params;
    // Move to the next closing bracket: }, ), ], >, |, or \\rangle
    const chars = [
        ["{", "(", "[", "<"],
        [],
        ["}", ")", "]", ">"]
    ];
    const searchEnd = dir === 1 ? end + 1 : start - 1;
    const modifier = dir === 1 ? 0 : -1;
    for (let i = pos + modifier; i !== searchEnd; i += dir) {
        const targetChars = chars[dir + 1].concat(["\\rangle", "|", "$"]);
        const match = targetChars.find(s => text.startsWith(s, i));
        if (match !== undefined) {
            setCursor(view, i + match.length + modifier);
            return true;
        }
    }
    const textBtwnCursorAndEnd = doc.sliceString(pos, end);
    const atEnd = textBtwnCursorAndEnd.trim().length === 0;
    if (!atEnd)
        return false;
    // Check whether we're in inline math or a block eqn
    if (ctx.mode.inlineMath || ctx.mode.codeMath) {
        setCursor(view, end + 1);
    }
    else {
        // First, locate the $$ symbol
        const dollarLine = doc.lineAt(end + 2);
        // If there's no line after the equation, create one
        if (dollarLine.number === doc.lines) {
            replaceRange(view, dollarLine.to, dollarLine.to, "\n");
        }
        // Finally, move outside the $$ symbol
        setCursor(view, dollarLine.to + 1);
        // Trim whitespace at beginning / end of equation
        const line = doc.lineAt(pos);
        replaceRange(view, line.from, line.to, line.text.trim());
    }
    return true;
};
const ctxTaboutParams = (view, ctx) => {
    const result = ctx.getBounds();
    if (!result)
        return false;
    const { start, end } = result;
    const pos = view.state.selection.main.to;
    const doc = view.state.doc;
    const text = doc.toString();
    return { start, end, pos, doc, text };
};
export const shouldTaboutByCloseBracket = (view, keyPressed) => {
    const sel = view.state.selection.main;
    if (!sel.empty)
        return;
    const pos = sel.from;
    const c = getCharacterAtPos(view, pos);
    const brackets = [")", "]", "}"];
    if ((c === keyPressed) && brackets.contains(c)) {
        return true;
    }
    else {
        return false;
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFib3V0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2ZlYXR1cmVzL3RhYm91dC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsRUFBYSxNQUFNLHdCQUF3QixDQUFDO0FBSy9GLE1BQU0sQ0FBQyxNQUFNLE1BQU0sR0FBRyxDQUFDLElBQWdCLEVBQUUsR0FBWSxFQUFDLEdBQWMsRUFBVSxFQUFFO0lBQy9FLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFDLEdBQUcsRUFBQyxHQUFHLENBQUMsQ0FBQztJQUM5QixJQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFO1FBQUUsT0FBTyxhQUFhLENBQUMsSUFBSSxFQUFDLEdBQUcsRUFBQyxHQUFHLENBQUMsQ0FBQztJQUN6RCxJQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSTtRQUFFLE9BQU8sVUFBVSxDQUFDLElBQUksRUFBQyxHQUFHLEVBQUMsR0FBRyxDQUFDLENBQUM7SUFDbEQsT0FBTyxLQUFLLENBQUM7QUFDZCxDQUFDLENBQUE7QUFDRCxNQUFNLFVBQVUsR0FBQyxDQUFDLElBQWdCLEVBQUUsR0FBWSxFQUFDLEdBQWMsRUFBUyxFQUFFO0lBQ3pFLE1BQU0sTUFBTSxHQUFDLGVBQWUsQ0FBQyxJQUFJLEVBQUMsR0FBRyxDQUFDLENBQUM7SUFDdkMsSUFBRyxDQUFDLE1BQU07UUFBRSxPQUFPLEtBQUssQ0FBQztJQUN6QixNQUFNLEVBQUMsS0FBSyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLElBQUksRUFBQyxHQUFDLE1BQU0sQ0FBQztJQUV0QyxPQUFPLEtBQUssQ0FBQztBQUNkLENBQUMsQ0FBQTtBQXFDRCxNQUFNLGFBQWEsR0FBQyxDQUFDLElBQWdCLEVBQUMsR0FBWSxFQUFDLEdBQWMsRUFBUyxFQUFFO0lBRTNFLE1BQU0sTUFBTSxHQUFDLGVBQWUs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YixDQUFDO1NBQ0ksQ0FBQztRQUNMLE9BQU8sS0FBSyxDQUFDO0lBQ2QsQ0FBQztBQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVkaXRvclZpZXcgfSBmcm9tIFwiQGNvZGVtaXJyb3Ivdmlld1wiO1xuaW1wb3J0IHsgcmVwbGFjZVJhbmdlLCBzZXRDdXJzb3IsIGdldENoYXJhY3RlckF0UG9zLCBEaXJlY3Rpb24gfSBmcm9tIFwic3JjL3V0aWxzL2VkaXRvcl91dGlsc1wiO1xuaW1wb3J0IHsgQ29udGV4dCB9IGZyb20gXCJzcmMvdXRpbHMvY29udGV4dFwiO1xuaW1wb3J0IHsgc3RhcnQgfSBmcm9tIFwicmVwbFwiO1xuXG5cbmV4cG9ydCBjb25zdCB0YWJvdXQgPSAodmlldzogRWRpdG9yVmlldywgY3R4OiBDb250ZXh0LGRpcjogRGlyZWN0aW9uKTpib29sZWFuID0+IHtcblx0Y29uc29sZS5sb2coXCJ0YWJvdXRcIixjdHgsZGlyKTtcblx0aWYoY3R4Lm1vZGUuaW5NYXRoKCkpIHJldHVybiB0YWJvdXRNYXRoamF4KHZpZXcsY3R4LGRpcik7XG5cdGlmKGN0eC5tb2RlLmh0bWwpIHJldHVybiB0YWJvdXRIdG1sKHZpZXcsY3R4LGRpcik7XG5cdHJldHVybiBmYWxzZTtcbn1cbmNvbnN0IHRhYm91dEh0bWw9KHZpZXc6IEVkaXRvclZpZXcsIGN0eDogQ29udGV4dCxkaXI6IERpcmVjdGlvbik6Ym9vbGVhbj0+e1xuXHRjb25zdCBQYXJhbXM9Y3R4VGFib3V0UGFyYW1zKHZpZXcsY3R4KTtcblx0aWYoIVBhcmFtcykgcmV0dXJuIGZhbHNlO1xuXHRjb25zdCB7c3RhcnQsZW5kLHBvcyxkb2MsdGV4dH09UGFyYW1zO1xuXG5cdHJldHVybiBmYWxzZTtcbn1cbmludGVyZmFjZSB0YWdDb25zdHJ1Y3Rpb257XG5cdG9wZW46IHN0cmluZyxcblx0Y2xvc2U6IHN0cmluZ1xufS8qXG5jb25zdCBodG1sVGFnczpBcnJheTx7c3RhcnQ6IHRhZ0NvbnN0cnVjdGlvbixlbmQ/OiBzdHJpbmd9PiA9IFtcblx0e3N0YXJ0OiB7b3BlbjogJzxkaXYnLGNsb3NlOiAnPid9LCBlbmQ6ICc8L2Rpdj4nfSxcblx0e3N0YXJ0OiB7b3BlbjogJzxwJyxjbG9zZTogJz4nfSwgZW5kOiAnPC9wPid9LFxuXHR7c3RhcnQ6IHtvcGVuOiAnPHNwYW4nLGNsb3NlOiAnPid9LCBlbmQ6ICAnPC9zcGFuPid9LFxuXHR7c3RhcnQ6IHtvcGVuOiAnPGEnLGNsb3NlOiAnPid9LCBlbmQ6ICc8L2E+J30sXG5cdHtzdGFydDoge29wZW46ICc8aDEnLGNsb3NlOiAnPid9LCBlbmQ6ICc8L2gxPid9LFxuXHR7c3RhcnQ6IHtvcGVuOiAnPGgyJyxjbG9zZTogJz4nfSwgZW5kOiAnPC9oMj4nfSxcblx0e3N0YXJ0OiB7b3BlbjogJzxoMycsY2xvc2U6ICc+J30sIGVuZDogfSxcblx0e3N0YXJ0OiB7b3BlbjogJzxoNCcsY2xvc2U6ICc+J30sIGVuZDogfSxcblx0e3N0YXJ0OiB7b3BlbjogJzxoNScsY2xvc2U6ICc+J30sIGVuZDogfSxcblx0e3N0YXJ0OiB7b3BlbjogJzxoNicsY2xvc2U6ICc+J30sIGVuZDogfSxcblx0e3N0YXJ0OiB7b3BlbjogJzxoZWFkZXInLGNsb3NlOiAnPid9LCBlbmQ6IH0sXG5cdHtzdGFydDoge29wZW46ICc8Zm9vdGVyJyxjbG9zZTogJz4nfSwgZW5kOiB9LFxuXHR7c3RhcnQ6IHtvcGVuOiAnPG1haW4nLGNsb3NlOiAnPid9LCBlbmQ6IH0sXG5cdHtzdGFydDoge29wZW46ICc8c2VjdGlvbicsY2xvc2U6ICc+J30sIGVuZDogfSxcblx0e3N0YXJ0OiB7b3BlbjogJzxhcnRpY2xlJyxjbG9zZTogJz4nfSwgZW5kOlx0fSxcblx0e3N0YXJ0OiB7b3BlbjogJzxhc2lkZScsY2xvc2U6ICc+J30sIGVuZDp9LFxuXHR7c3RhcnQ6IHtvcGVuOiAnPG5hdicsY2xvc2U6ICc+J30sIGVuZDogfSxcblx0e3N0YXJ0OiB7b3BlbjogJzxmaWd1cmUnLGNsb3NlOiAnPid9LCBlbmQ6IH0sXG5cdHtzdGFydDoge29wZW46ICc8ZmlnY2FwdGlvbicsY2xvc2U6ICc+J30sIGVuZDogfSxcblx0e3N0YXJ0OiB7b3BlbjogJzxibG9ja3F1b3RlJyxjbG9zZTogJz4nfSwgZW5kOiB9LFxuXHR7c3RhcnQ6IHtvcGVuOiAnPGNpdGUnLGNsb3NlOiAnPid9LCBlbmQ6IH0sXG5cdHtzdGFydDoge29wZW46ICc8Y29kZScsY2xvc2U6ICc+J30sIGVuZDogfSxcblx0e3N0YXJ0OiB7b3BlbjogJzxlbScsY2xvc2U6ICc+J30sIGVuZDogfSxcblx0e3N0YXJ0OiB7b3BlbjogJzxzdHJvbmcnLGNsb3NlOiAnPid9LCBlbmQ6IH0sXG5cdHtzdGFydDoge29wZW46ICc8c21hbGwnLGNsb3NlOiAnPid9LCBlbmQ6IH0sXG5cdHtzdGFydDoge29wZW46ICc8c3ViJyxjbG9zZTogJz4nfSwgZW5kOiB9LFxuXHR7c3RhcnQ6IHtvcGVuOiAnPHN1cCcsY2xvc2U6ICc+J30sIGVuZDoge29wZW46ICc8L3N1cCcsY2xvc2U6ICc+J319LFxuXHR7c3RhcnQ6IHtvcGVuOiAnPGlucycsY2xvc2U6ICc+J30sIGVuZDoge29wZW46ICc8L2lucycsY2xvc2U6ICc+J319LFxuXHR7c3RhcnQ6IHtvcGVuOiAnPGRlbCcsY2xvc2U6ICc+J30sIGVuZDoge29wZW46ICc8L2RlbCcsY2xvc2U6ICc+J319LFxuXHR7c3RhcnQ6IHtvcGVuOiAnPG1hcmsnLGNsb3NlOiAnPid9LCBlbmQ6IHtvcGVuOiAnPC9tYXJrJyxjbG9zZTogJz4nfX0sXG5dKi9cbmNvbnN0IHRhYm91dE1hdGhqYXg9KHZpZXc6IEVkaXRvclZpZXcsY3R4OiBDb250ZXh0LGRpcjogRGlyZWN0aW9uKTpib29sZWFuPT57XG5cblx0Y29uc3QgUGFyYW1zPWN0eFRhYm91dFBhcmFtcyh2aWV3LGN0eCk7XG5cdGlmKCFQYXJhbXMpIHJldHVybiBmYWxzZTtcblx0Y29uc3Qge3N0YXJ0LGVuZCxwb3MsZG9jLHRleHR9PVBhcmFtcztcblxuXHQvLyBNb3ZlIHRvIHRoZSBuZXh0IGNsb3NpbmcgYnJhY2tldDogfSwgKSwgXSwgPiwgfCwgb3IgXFxcXHJhbmdsZVxuXHRjb25zdCBjaGFycyA9IFtcblx0XHRbXCJ7XCIsIFwiKFwiLCBcIltcIiwgXCI8XCJdLFxuXHRcdFtdLFxuXHRcdFtcIn1cIiwgXCIpXCIsIFwiXVwiLCBcIj5cIl1cblx0XTtcblx0XG5cdGNvbnN0IHNlYXJjaEVuZCA9IGRpciA9PT0gMSA/IGVuZCsxIDogc3RhcnQtMTtcblx0Y29uc3QgbW9kaWZpZXIgPSBkaXIgPT09IDEgPyAwIDogLTE7XG5cdGZvciAobGV0IGkgPSBwb3MrbW9kaWZpZXI7IGkgIT09IHNlYXJjaEVuZDsgaSArPSBkaXIpIHtcblx0XHRjb25zdCB0YXJnZXRDaGFycyA9IGNoYXJzW2RpciArIDFdLmNvbmNhdChbXCJcXFxccmFuZ2xlXCIsIFwifFwiLCBcIiRcIl0pO1xuXHRcdGNvbnN0IG1hdGNoID0gdGFyZ2V0Q2hhcnMuZmluZChzID0+IHRleHQuc3RhcnRzV2l0aChzLCBpKSk7XG5cdFx0aWYgKG1hdGNoICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdHNldEN1cnNvcih2aWV3LCBpICsgbWF0Y2gubGVuZ3RoK21vZGlmaWVyKTtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblx0fVxuXG5cblx0Y29uc3QgdGV4dEJ0d25DdXJzb3JBbmRFbmQgPSBkb2Muc2xpY2VTdHJpbmcocG9zLCBlbmQpO1xuXHRjb25zdCBhdEVuZCA9IHRleHRCdHduQ3Vyc29yQW5kRW5kLnRyaW0oKS5sZW5ndGggPT09IDA7XG5cblx0aWYgKCFhdEVuZCkgcmV0dXJuIGZhbHNlO1xuXG5cblx0Ly8gQ2hlY2sgd2hldGhlciB3ZSdyZSBpbiBpbmxpbmUgbWF0aCBvciBhIGJsb2NrIGVxblxuXHRpZiAoY3R4Lm1vZGUuaW5saW5lTWF0aCB8fCBjdHgubW9kZS5jb2RlTWF0aCkge1xuXHRcdHNldEN1cnNvcih2aWV3LCBlbmQgKyAxKTtcblx0fVxuXHRlbHNlIHtcblx0XHQvLyBGaXJzdCwgbG9jYXRlIHRoZSAkJCBzeW1ib2xcblx0XHRjb25zdCBkb2xsYXJMaW5lID0gZG9jLmxpbmVBdChlbmQrMik7XG5cblx0XHQvLyBJZiB0aGVyZSdzIG5vIGxpbmUgYWZ0ZXIgdGhlIGVxdWF0aW9uLCBjcmVhdGUgb25lXG5cblx0XHRpZiAoZG9sbGFyTGluZS5udW1iZXIgPT09IGRvYy5saW5lcykge1xuXHRcdFx0cmVwbGFjZVJhbmdlKHZpZXcsIGRvbGxhckxpbmUudG8sIGRvbGxhckxpbmUudG8sIFwiXFxuXCIpO1xuXHRcdH1cblxuXHRcdC8vIEZpbmFsbHksIG1vdmUgb3V0c2lkZSB0aGUgJCQgc3ltYm9sXG5cdFx0c2V0Q3Vyc29yKHZpZXcsIGRvbGxhckxpbmUudG8gKyAxKTtcblxuXG5cdFx0Ly8gVHJpbSB3aGl0ZXNwYWNlIGF0IGJlZ2lubmluZyAvIGVuZCBvZiBlcXVhdGlvblxuXHRcdGNvbnN0IGxpbmUgPSBkb2MubGluZUF0KHBvcyk7XG5cdFx0cmVwbGFjZVJhbmdlKHZpZXcsIGxpbmUuZnJvbSwgbGluZS50bywgbGluZS50ZXh0LnRyaW0oKSk7XG5cblx0fVxuXG5cdHJldHVybiB0cnVlO1xufVxuY29uc3QgY3R4VGFib3V0UGFyYW1zPSh2aWV3OiBFZGl0b3JWaWV3LCBjdHg6IENvbnRleHQpPT57XG5cdGNvbnN0IHJlc3VsdCA9IGN0eC5nZXRCb3VuZHMoKTtcblx0aWYgKCFyZXN1bHQpIHJldHVybiBmYWxzZTtcblx0Y29uc3QgeyBzdGFydCwgZW5kIH0gPSByZXN1bHQ7XG5cdFxuXHRjb25zdCBwb3MgPSB2aWV3LnN0YXRlLnNlbGVjdGlvbi5tYWluLnRvO1xuXHRjb25zdCBkb2MgPSB2aWV3LnN0YXRlLmRvYztcblx0Y29uc3QgdGV4dCA9IGRvYy50b1N0cmluZygpO1xuXG5cdHJldHVybiB7c3RhcnQsZW5kLHBvcyxkb2MsdGV4dH07XG59XG5cblxuZXhwb3J0IGNvbnN0IHNob3VsZFRhYm91dEJ5Q2xvc2VCcmFja2V0ID0gKHZpZXc6IEVkaXRvclZpZXcsIGtleVByZXNzZWQ6IHN0cmluZykgPT4ge1xuXHRjb25zdCBzZWwgPSB2aWV3LnN0YXRlLnNlbGVjdGlvbi5tYWluO1xuXHRpZiAoIXNlbC5lbXB0eSkgcmV0dXJuO1xuXHRjb25zdCBwb3MgPSBzZWwuZnJvbTtcblxuXHRjb25zdCBjID0gZ2V0Q2hhcmFjdGVyQXRQb3ModmlldywgcG9zKTtcblx0Y29uc3QgYnJhY2tldHMgPSBbXCIpXCIsIFwiXVwiLCBcIn1cIl07XG5cblx0aWYgKChjID09PSBrZXlQcmVzc2VkKSAmJiBicmFja2V0cy5jb250YWlucyhjKSkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cdGVsc2Uge1xuXHRcdHJldHVybiBmYWxzZTtcblx0fVxufSJdfQ==