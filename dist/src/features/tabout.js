import { replaceRange, setCursor, getCharacterAtPos } from "src/utils/editor_utils";
export const tabout = (view, ctx, dir) => {
    console.log("tabout", ctx, dir);
    if (ctx.mode.inMath())
        return taboutMathjax(view, ctx, dir);
    if (ctx.mode.html)
        return taboutHtml(view, ctx, dir);
    return false;
};
const taboutHtml = (view, ctx, dir) => {
    const Params = ctxTaboutParams(view, ctx);
    if (!Params)
        return false;
    const { start, end, pos, doc, text } = Params;
    return false;
};
const taboutMathjax = (view, ctx, dir) => {
    const Params = ctxTaboutParams(view, ctx);
    if (!Params)
        return false;
    const { start, end, pos, doc, text } = Params;
    // Move to the next closing bracket: }, ), ], >, |, or \\rangle
    const chars = [
        ["{", "(", "[", "<"],
        [],
        ["}", ")", "]", ">"]
    ];
    const searchEnd = dir === 1 ? end + 1 : start - 1;
    const modifier = dir === 1 ? 0 : -1;
    for (let i = pos + modifier; i !== searchEnd; i += dir) {
        const targetChars = chars[dir + 1].concat(["\\rangle", "|", "$"]);
        const match = targetChars.find(s => text.startsWith(s, i));
        if (match !== undefined) {
            setCursor(view, i + match.length + modifier);
            return true;
        }
    }
    const textBtwnCursorAndEnd = doc.sliceString(pos, end);
    const atEnd = textBtwnCursorAndEnd.trim().length === 0;
    if (!atEnd)
        return false;
    // Check whether we're in inline math or a block eqn
    if (ctx.mode.inlineMath || ctx.mode.codeMath) {
        setCursor(view, end + 1);
    }
    else {
        // First, locate the $$ symbol
        const dollarLine = doc.lineAt(end + 2);
        // If there's no line after the equation, create one
        if (dollarLine.number === doc.lines) {
            replaceRange(view, dollarLine.to, dollarLine.to, "\n");
        }
        // Finally, move outside the $$ symbol
        setCursor(view, dollarLine.to + 1);
        // Trim whitespace at beginning / end of equation
        const line = doc.lineAt(pos);
        replaceRange(view, line.from, line.to, line.text.trim());
    }
    return true;
};
const ctxTaboutParams = (view, ctx) => {
    const result = ctx.getBounds();
    if (!result)
        return false;
    const { start, end } = result;
    const pos = view.state.selection.main.to;
    const doc = view.state.doc;
    const text = doc.toString();
    return { start, end, pos, doc, text };
};
export const shouldTaboutByCloseBracket = (view, keyPressed) => {
    const sel = view.state.selection.main;
    if (!sel.empty)
        return;
    const pos = sel.from;
    const c = getCharacterAtPos(view, pos);
    const brackets = [")", "]", "}"];
    if ((c === keyPressed) && brackets.contains(c)) {
        return true;
    }
    else {
        return false;
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFib3V0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2ZlYXR1cmVzL3RhYm91dC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsRUFBYSxNQUFNLHdCQUF3QixDQUFDO0FBSy9GLE1BQU0sQ0FBQyxNQUFNLE1BQU0sR0FBRyxDQUFDLElBQWdCLEVBQUUsR0FBWSxFQUFDLEdBQWMsRUFBVSxFQUFFO0lBQy9FLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFDLEdBQUcsRUFBQyxHQUFHLENBQUMsQ0FBQztJQUM5QixJQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFO1FBQUUsT0FBTyxhQUFhLENBQUMsSUFBSSxFQUFDLEdBQUcsRUFBQyxHQUFHLENBQUMsQ0FBQztJQUN6RCxJQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSTtRQUFFLE9BQU8sVUFBVSxDQUFDLElBQUksRUFBQyxHQUFHLEVBQUMsR0FBRyxDQUFDLENBQUM7SUFDbEQsT0FBTyxLQUFLLENBQUM7QUFDZCxDQUFDLENBQUE7QUFDRCxNQUFNLFVBQVUsR0FBQyxDQUFDLElBQWdCLEVBQUUsR0FBWSxFQUFDLEdBQWMsRUFBUyxFQUFFO0lBQ3pFLE1BQU0sTUFBTSxHQUFDLGVBQWUsQ0FBQyxJQUFJLEVBQUMsR0FBRyxDQUFDLENBQUM7SUFDdkMsSUFBRyxDQUFDLE1BQU07UUFBRSxPQUFPLEtBQUssQ0FBQztJQUN6QixNQUFNLEVBQUMsS0FBSyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLElBQUksRUFBQyxHQUFDLE1BQU0sQ0FBQztJQUV0QyxPQUFPLEtBQUssQ0FBQztBQUNkLENBQUMsQ0FBQTtBQXFDRCxNQUFNLGFBQWEsR0FBQyxDQUFDLElBQWdCLEVBQUMsR0FBWSxFQUFDLEdBQWMsRUFBUyxFQUFFO0lBRTNFLE1BQU0sTUFBTSxHQUFDLGVBQWUs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YixDQUFDO1NBQ0ksQ0FBQztRQUNMLE9BQU8sS0FBSyxDQUFDO0lBQ2QsQ0FBQztBQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVkaXRvclZpZXcgfSBmcm9tIFwiQGNvZGVtaXJyb3Ivdmlld1wiO1xyXG5pbXBvcnQgeyByZXBsYWNlUmFuZ2UsIHNldEN1cnNvciwgZ2V0Q2hhcmFjdGVyQXRQb3MsIERpcmVjdGlvbiB9IGZyb20gXCJzcmMvdXRpbHMvZWRpdG9yX3V0aWxzXCI7XHJcbmltcG9ydCB7IENvbnRleHQgfSBmcm9tIFwic3JjL3V0aWxzL2NvbnRleHRcIjtcclxuaW1wb3J0IHsgc3RhcnQgfSBmcm9tIFwicmVwbFwiO1xyXG5cclxuXHJcbmV4cG9ydCBjb25zdCB0YWJvdXQgPSAodmlldzogRWRpdG9yVmlldywgY3R4OiBDb250ZXh0LGRpcjogRGlyZWN0aW9uKTpib29sZWFuID0+IHtcclxuXHRjb25zb2xlLmxvZyhcInRhYm91dFwiLGN0eCxkaXIpO1xyXG5cdGlmKGN0eC5tb2RlLmluTWF0aCgpKSByZXR1cm4gdGFib3V0TWF0aGpheCh2aWV3LGN0eCxkaXIpO1xyXG5cdGlmKGN0eC5tb2RlLmh0bWwpIHJldHVybiB0YWJvdXRIdG1sKHZpZXcsY3R4LGRpcik7XHJcblx0cmV0dXJuIGZhbHNlO1xyXG59XHJcbmNvbnN0IHRhYm91dEh0bWw9KHZpZXc6IEVkaXRvclZpZXcsIGN0eDogQ29udGV4dCxkaXI6IERpcmVjdGlvbik6Ym9vbGVhbj0+e1xyXG5cdGNvbnN0IFBhcmFtcz1jdHhUYWJvdXRQYXJhbXModmlldyxjdHgpO1xyXG5cdGlmKCFQYXJhbXMpIHJldHVybiBmYWxzZTtcclxuXHRjb25zdCB7c3RhcnQsZW5kLHBvcyxkb2MsdGV4dH09UGFyYW1zO1xyXG5cclxuXHRyZXR1cm4gZmFsc2U7XHJcbn1cclxuaW50ZXJmYWNlIHRhZ0NvbnN0cnVjdGlvbntcclxuXHRvcGVuOiBzdHJpbmcsXHJcblx0Y2xvc2U6IHN0cmluZ1xyXG59LypcclxuY29uc3QgaHRtbFRhZ3M6QXJyYXk8e3N0YXJ0OiB0YWdDb25zdHJ1Y3Rpb24sZW5kPzogc3RyaW5nfT4gPSBbXHJcblx0e3N0YXJ0OiB7b3BlbjogJzxkaXYnLGNsb3NlOiAnPid9LCBlbmQ6ICc8L2Rpdj4nfSxcclxuXHR7c3RhcnQ6IHtvcGVuOiAnPHAnLGNsb3NlOiAnPid9LCBlbmQ6ICc8L3A+J30sXHJcblx0e3N0YXJ0OiB7b3BlbjogJzxzcGFuJyxjbG9zZTogJz4nfSwgZW5kOiAgJzwvc3Bhbj4nfSxcclxuXHR7c3RhcnQ6IHtvcGVuOiAnPGEnLGNsb3NlOiAnPid9LCBlbmQ6ICc8L2E+J30sXHJcblx0e3N0YXJ0OiB7b3BlbjogJzxoMScsY2xvc2U6ICc+J30sIGVuZDogJzwvaDE+J30sXHJcblx0e3N0YXJ0OiB7b3BlbjogJzxoMicsY2xvc2U6ICc+J30sIGVuZDogJzwvaDI+J30sXHJcblx0e3N0YXJ0OiB7b3BlbjogJzxoMycsY2xvc2U6ICc+J30sIGVuZDogfSxcclxuXHR7c3RhcnQ6IHtvcGVuOiAnPGg0JyxjbG9zZTogJz4nfSwgZW5kOiB9LFxyXG5cdHtzdGFydDoge29wZW46ICc8aDUnLGNsb3NlOiAnPid9LCBlbmQ6IH0sXHJcblx0e3N0YXJ0OiB7b3BlbjogJzxoNicsY2xvc2U6ICc+J30sIGVuZDogfSxcclxuXHR7c3RhcnQ6IHtvcGVuOiAnPGhlYWRlcicsY2xvc2U6ICc+J30sIGVuZDogfSxcclxuXHR7c3RhcnQ6IHtvcGVuOiAnPGZvb3RlcicsY2xvc2U6ICc+J30sIGVuZDogfSxcclxuXHR7c3RhcnQ6IHtvcGVuOiAnPG1haW4nLGNsb3NlOiAnPid9LCBlbmQ6IH0sXHJcblx0e3N0YXJ0OiB7b3BlbjogJzxzZWN0aW9uJyxjbG9zZTogJz4nfSwgZW5kOiB9LFxyXG5cdHtzdGFydDoge29wZW46ICc8YXJ0aWNsZScsY2xvc2U6ICc+J30sIGVuZDpcdH0sXHJcblx0e3N0YXJ0OiB7b3BlbjogJzxhc2lkZScsY2xvc2U6ICc+J30sIGVuZDp9LFxyXG5cdHtzdGFydDoge29wZW46ICc8bmF2JyxjbG9zZTogJz4nfSwgZW5kOiB9LFxyXG5cdHtzdGFydDoge29wZW46ICc8ZmlndXJlJyxjbG9zZTogJz4nfSwgZW5kOiB9LFxyXG5cdHtzdGFydDoge29wZW46ICc8ZmlnY2FwdGlvbicsY2xvc2U6ICc+J30sIGVuZDogfSxcclxuXHR7c3RhcnQ6IHtvcGVuOiAnPGJsb2NrcXVvdGUnLGNsb3NlOiAnPid9LCBlbmQ6IH0sXHJcblx0e3N0YXJ0OiB7b3BlbjogJzxjaXRlJyxjbG9zZTogJz4nfSwgZW5kOiB9LFxyXG5cdHtzdGFydDoge29wZW46ICc8Y29kZScsY2xvc2U6ICc+J30sIGVuZDogfSxcclxuXHR7c3RhcnQ6IHtvcGVuOiAnPGVtJyxjbG9zZTogJz4nfSwgZW5kOiB9LFxyXG5cdHtzdGFydDoge29wZW46ICc8c3Ryb25nJyxjbG9zZTogJz4nfSwgZW5kOiB9LFxyXG5cdHtzdGFydDoge29wZW46ICc8c21hbGwnLGNsb3NlOiAnPid9LCBlbmQ6IH0sXHJcblx0e3N0YXJ0OiB7b3BlbjogJzxzdWInLGNsb3NlOiAnPid9LCBlbmQ6IH0sXHJcblx0e3N0YXJ0OiB7b3BlbjogJzxzdXAnLGNsb3NlOiAnPid9LCBlbmQ6IHtvcGVuOiAnPC9zdXAnLGNsb3NlOiAnPid9fSxcclxuXHR7c3RhcnQ6IHtvcGVuOiAnPGlucycsY2xvc2U6ICc+J30sIGVuZDoge29wZW46ICc8L2lucycsY2xvc2U6ICc+J319LFxyXG5cdHtzdGFydDoge29wZW46ICc8ZGVsJyxjbG9zZTogJz4nfSwgZW5kOiB7b3BlbjogJzwvZGVsJyxjbG9zZTogJz4nfX0sXHJcblx0e3N0YXJ0OiB7b3BlbjogJzxtYXJrJyxjbG9zZTogJz4nfSwgZW5kOiB7b3BlbjogJzwvbWFyaycsY2xvc2U6ICc+J319LFxyXG5dKi9cclxuY29uc3QgdGFib3V0TWF0aGpheD0odmlldzogRWRpdG9yVmlldyxjdHg6IENvbnRleHQsZGlyOiBEaXJlY3Rpb24pOmJvb2xlYW49PntcclxuXHJcblx0Y29uc3QgUGFyYW1zPWN0eFRhYm91dFBhcmFtcyh2aWV3LGN0eCk7XHJcblx0aWYoIVBhcmFtcykgcmV0dXJuIGZhbHNlO1xyXG5cdGNvbnN0IHtzdGFydCxlbmQscG9zLGRvYyx0ZXh0fT1QYXJhbXM7XHJcblxyXG5cdC8vIE1vdmUgdG8gdGhlIG5leHQgY2xvc2luZyBicmFja2V0OiB9LCApLCBdLCA+LCB8LCBvciBcXFxccmFuZ2xlXHJcblx0Y29uc3QgY2hhcnMgPSBbXHJcblx0XHRbXCJ7XCIsIFwiKFwiLCBcIltcIiwgXCI8XCJdLFxyXG5cdFx0W10sXHJcblx0XHRbXCJ9XCIsIFwiKVwiLCBcIl1cIiwgXCI+XCJdXHJcblx0XTtcclxuXHRcclxuXHRjb25zdCBzZWFyY2hFbmQgPSBkaXIgPT09IDEgPyBlbmQrMSA6IHN0YXJ0LTE7XHJcblx0Y29uc3QgbW9kaWZpZXIgPSBkaXIgPT09IDEgPyAwIDogLTE7XHJcblx0Zm9yIChsZXQgaSA9IHBvcyttb2RpZmllcjsgaSAhPT0gc2VhcmNoRW5kOyBpICs9IGRpcikge1xyXG5cdFx0Y29uc3QgdGFyZ2V0Q2hhcnMgPSBjaGFyc1tkaXIgKyAxXS5jb25jYXQoW1wiXFxcXHJhbmdsZVwiLCBcInxcIiwgXCIkXCJdKTtcclxuXHRcdGNvbnN0IG1hdGNoID0gdGFyZ2V0Q2hhcnMuZmluZChzID0+IHRleHQuc3RhcnRzV2l0aChzLCBpKSk7XHJcblx0XHRpZiAobWF0Y2ggIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRzZXRDdXJzb3IodmlldywgaSArIG1hdGNoLmxlbmd0aCttb2RpZmllcik7XHJcblx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblxyXG5cdGNvbnN0IHRleHRCdHduQ3Vyc29yQW5kRW5kID0gZG9jLnNsaWNlU3RyaW5nKHBvcywgZW5kKTtcclxuXHRjb25zdCBhdEVuZCA9IHRleHRCdHduQ3Vyc29yQW5kRW5kLnRyaW0oKS5sZW5ndGggPT09IDA7XHJcblxyXG5cdGlmICghYXRFbmQpIHJldHVybiBmYWxzZTtcclxuXHJcblxyXG5cdC8vIENoZWNrIHdoZXRoZXIgd2UncmUgaW4gaW5saW5lIG1hdGggb3IgYSBibG9jayBlcW5cclxuXHRpZiAoY3R4Lm1vZGUuaW5saW5lTWF0aCB8fCBjdHgubW9kZS5jb2RlTWF0aCkge1xyXG5cdFx0c2V0Q3Vyc29yKHZpZXcsIGVuZCArIDEpO1xyXG5cdH1cclxuXHRlbHNlIHtcclxuXHRcdC8vIEZpcnN0LCBsb2NhdGUgdGhlICQkIHN5bWJvbFxyXG5cdFx0Y29uc3QgZG9sbGFyTGluZSA9IGRvYy5saW5lQXQoZW5kKzIpO1xyXG5cclxuXHRcdC8vIElmIHRoZXJlJ3Mgbm8gbGluZSBhZnRlciB0aGUgZXF1YXRpb24sIGNyZWF0ZSBvbmVcclxuXHJcblx0XHRpZiAoZG9sbGFyTGluZS5udW1iZXIgPT09IGRvYy5saW5lcykge1xyXG5cdFx0XHRyZXBsYWNlUmFuZ2UodmlldywgZG9sbGFyTGluZS50bywgZG9sbGFyTGluZS50bywgXCJcXG5cIik7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gRmluYWxseSwgbW92ZSBvdXRzaWRlIHRoZSAkJCBzeW1ib2xcclxuXHRcdHNldEN1cnNvcih2aWV3LCBkb2xsYXJMaW5lLnRvICsgMSk7XHJcblxyXG5cclxuXHRcdC8vIFRyaW0gd2hpdGVzcGFjZSBhdCBiZWdpbm5pbmcgLyBlbmQgb2YgZXF1YXRpb25cclxuXHRcdGNvbnN0IGxpbmUgPSBkb2MubGluZUF0KHBvcyk7XHJcblx0XHRyZXBsYWNlUmFuZ2UodmlldywgbGluZS5mcm9tLCBsaW5lLnRvLCBsaW5lLnRleHQudHJpbSgpKTtcclxuXHJcblx0fVxyXG5cclxuXHRyZXR1cm4gdHJ1ZTtcclxufVxyXG5jb25zdCBjdHhUYWJvdXRQYXJhbXM9KHZpZXc6IEVkaXRvclZpZXcsIGN0eDogQ29udGV4dCk9PntcclxuXHRjb25zdCByZXN1bHQgPSBjdHguZ2V0Qm91bmRzKCk7XHJcblx0aWYgKCFyZXN1bHQpIHJldHVybiBmYWxzZTtcclxuXHRjb25zdCB7IHN0YXJ0LCBlbmQgfSA9IHJlc3VsdDtcclxuXHRcclxuXHRjb25zdCBwb3MgPSB2aWV3LnN0YXRlLnNlbGVjdGlvbi5tYWluLnRvO1xyXG5cdGNvbnN0IGRvYyA9IHZpZXcuc3RhdGUuZG9jO1xyXG5cdGNvbnN0IHRleHQgPSBkb2MudG9TdHJpbmcoKTtcclxuXHJcblx0cmV0dXJuIHtzdGFydCxlbmQscG9zLGRvYyx0ZXh0fTtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBjb25zdCBzaG91bGRUYWJvdXRCeUNsb3NlQnJhY2tldCA9ICh2aWV3OiBFZGl0b3JWaWV3LCBrZXlQcmVzc2VkOiBzdHJpbmcpID0+IHtcclxuXHRjb25zdCBzZWwgPSB2aWV3LnN0YXRlLnNlbGVjdGlvbi5tYWluO1xyXG5cdGlmICghc2VsLmVtcHR5KSByZXR1cm47XHJcblx0Y29uc3QgcG9zID0gc2VsLmZyb207XHJcblxyXG5cdGNvbnN0IGMgPSBnZXRDaGFyYWN0ZXJBdFBvcyh2aWV3LCBwb3MpO1xyXG5cdGNvbnN0IGJyYWNrZXRzID0gW1wiKVwiLCBcIl1cIiwgXCJ9XCJdO1xyXG5cclxuXHRpZiAoKGMgPT09IGtleVByZXNzZWQpICYmIGJyYWNrZXRzLmNvbnRhaW5zKGMpKSB7XHJcblx0XHRyZXR1cm4gdHJ1ZTtcclxuXHR9XHJcblx0ZWxzZSB7XHJcblx0XHRyZXR1cm4gZmFsc2U7XHJcblx0fVxyXG59Il19