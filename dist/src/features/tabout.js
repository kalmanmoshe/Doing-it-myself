import { replaceRange, setCursor, getCharacterAtPos } from "src/utils/editor_utils";
export const tabout = (view, ctx, dir) => {
    if (!ctx.mode.inMath())
        return false;
    const result = ctx.getBounds();
    if (!result)
        return false;
    const { start, end } = result;
    const pos = view.state.selection.main.to;
    const d = view.state.doc;
    const text = d.toString();
    // Move to the next closing bracket: }, ), ], >, |, or \\rangle
    const chars = [
        ["{", "(", "[", "<"],
        [],
        ["}", ")", "]", ">"]
    ];
    const searchEnd = dir === 1 ? end + 1 : start - 1;
    const modifier = dir === 1 ? 0 : -1;
    for (let i = pos + modifier; i !== searchEnd; i += dir) {
        const targetChars = chars[dir + 1].concat(["\\rangle", "|", "$"]);
        const match = targetChars.find(s => text.startsWith(s, i));
        if (match !== undefined) {
            setCursor(view, i + match.length + modifier);
            return true;
        }
    }
    const textBtwnCursorAndEnd = d.sliceString(pos, end);
    const atEnd = textBtwnCursorAndEnd.trim().length === 0;
    if (!atEnd)
        return false;
    // Check whether we're in inline math or a block eqn
    if (ctx.mode.inlineMath || ctx.mode.codeMath) {
        setCursor(view, end + 1);
    }
    else {
        // First, locate the $$ symbol
        const dollarLine = d.lineAt(end + 2);
        // If there's no line after the equation, create one
        if (dollarLine.number === d.lines) {
            replaceRange(view, dollarLine.to, dollarLine.to, "\n");
        }
        // Finally, move outside the $$ symbol
        setCursor(view, dollarLine.to + 1);
        // Trim whitespace at beginning / end of equation
        const line = d.lineAt(pos);
        replaceRange(view, line.from, line.to, line.text.trim());
    }
    return true;
};
export const shouldTaboutByCloseBracket = (view, keyPressed) => {
    const sel = view.state.selection.main;
    if (!sel.empty)
        return;
    const pos = sel.from;
    const c = getCharacterAtPos(view, pos);
    const brackets = [")", "]", "}"];
    if ((c === keyPressed) && brackets.contains(c)) {
        return true;
    }
    else {
        return false;
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFib3V0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2ZlYXR1cmVzL3RhYm91dC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBS3BGLE1BQU0sQ0FBQyxNQUFNLE1BQU0sR0FBRyxDQUFDLElBQWdCLEVBQUUsR0FBWSxFQUFDLEdBQVMsRUFBVSxFQUFFO0lBQ3ZFLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRTtRQUFFLE9BQU8sS0FBSyxDQUFDO0lBRXhDLE1BQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUMvQixJQUFJLENBQUMsTUFBTTtRQUFFLE9BQU8sS0FBSyxDQUFDO0lBQzFCLE1BQU0sRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEdBQUcsTUFBTSxDQUFDO0lBRTlCLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7SUFDekMsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7SUFDekIsTUFBTSxJQUFJLEdBQUcsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQzFCLCtEQUErRDtJQUMvRCxNQUFNLEtBQUssR0FBRztRQUNiLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDO1FBQ3BCLEVBQUU7UUFDRixDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQztLQUNwQixDQUFDO0lBRUYsTUFBTSxTQUFTLEdBQUcsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFDLENBQUMsQ0FBQztJQUM5QyxNQUFNLFFBQVEsR0FBRyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3BDLEtBQUssSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFDLFFBQVEsRUFBRSxDQUFDLEtBQUssU0FBUyxFQUFFLENBQUMsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUN0RCxNQUFNLFdBQVcsR0FBRyxLQUFLLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNsRSxNQUFNLEtBQUssR0FBRyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzRCxJQUFJLEtBQUssS0FBSyxTQUFTLEVBQUUsQ0FBQztZQUN6QixTQUFTLENBQUMsSUFBSSxFQUFFLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxHQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQzNDLE9BQU8sSUFBSSxDQUFDO1FBQ2IsQ0FBQztJQUNGLENBQUM7SUFHRCxNQUFNLG9CQUFvQixHQUFHLENBQUMsQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3JELE1BQU0sS0FBSyxHQUFHLG9CQUFvQixDQUFDLElBQUksRUFBRSxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUM7SUFFdkQsSUFBSSxDQUFDLEtBQUs7UUFBRSxPQUFPLEtBQUssQ0FBQztJQUd6QixvREFBb0Q7SUFDcEQsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLFVBQVUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQzlDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQzFCLENBQUM7U0FDSSxDQUFDO1FBQ0wsOEJBQThCO1FBQzlCLE1BQU0sVUFBVSxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxHQUFDLENBQUMsQ0FBQyxDQUFDO1FBRW5DLG9EQUFvRDtRQUVwRCxJQUFJLFVBQVUsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ25DLFlBQVksQ0FBQyxJQUFJLEVBQUUsVUFBVSxDQUFDLEVBQUUsRUFBRSxVQUFVLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3hELENBQUM7UUFFRCxzQ0FBc0M7UUFDdEMsU0FBUyxDQUFDLElBQUksRUFBRSxVQUFVLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBR25DLGlEQUFpRDtRQUNqRCxNQUFNLElBQUksR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzNCLFlBQVksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUUxRCxDQUFDO0lBRUQsT0FBTyxJQUFJLENBQUM7QUFDYixDQUFDLENBQUE7QUFHRCxNQUFNLENBQUMsTUFBTSwwQkFBMEIsR0FBRyxDQUFDLElBQWdCLEVBQUUsVUFBa0IsRUFBRSxFQUFFO0lBQ2xGLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQztJQUN0QyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUs7UUFBRSxPQUFPO0lBQ3ZCLE1BQU0sR0FBRyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7SUFFckIsTUFBTSxDQUFDLEdBQUcsaUJBQWlCLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3ZDLE1BQU0sUUFBUSxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUVqQyxJQUFJLENBQUMsQ0FBQyxLQUFLLFVBQVUsQ0FBQyxJQUFJLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUNoRCxPQUFPLElBQUksQ0FBQztJQUNiLENBQUM7U0FDSSxDQUFDO1FBQ0wsT0FBTyxLQUFLLENBQUM7SUFDZCxDQUFDO0FBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRWRpdG9yVmlldyB9IGZyb20gXCJAY29kZW1pcnJvci92aWV3XCI7XHJcbmltcG9ydCB7IHJlcGxhY2VSYW5nZSwgc2V0Q3Vyc29yLCBnZXRDaGFyYWN0ZXJBdFBvcyB9IGZyb20gXCJzcmMvdXRpbHMvZWRpdG9yX3V0aWxzXCI7XHJcbmltcG9ydCB7IENvbnRleHQgfSBmcm9tIFwic3JjL3V0aWxzL2NvbnRleHRcIjtcclxuaW1wb3J0IHsgbWF0Y2ggfSBmcm9tIFwiYXNzZXJ0XCI7XHJcblxyXG5cclxuZXhwb3J0IGNvbnN0IHRhYm91dCA9ICh2aWV3OiBFZGl0b3JWaWV3LCBjdHg6IENvbnRleHQsZGlyOiAxfC0xKTpib29sZWFuID0+IHtcclxuICAgIGlmICghY3R4Lm1vZGUuaW5NYXRoKCkpIHJldHVybiBmYWxzZTtcclxuXHJcblx0Y29uc3QgcmVzdWx0ID0gY3R4LmdldEJvdW5kcygpO1xyXG5cdGlmICghcmVzdWx0KSByZXR1cm4gZmFsc2U7XHJcblx0Y29uc3QgeyBzdGFydCwgZW5kIH0gPSByZXN1bHQ7XHJcblx0XHJcblx0Y29uc3QgcG9zID0gdmlldy5zdGF0ZS5zZWxlY3Rpb24ubWFpbi50bztcclxuXHRjb25zdCBkID0gdmlldy5zdGF0ZS5kb2M7XHJcblx0Y29uc3QgdGV4dCA9IGQudG9TdHJpbmcoKTtcclxuXHQvLyBNb3ZlIHRvIHRoZSBuZXh0IGNsb3NpbmcgYnJhY2tldDogfSwgKSwgXSwgPiwgfCwgb3IgXFxcXHJhbmdsZVxyXG5cdGNvbnN0IGNoYXJzID0gW1xyXG5cdFx0W1wie1wiLCBcIihcIiwgXCJbXCIsIFwiPFwiXSxcclxuXHRcdFtdLFxyXG5cdFx0W1wifVwiLCBcIilcIiwgXCJdXCIsIFwiPlwiXVxyXG5cdF07XHJcblx0XHJcblx0Y29uc3Qgc2VhcmNoRW5kID0gZGlyID09PSAxID8gZW5kKzEgOiBzdGFydC0xO1xyXG5cdGNvbnN0IG1vZGlmaWVyID0gZGlyID09PSAxID8gMCA6IC0xO1xyXG5cdGZvciAobGV0IGkgPSBwb3MrbW9kaWZpZXI7IGkgIT09IHNlYXJjaEVuZDsgaSArPSBkaXIpIHtcclxuXHRcdGNvbnN0IHRhcmdldENoYXJzID0gY2hhcnNbZGlyICsgMV0uY29uY2F0KFtcIlxcXFxyYW5nbGVcIiwgXCJ8XCIsIFwiJFwiXSk7XHJcblx0XHRjb25zdCBtYXRjaCA9IHRhcmdldENoYXJzLmZpbmQocyA9PiB0ZXh0LnN0YXJ0c1dpdGgocywgaSkpO1xyXG5cdFx0aWYgKG1hdGNoICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0c2V0Q3Vyc29yKHZpZXcsIGkgKyBtYXRjaC5sZW5ndGgrbW9kaWZpZXIpO1xyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cclxuXHRjb25zdCB0ZXh0QnR3bkN1cnNvckFuZEVuZCA9IGQuc2xpY2VTdHJpbmcocG9zLCBlbmQpO1xyXG5cdGNvbnN0IGF0RW5kID0gdGV4dEJ0d25DdXJzb3JBbmRFbmQudHJpbSgpLmxlbmd0aCA9PT0gMDtcclxuXHJcblx0aWYgKCFhdEVuZCkgcmV0dXJuIGZhbHNlO1xyXG5cclxuXHJcblx0Ly8gQ2hlY2sgd2hldGhlciB3ZSdyZSBpbiBpbmxpbmUgbWF0aCBvciBhIGJsb2NrIGVxblxyXG5cdGlmIChjdHgubW9kZS5pbmxpbmVNYXRoIHx8IGN0eC5tb2RlLmNvZGVNYXRoKSB7XHJcblx0XHRzZXRDdXJzb3IodmlldywgZW5kICsgMSk7XHJcblx0fVxyXG5cdGVsc2Uge1xyXG5cdFx0Ly8gRmlyc3QsIGxvY2F0ZSB0aGUgJCQgc3ltYm9sXHJcblx0XHRjb25zdCBkb2xsYXJMaW5lID0gZC5saW5lQXQoZW5kKzIpO1xyXG5cclxuXHRcdC8vIElmIHRoZXJlJ3Mgbm8gbGluZSBhZnRlciB0aGUgZXF1YXRpb24sIGNyZWF0ZSBvbmVcclxuXHJcblx0XHRpZiAoZG9sbGFyTGluZS5udW1iZXIgPT09IGQubGluZXMpIHtcclxuXHRcdFx0cmVwbGFjZVJhbmdlKHZpZXcsIGRvbGxhckxpbmUudG8sIGRvbGxhckxpbmUudG8sIFwiXFxuXCIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIEZpbmFsbHksIG1vdmUgb3V0c2lkZSB0aGUgJCQgc3ltYm9sXHJcblx0XHRzZXRDdXJzb3IodmlldywgZG9sbGFyTGluZS50byArIDEpO1xyXG5cclxuXHJcblx0XHQvLyBUcmltIHdoaXRlc3BhY2UgYXQgYmVnaW5uaW5nIC8gZW5kIG9mIGVxdWF0aW9uXHJcblx0XHRjb25zdCBsaW5lID0gZC5saW5lQXQocG9zKTtcclxuXHRcdHJlcGxhY2VSYW5nZSh2aWV3LCBsaW5lLmZyb20sIGxpbmUudG8sIGxpbmUudGV4dC50cmltKCkpO1xyXG5cclxuXHR9XHJcblxyXG5cdHJldHVybiB0cnVlO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGNvbnN0IHNob3VsZFRhYm91dEJ5Q2xvc2VCcmFja2V0ID0gKHZpZXc6IEVkaXRvclZpZXcsIGtleVByZXNzZWQ6IHN0cmluZykgPT4ge1xyXG5cdGNvbnN0IHNlbCA9IHZpZXcuc3RhdGUuc2VsZWN0aW9uLm1haW47XHJcblx0aWYgKCFzZWwuZW1wdHkpIHJldHVybjtcclxuXHRjb25zdCBwb3MgPSBzZWwuZnJvbTtcclxuXHJcblx0Y29uc3QgYyA9IGdldENoYXJhY3RlckF0UG9zKHZpZXcsIHBvcyk7XHJcblx0Y29uc3QgYnJhY2tldHMgPSBbXCIpXCIsIFwiXVwiLCBcIn1cIl07XHJcblxyXG5cdGlmICgoYyA9PT0ga2V5UHJlc3NlZCkgJiYgYnJhY2tldHMuY29udGFpbnMoYykpIHtcclxuXHRcdHJldHVybiB0cnVlO1xyXG5cdH1cclxuXHRlbHNlIHtcclxuXHRcdHJldHVybiBmYWxzZTtcclxuXHR9XHJcbn0iXX0=